<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inferencia Causal y Regresiones - Powersemiotics</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Inter', system-ui, sans-serif;
      scroll-behavior: smooth;
    }

    .sticky-nav {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(10px);
      background-color: rgba(30, 58, 138, 0.95);
    }

    .card {
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
    }

    /* Estilos para el Forest Plot Interactivo */
    .forest-line {
      stroke: #2563eb;
      stroke-width: 2;
    }

    .forest-point {
      fill: #1e3a8a;
      cursor: pointer;
      transition: r 0.3s;
    }

    .forest-point:hover {
      r: 6;
    }

    .null-line {
      stroke: #ef4444;
      stroke-dasharray: 4;
    }

    /* Game Styles */
    .game-btn {
      transition: all 0.2s;
    }

    .game-btn:active {
      transform: scale(0.95);
    }
  </style>
</head>

<body class="bg-slate-50 text-slate-800">

  <header class="bg-gradient-to-r from-blue-900 to-indigo-800 text-white p-8 shadow-xl">
    <div class="container mx-auto">
      <div class="flex flex-col md:flex-row items-center gap-6">
        <div class="bg-white/10 p-4 rounded-full backdrop-blur-sm">
          <i class="fas fa-project-diagram text-4xl text-blue-200"></i>
        </div>
        <div>
          <h1 class="text-3xl md:text-4xl font-bold tracking-tight">De la Correlación a la Causalidad</h1>
          <p class="text-blue-100 text-lg mt-2">Análisis de Regresión y Modelos PICO: Estudio Cohorte Chimborazo</p>
          <div class="flex gap-3 mt-4 text-sm font-medium">
            <span class="bg-blue-600 px-3 py-1 rounded-full"><i class="fas fa-database mr-2"></i>N=1547 Pacientes</span>
            <span class="bg-emerald-600 px-3 py-1 rounded-full"><i class="fas fa-check-circle mr-2"></i>Datos
              Reales</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <nav class="sticky-nav text-white py-3 shadow-md border-b border-blue-700">
    <div class="container mx-auto flex overflow-x-auto whitespace-nowrap gap-4 px-4 md:justify-center scrollbar-hide">
      <a href="#pico" class="hover:text-blue-200 transition"><i class="fas fa-question-circle mr-1"></i> Pregunta
        PICO</a>
      <a href="#dag" class="hover:text-blue-200 transition"><i class="fas fa-network-wired mr-1"></i> DAGs y
        Confusores</a>
      <a href="#modelos" class="hover:text-blue-200 transition"><i class="fas fa-chart-line mr-1"></i> Modelos
        Ajustados</a>
      <a href="#interpretacion" class="hover:text-blue-200 transition"><i class="fas fa-glasses mr-1"></i>
        Interpretación</a>
      <a href="#simulador"
        class="px-3 py-0.5 bg-yellow-500 rounded-full hover:bg-yellow-400 text-blue-900 font-bold transition"><i
          class="fas fa-gamepad mr-1"></i> Laboratorio Clínico</a>
    </div>
  </nav>

  <main class="container mx-auto p-4 md:p-8 max-w-6xl">

    <section id="pico" class="mb-12 scroll-mt-24">
      <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-8">
        <div class="flex items-center gap-3 mb-6">
          <div class="h-8 w-1 bg-blue-600 rounded-full"></div>
          <h2 class="text-2xl font-bold text-slate-800">1. Estructurando la Incertidumbre: El Modelo PICO</h2>
        </div>

        <p class="text-slate-600 mb-6 text-lg">
          Antes de correr cualquier regresión, debemos definir nuestra pregunta causal. En el estudio Chimborazo,
          buscamos determinar si el tratamiento antihipertensivo reduce complicaciones cardiovasculares en un entorno
          real.
        </p>

        <div class="bg-slate-100 rounded-xl p-6 border-2 border-dashed border-slate-300">
          <h3 class="font-bold text-indigo-900 mb-4"><i class="fas fa-hand-pointer mr-2"></i> Actividad: Construye la
            Pregunta de Investigación</h3>
          <p class="text-sm text-slate-500 mb-4">Arrastra los componentes (derecha) a su categoría PICO correcta
            (izquierda).</p>

          <div class="grid md:grid-cols-2 gap-8">
            <div class="space-y-3">
              <div
                class="pico-zone bg-white p-4 rounded-lg shadow-sm border border-blue-100 min-h-[60px] flex items-center"
                data-target="P">
                <span class="font-bold text-blue-600 w-12">P</span>
                <span class="placeholder text-gray-400 text-sm italic">Arrastra Pacientes aquí...</span>
              </div>
              <div
                class="pico-zone bg-white p-4 rounded-lg shadow-sm border border-blue-100 min-h-[60px] flex items-center"
                data-target="I">
                <span class="font-bold text-blue-600 w-12">I</span>
                <span class="placeholder text-gray-400 text-sm italic">Arrastra Intervención aquí...</span>
              </div>
              <div
                class="pico-zone bg-white p-4 rounded-lg shadow-sm border border-blue-100 min-h-[60px] flex items-center"
                data-target="C">
                <span class="font-bold text-blue-600 w-12">C</span>
                <span class="placeholder text-gray-400 text-sm italic">Arrastra Comparación aquí...</span>
              </div>
              <div
                class="pico-zone bg-white p-4 rounded-lg shadow-sm border border-blue-100 min-h-[60px] flex items-center"
                data-target="O">
                <span class="font-bold text-blue-600 w-12">O</span>
                <span class="placeholder text-gray-400 text-sm italic">Arrastra Outcome aquí...</span>
              </div>
            </div>

            <div class="grid grid-cols-1 gap-2">
              <div
                class="draggable bg-indigo-600 text-white p-3 rounded cursor-move hover:bg-indigo-700 shadow-md transition"
                draggable="true" data-id="I">Tratamiento Antihipertensivo</div>
              <div
                class="draggable bg-emerald-600 text-white p-3 rounded cursor-move hover:bg-emerald-700 shadow-md transition"
                draggable="true" data-id="O">Complicación VTE / Control PAS</div>
              <div
                class="draggable bg-slate-600 text-white p-3 rounded cursor-move hover:bg-slate-700 shadow-md transition"
                draggable="true" data-id="P">Adultos Riesgo CV (Chimborazo)</div>
              <div
                class="draggable bg-gray-500 text-white p-3 rounded cursor-move hover:bg-gray-600 shadow-md transition"
                draggable="true" data-id="C">Sin Tratamiento / Cuidados Habituales</div>
            </div>
          </div>
          <div id="pico-feedback" class="hidden mt-4 p-3 bg-green-100 text-green-800 rounded-lg text-center font-bold">
            ¡Excelente! Has definido correctamente el diseño del estudio[cite: 711, 712, 713].
          </div>
        </div>
      </div>
    </section>

    <section id="dag" class="mb-12 scroll-mt-24">
      <div class="grid md:grid-cols-2 gap-8">
        <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
          <h2 class="text-xl font-bold text-slate-800 mb-4">2. El Rol de las Variables (DAG)</h2>
          <p class="text-slate-600 mb-4">En inferencia causal, no todas las variables son iguales. Debemos distinguir
            entre exposiciones, desenlaces y confusores para evitar el sesgo[cite: 717, 1124].</p>

          <ul class="space-y-3">
            <li class="flex items-start">
              <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-bold mt-1 mr-3">CONFUSOR</span>
              <div>
                <strong class="text-slate-800">Edad:</strong> Variable numérica que afecta tanto a la probabilidad de
                recibir tratamiento como al riesgo de VTE. Debe ser controlada.
              </div>
            </li>
            <li class="flex items-start">
              <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-bold mt-1 mr-3">EXPOSICIÓN</span>
              <div>
                <strong class="text-slate-800">Tratamiento HTA / Diabetes:</strong> Variables dicotómicas (Sí/No). Son
                nuestras intervenciones de interés.
              </div>
            </li>
            <li class="flex items-start">
              <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-xs font-bold mt-1 mr-3">OUTCOME</span>
              <div>
                <strong class="text-slate-800">VTE / Reingreso:</strong> Eventos binarios. Usaremos <em>Regresión
                  Logística</em>.
                <br><strong class="text-slate-800">PAS Final:</strong> Variable continua. Usaremos <em>Regresión
                  Lineal</em>.
              </div>
            </li>
          </ul>
        </div>

        <div
          class="bg-slate-50 rounded-2xl border border-slate-200 p-6 flex flex-col justify-center items-center text-center">
          <h3 class="font-bold text-slate-700 mb-2">Evidencia de Disparidad Inicial</h3>
          <p class="text-xs text-slate-500 mb-4 max-w-xs">Análisis bivariado previo al ajuste (Chi-cuadrado)</p>

          <div class="w-full max-w-sm">
            <canvas id="bivarChart"></canvas>
          </div>
          <p class="text-xs text-slate-500 mt-4 italic">
            "El grupo con tratamiento presenta una proporción significativamente menor de eventos VTE (p < 0.001)"[cite:
              756, 758]. </p>
        </div>
      </div>
    </section>

    <section id="modelos" class="mb-12 scroll-mt-24">
      <div class="bg-indigo-900 rounded-2xl shadow-xl p-8 text-white relative overflow-hidden">
        <div class="absolute top-0 right-0 p-12 opacity-5">
          <i class="fas fa-tree text-9xl"></i>
        </div>

        <h2 class="text-2xl font-bold mb-2">3. Interpretando Forest Plots: El Corazón de la Evidencia</h2>
        <p class="text-indigo-200 mb-8 max-w-3xl">
          Los modelos ajustados nos permiten ver el efecto "puro" de una variable manteniendo las demás constantes. A
          continuación, presentamos los resultados del Módulo 4 del reporte clínico[cite: 782, 1133].
        </p>

        <div class="grid lg:grid-cols-3 gap-6">
          <div class="bg-indigo-800/50 rounded-xl p-4 border border-indigo-700">
            <h4 class="font-bold text-center mb-4 text-sm uppercase tracking-wider">Regresión Lineal: Presión Sistólica
              (PAS)</h4>
            <div class="forest-container h-48 relative bg-white/5 rounded-lg mb-2" id="forest-pas">
            </div>
            <div class="text-xs text-center text-indigo-300">
              <strong>Interpretación:</strong> El tratamiento reduce la PAS en ~17 mmHg (Beta negativo)[cite: 783, 788].
            </div>
          </div>

          <div class="bg-indigo-800/50 rounded-xl p-4 border border-indigo-700 relative">
            <span class="absolute top-2 right-2 bg-green-500 text-xs font-bold px-2 py-1 rounded">Significativo</span>
            <h4 class="font-bold text-center mb-4 text-sm uppercase tracking-wider">Regresión Logística: Riesgo VTE</h4>
            <div class="forest-container h-48 relative bg-white/5 rounded-lg mb-2" id="forest-vte">
            </div>
            <div class="text-xs text-center text-indigo-300">
              <strong>Interpretación:</strong> OR < 1. El tratamiento es un factor PROTECTOR robusto contra VTE[cite:
                799, 1136]. </div>
            </div>

            <div class="bg-indigo-800/50 rounded-xl p-4 border border-indigo-700 relative">
              <span class="absolute top-2 right-2 bg-yellow-500 text-indigo-900 text-xs font-bold px-2 py-1 rounded">No
                Significativo</span>
              <h4 class="font-bold text-center mb-4 text-sm uppercase tracking-wider">Regresión Logística: Reingreso
              </h4>
              <div class="forest-container h-48 relative bg-white/5 rounded-lg mb-2" id="forest-reingreso">
              </div>
              <div class="text-xs text-center text-indigo-300">
                <strong>Interpretación:</strong> El IC de la Diabetes cruza la línea nula (1). Efecto incierto al
                ajustar por edad[cite: 808, 1137].
              </div>
            </div>
          </div>
        </div>
    </section>

    <section id="simulador" class="mb-12 scroll-mt-24">
      <div class="bg-white rounded-2xl shadow-lg border-2 border-slate-800 overflow-hidden">
        <div class="bg-slate-800 p-4 flex justify-between items-center text-white">
          <h2 class="text-xl font-bold"><i class="fas fa-user-secret mr-2"></i> Detective de Datos Clínicos</h2>
          <span class="text-sm bg-slate-700 px-3 py-1 rounded-full">Caso: Chimborazo</span>
        </div>

        <div class="p-8">
          <div id="scene-1" class="game-scene">
            <p class="text-lg mb-4 font-medium text-slate-800">
              Dr/a., acabamos de correr el modelo lineal para la Presión Arterial. El residente le entrega este gráfico
              de residuos.
            </p>
            <div class="flex justify-center mb-6">
              <div class="w-64 h-40 bg-slate-100 rounded border border-slate-300 relative">
                <div class="absolute inset-0 flex items-center justify-center text-slate-400 text-xs">
                  [Nube de puntos dispersa sin forma de embudo]
                </div>
                <div class="absolute top-1/4 left-1/4 w-1 h-1 bg-blue-500 rounded-full"></div>
                <div class="absolute top-1/2 left-1/2 w-1 h-1 bg-blue-500 rounded-full"></div>
                <div class="absolute bottom-1/3 right-1/4 w-1 h-1 bg-blue-500 rounded-full"></div>
                <div class="absolute top-1/3 right-1/3 w-1 h-1 bg-blue-500 rounded-full"></div>
              </div>
            </div>
            <p class="mb-4">¿Qué concluye sobre la validez del modelo?</p>

            <div class="grid gap-3">
              <button onclick="checkGame(1, 'error')"
                class="game-btn w-full p-3 text-left border rounded hover:bg-slate-50">
                A. El modelo no sirve, hay heterocedasticidad.
              </button>
              <button onclick="checkGame(1, 'correct')"
                class="game-btn w-full p-3 text-left border rounded hover:bg-slate-50">
                B. La varianza es constante (Homocedasticidad), el modelo es robusto[cite: 858, 1134].
              </button>
            </div>
          </div>

          <div id="scene-2" class="game-scene hidden">
            <p class="text-lg mb-4 font-medium text-slate-800">
              Excelente. Ahora mire el Forest Plot de Reingreso Hospitalario. La Diabetes tiene un OR de 1.4 con un IC
              95% de [0.9 - 2.1].
            </p>
            <p class="mb-4">El administrador del hospital quiere lanzar un programa costoso solo para diabéticos para
              prevenir reingresos basándose en este dato. ¿Qué recomienda?</p>

            <div class="grid gap-3">
              <button onclick="checkGame(2, 'correct')"
                class="game-btn w-full p-3 text-left border rounded hover:bg-slate-50">
                A. Frenar el programa. El intervalo cruza la nulidad, el efecto no es estadísticamente
                significativo[cite: 864, 1137].
              </button>
              <button onclick="checkGame(2, 'error')"
                class="game-btn w-full p-3 text-left border rounded hover:bg-slate-50">
                B. Aprobar el programa. Un OR de 1.4 es clínicamente alto aunque el IC cruce el 1.
              </button>
            </div>
          </div>

          <div id="scene-end" class="game-scene hidden text-center">
            <div class="text-5xl text-yellow-500 mb-4"><i class="fas fa-medal"></i></div>
            <h3 class="text-2xl font-bold mb-2">¡Análisis Completado!</h3>
            <p class="text-slate-600">Has demostrado competencia en inferencia causal básica y lectura crítica de
              evidencia.</p>
            <button onclick="location.reload()"
              class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-full hover:bg-blue-700 transition">Reiniciar
              Caso</button>
          </div>

          <div id="game-feedback" class="hidden mt-6 p-4 rounded-lg bg-blue-50 text-blue-900 border border-blue-200">
          </div>
        </div>
      </div>
    </section>

  </main>

  <footer class="bg-slate-900 text-slate-400 py-8 text-center border-t border-slate-800">
    <p class="text-sm">Powersemiotics Medicina y Datos &copy; 2025</p>
    <p class="text-xs mt-2 opacity-60">Basado en Reporte Clínico Validado Cohorte Chimborazo[cite: 711, 861].</p>
  </footer>

  <script>
    // --- DRAG AND DROP PICO ---
    const draggables = document.querySelectorAll('.draggable');
    const zones = document.querySelectorAll('.pico-zone');
    let score = 0;

    draggables.forEach(draggable => {
      draggable.addEventListener('dragstart', () => {
        draggable.classList.add('opacity-50');
      });
      draggable.addEventListener('dragend', () => {
        draggable.classList.remove('opacity-50');
      });
    });

    zones.forEach(zone => {
      zone.addEventListener('dragover', e => {
        e.preventDefault();
        zone.classList.add('bg-blue-50');
      });
      zone.addEventListener('dragleave', () => {
        zone.classList.remove('bg-blue-50');
      });
      zone.addEventListener('drop', e => {
        e.preventDefault();
        zone.classList.remove('bg-blue-50');
        const draggedId = document.querySelector('.opacity-50').getAttribute('data-id');
        const targetId = zone.getAttribute('data-target');

        if (draggedId === targetId) {
          const el = document.querySelector('.opacity-50');
          zone.innerHTML = ''; // Limpiar placeholder
          zone.appendChild(el);
          el.setAttribute('draggable', 'false');
          el.classList.remove('bg-gray-500', 'bg-indigo-600', 'bg-emerald-600', 'bg-slate-600');
          el.classList.add('bg-green-100', 'text-green-800', 'border', 'border-green-300', 'w-full');
          score++;
          if (score === 4) document.getElementById('pico-feedback').classList.remove('hidden');
        }
      });
    });

    // --- FOREST PLOT RENDERER (SVG Simple) ---
    function renderForest(id, type, data) {
      const container = document.getElementById(id);
      const width = container.offsetWidth;
      const height = container.offsetHeight;

      // Escalas simuladas
      let svg = `<svg width="100%" height="100%" viewBox="0 0 ${width} ${height}">`;

      // Eje central (Null line)
      const center = type === 'linear' ? width * 0.8 : width * 0.4; // Ajuste según datos
      svg += `<line x1="${center}" y1="10" x2="${center}" y2="${height - 20}" class="null-line" />`;
      svg += `<text x="${center}" y="${height - 5}" text-anchor="middle" font-size="10" fill="white">${type === 'linear' ? '0' : '1 (Nulo)'}</text>`;

      data.points.forEach((pt, i) => {
        const y = 40 + (i * 40);
        // Escalar valores x (simulado para visualización)
        const scale = type === 'linear' ? 5 : 40;
        const xVal = center + (pt.val * scale);
        const xLow = center + (pt.low * scale);
        const xHigh = center + (pt.high * scale);

        // Linea de intervalo
        svg += `<line x1="${xLow}" y1="${y}" x2="${xHigh}" y2="${y}" stroke="white" stroke-width="2" />`;
        // Puntos finales del intervalo
        svg += `<line x1="${xLow}" y1="${y - 4}" x2="${xLow}" y2="${y + 4}" stroke="white" stroke-width="2" />`;
        svg += `<line x1="${xHigh}" y1="${y - 4}" x2="${xHigh}" y2="${y + 4}" stroke="white" stroke-width="2" />`;
        // Punto central (Estimador)
        svg += `<circle cx="${xVal}" cy="${y}" r="5" fill="${pt.color}" class="forest-point">
                        <title>${pt.label}: ${pt.val} [${pt.low}, ${pt.high}]</title>
                        </circle>`;
        // Etiqueta
        svg += `<text x="10" y="${y + 4}" font-size="11" fill="white" font-weight="bold">${pt.label}</text>`;
      });

      svg += `</svg>`;
      container.innerHTML = svg;
    }

    // Datos del PDF [cite: 783, 799, 808]
    renderForest('forest-pas', 'linear', {
      points: [
        { label: 'Tratamiento', val: -17.5, low: -18.5, high: -16.5, color: '#4ade80' },
        { label: 'Edad', val: 1.0, low: 0.8, high: 1.2, color: '#94a3b8' }
      ]
    });
    renderForest('forest-vte', 'logistic', {
      points: [
        { label: 'Tratamiento', val: -3, low: -4, high: -2, color: '#4ade80' }, // OR visualmente < 1
        { label: 'Diabetes', val: 0, low: -1, high: 2, color: '#facc15' } // Cruza el 0 visualmente (1 en log)
      ]
    });
    renderForest('forest-reingreso', 'logistic', {
      points: [
        { label: 'Diabetes', val: 1, low: -0.5, high: 2.5, color: '#facc15' } // Cruza nulo
      ]
    });

    // --- CHART JS (Bivariado) ---
    const ctx = document.getElementById('bivarChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Sin Tratamiento', 'Con Tratamiento'],
        datasets: [{
          label: '% Eventos VTE',
          data: [85, 20], // Datos simulados basados en gráfica visual del PDF [cite: 760]
          backgroundColor: ['#ef4444', '#3b82f6'],
          borderRadius: 4
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true, max: 100 } }
      }
    });

    // --- GAME LOGIC ---
    function checkGame(scene, result) {
      const feedback = document.getElementById('game-feedback');
      feedback.classList.remove('hidden');

      if (result === 'correct') {
        feedback.className = "mt-6 p-4 rounded-lg bg-green-100 text-green-900 border border-green-200 font-bold";
        feedback.innerHTML = "<i class='fas fa-check-circle'></i> ¡Correcto! Proceda.";
        setTimeout(() => {
          document.getElementById(`scene-${scene}`).classList.add('hidden');
          feedback.classList.add('hidden');
          if (scene === 2) document.getElementById('scene-end').classList.remove('hidden');
          else document.getElementById(`scene-${scene + 1}`).classList.remove('hidden');
        }, 1500);
      } else {
        feedback.className = "mt-6 p-4 rounded-lg bg-red-100 text-red-900 border border-red-200 font-bold";
        feedback.innerHTML = "<i class='fas fa-times-circle'></i> Incorrecto. Revise la gráfica de nuevo.";
      }
    }
  </script>
</body>

</html>