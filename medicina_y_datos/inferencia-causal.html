<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CausalMed - Inferencia Causal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.294.0"
        }
    }
    </script>
</head>

<body>
  <div id="root"></div>
  <script type="text/babel" data-type="module">
    import React, { useState, useEffect } from 'react';
    import { createRoot } from 'react-dom/client';
    import {
      ArrowRight,
      ChevronRight,
      Info,
      AlertCircle,
      CheckCircle2,
      HelpCircle,
      Activity,
      Zap,
      Target,
      GitBranch,
      BrainCircuit,
      Microscope,
      Stethoscope
    } from 'lucide-react';

    const App = () => {
      const [activeTab, setActiveTab] = useState('introduccion');
      const [scrollProgress, setScrollProgress] = useState(0);

      useEffect(() => {
        const handleScroll = () => {
          const totalScroll = document.documentElement.scrollHeight - window.innerHeight;
          const currentProgress = (window.pageYOffset / totalScroll) * 100;
          setScrollProgress(currentProgress);
        };
        window.addEventListener('scroll', handleScroll);
        return () => window.removeEventListener('scroll', handleScroll);
      }, []);

      // Componentes de la interfaz
      const SidebarItem = ({ id, label, icon: Icon }) => (
        <button
          onClick={() => setActiveTab(id)}
          className={`w-full flex items-center gap-3 p-3 rounded-lg transition-all duration-200 ${activeTab === id
              ? 'bg-blue-600 text-white shadow-lg shadow-blue-200'
              : 'text-slate-600 hover:bg-slate-100'
            }`}
        >
          <Icon size={18} />
          <span className="font-medium text-sm">{label}</span>
        </button>
      );

      return (
        <div className="min-h-screen bg-slate-50 font-sans text-slate-900 flex flex-col md:flex-row">
          {/* Sidebar Navigation */}
          <aside className="w-full md:w-64 bg-white border-r border-slate-200 p-4 md:sticky md:top-0 md:h-screen z-10">
            <div className="mb-8 flex items-center gap-2">
              <div className="bg-blue-600 p-2 rounded-lg text-white">
                <BrainCircuit size={24} />
              </div>
              <h1 className="font-bold text-xl tracking-tight text-blue-900 leading-tight">CausalMed</h1>
            </div>

            <nav className="space-y-1">
              <SidebarItem id="introduccion" label="El Dilema de la TRH" icon={Microscope} />
              <SidebarItem id="teoria" label="Resultados Potenciales" icon={GitBranch} />
              <SidebarItem id="dags" label="Diagramas (DAGs)" icon={Activity} />
              <SidebarItem id="metodos" label="Métodos de Ajuste" icon={Target} />
              <SidebarItem id="quiz" label="Pon a Prueba tu Conocimiento" icon={HelpCircle} />
            </nav>

            <div className="absolute bottom-6 left-4 right-4 hidden md:block">
              <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                <p className="text-xs text-blue-800 font-semibold mb-2">Progreso del curso</p>
                <div className="w-full bg-blue-200 h-1.5 rounded-full overflow-hidden">
                  <div
                    className="bg-blue-600 h-full transition-all duration-300"
                    style={{ width: `${scrollProgress}%` }}
                  ></div>
                </div>
              </div>
            </div>
          </aside>

          {/* Main Content Area */}
          <main className="flex-1 overflow-x-hidden">
            <div className="max-w-4xl mx-auto p-6 md:p-12">
              {activeTab === 'introduccion' && <IntroduccionSection />}
              {activeTab === 'teoria' && <TeoriaSection />}
              {activeTab === 'dags' && <DAGsSection />}
              {activeTab === 'metodos' && <MetodosSection />}
              {activeTab === 'quiz' && <QuizSection />}
            </div>
          </main>
        </div>
      );
    };

    // --- SECCIONES INDIVIDUALES ---

    const IntroduccionSection = () => (
      <section className="animate-in fade-in slide-in-from-bottom-4 duration-700">
        <header className="mb-12">
          <span className="text-blue-600 font-bold tracking-widest uppercase text-xs mb-2 block">Caso de Estudio</span>
          <h2 className="text-4xl font-extrabold text-slate-900 mb-4 leading-tight">El Salto Crítico: De la Asociación a la Causa</h2>
          <p className="text-lg text-slate-600 max-w-2xl leading-relaxed">
            La historia de la Terapia de Reemplazo Hormonal (TRH) es la lección más importante de la epidemiología moderna.
          </p>
        </header>

        <div className="grid md:grid-cols-2 gap-8 mb-12">
          <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
            <div className="bg-amber-100 text-amber-700 w-10 h-10 rounded-full flex items-center justify-center mb-4">
              <AlertCircle size={20} />
            </div>
            <h3 className="font-bold text-xl mb-2">1980-2000: La Ilusión</h3>
            <p className="text-slate-600 text-sm leading-relaxed">
              Estudios observacionales sugerían que las mujeres en TRH tenían un <strong>50% menos riesgo</strong> de cardiopatía coronaria. Se pensaba que el estrógeno era el "fármaco milagroso" para el corazón.
            </p>
          </div>

          <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
            <div className="bg-blue-100 text-blue-700 w-10 h-10 rounded-full flex items-center justify-center mb-4">
              <Stethoscope size={20} />
            </div>
            <h3 className="font-bold text-xl mb-2">2002: La Realidad</h3>
            <p className="text-slate-600 text-sm leading-relaxed">
              El ensayo clínico aleatorizado (WHI) demostró lo contrario: la TRH <strong>aumentaba</strong> el riesgo de cardiopatía y cáncer de mama. La asociación anterior era espuria.
            </p>
          </div>
        </div>

        <div className="bg-blue-900 text-white p-8 rounded-3xl relative overflow-hidden">
          <div className="relative z-10">
            <h3 className="text-2xl font-bold mb-4">¿Qué falló?</h3>
            <p className="text-blue-100 mb-6 leading-relaxed">
              El error fue el <strong>Sesgo del Usuario Sano</strong>. Las mujeres que tomaban TRH tenían mayor estatus socioeconómico, hacían más ejercicio y comían mejor. No era la hormona la que las protegía, sino su estilo de vida.
            </p>
            <div className="flex items-center gap-4 text-sm font-semibold text-blue-300 italic border-l-2 border-blue-500 pl-4">
              "Correlación no implica causalidad, pero entender por qué existe la correlación es la esencia de la ciencia."
            </div>
          </div>
          <div className="absolute top-0 right-0 -mr-16 -mt-16 bg-blue-800 w-64 h-64 rounded-full opacity-50 blur-3xl"></div>
        </div>
      </section>
    );

    const TeoriaSection = () => {
      const [outcome, setOutcome] = useState('none');

      return (
        <section className="animate-in fade-in slide-in-from-bottom-4 duration-700">
          <header className="mb-12">
            <span className="text-blue-600 font-bold tracking-widest uppercase text-xs mb-2 block">Marco Teórico</span>
            <h2 className="text-4xl font-extrabold text-slate-900 mb-4">Resultados Potenciales y el Contrafactual</h2>
          </header>

          <div className="bg-white p-8 rounded-2xl border border-slate-200 mb-12">
            <h3 className="font-bold text-xl mb-6">Interactúa con el Experimento Mental</h3>
            <p className="text-slate-600 mb-8 italic">¿Qué le sucede al Paciente X? Selecciona un escenario:</p>

            <div className="flex flex-col sm:flex-row gap-4 justify-center mb-10">
              <button
                onClick={() => setOutcome('treated')}
                className={`px-6 py-4 rounded-xl font-bold transition-all border-2 ${outcome === 'treated' ? 'bg-indigo-600 text-white border-indigo-600 ring-4 ring-indigo-100' : 'bg-white text-indigo-600 border-indigo-100 hover:bg-indigo-50'}`}
              >
                Escenario A: Recibe Tratamiento
              </button>
              <button
                onClick={() => setOutcome('control')}
                className={`px-6 py-4 rounded-xl font-bold transition-all border-2 ${outcome === 'control' ? 'bg-slate-700 text-white border-slate-700 ring-4 ring-slate-100' : 'bg-white text-slate-700 border-slate-200 hover:bg-slate-50'}`}
              >
                Escenario B: No recibe nada (Control)
              </button>
            </div>

            <div className="h-40 flex items-center justify-center bg-slate-50 rounded-2xl border border-dashed border-slate-300 p-6 text-center">
              {outcome === 'none' && <p className="text-slate-400">Selecciona un escenario para ver el resultado potencial.</p>}
              {outcome === 'treated' && (
                <div className="animate-in zoom-in duration-300">
                  <CheckCircle2 size={48} className="text-green-500 mx-auto mb-2" />
                  <p className="font-bold text-slate-800">Resultado Observado: Mejora del síntoma (Y=1)</p>
                  <p className="text-sm text-slate-500">¿Fue por el fármaco o por el azar?</p>
                </div>
              )}
              {outcome === 'control' && (
                <div className="animate-in zoom-in duration-300">
                  <Activity size={48} className="text-rose-500 mx-auto mb-2" />
                  <p className="font-bold text-slate-800">Resultado Contrafactual: No mejora (Y=0)</p>
                  <p className="text-sm text-slate-500">Este escenario es invisible en la vida real.</p>
                </div>
              )}
            </div>
          </div>

          <div className="grid md:grid-cols-2 gap-6">
            <div className="border-l-4 border-blue-500 pl-6 py-2">
              <h4 className="font-bold text-slate-900 mb-2">Intercambiabilidad</h4>
              <p className="text-sm text-slate-600">El objetivo de la aleatorización es que el grupo control sea un sustituto perfecto del grupo tratado si este no hubiera sido tratado.</p>
            </div>
            <div className="border-l-4 border-amber-500 pl-6 py-2">
              <h4 className="font-bold text-slate-900 mb-2">Estimandos (ATE vs ATT)</h4>
              <p className="text-sm text-slate-600">¿Queremos saber el efecto en toda la población (ATE) o solo en los que realmente se trataron (ATT)?</p>
            </div>
          </div>
        </section>
      );
    };

    const DAGsSection = () => {
      const [activeConcept, setActiveConcept] = useState('confusor');

      const concepts = {
        confusor: {
          title: "El Confusor (Backdoor)",
          description: "Una variable que causa tanto el tratamiento como el resultado. Crea una asociación falsa.",
          formula: "A ← C → Y",
          action: "Se debe ajustar estadísticamente.",
          color: "bg-blue-500"
        },
        colisionador: {
          title: "El Colisionador",
          description: "Una variable que es efecto de ambas. Ajustar por ella crea una asociación falsa.",
          formula: "A → C ← Y",
          action: "¡NUNCA se debe ajustar por un colisionador!",
          color: "bg-rose-500"
        },
        mediador: {
          title: "El Mediador",
          description: "Variable en la cadena causal entre el tratamiento y el resultado.",
          formula: "A → C → Y",
          action: "Explica el mecanismo del efecto.",
          color: "bg-emerald-500"
        }
      };

      return (
        <section className="animate-in fade-in slide-in-from-bottom-4 duration-700">
          <header className="mb-12">
            <span className="text-blue-600 font-bold tracking-widest uppercase text-xs mb-2 block">Visualización Causal</span>
            <h2 className="text-4xl font-extrabold text-slate-900 mb-4">Diagramas Acíclicos Dirigidos (DAGs)</h2>
            <p className="text-slate-600">Los DAGs nos permiten "ver" la estructura de la causalidad antes de tocar los datos.</p>
          </header>

          <div className="flex flex-wrap gap-2 mb-8">
            {Object.keys(concepts).map((key) => (
              <button
                key={key}
                onClick={() => setActiveConcept(key)}
                className={`px-4 py-2 rounded-full text-sm font-bold transition-all ${activeConcept === key ? 'bg-slate-900 text-white shadow-lg' : 'bg-white text-slate-500 border border-slate-200 hover:border-slate-400'}`}
              >
                {concepts[key].title}
              </button>
            ))}
          </div>

          <div className="bg-white rounded-3xl overflow-hidden shadow-xl border border-slate-100">
            <div className={`h-2 ${concepts[activeConcept].color}`}></div>
            <div className="p-8">
              <div className="flex flex-col md:flex-row gap-8 items-center">
                <div className="flex-1">
                  <h3 className="text-2xl font-bold mb-4">{concepts[activeConcept].title}</h3>
                  <p className="text-slate-600 mb-6 text-lg leading-relaxed">{concepts[activeConcept].description}</p>

                  <div className="bg-slate-50 p-4 rounded-xl inline-block mb-6">
                    <code className="text-2xl font-mono text-slate-800">{concepts[activeConcept].formula}</code>
                  </div>

                  <div className="flex items-start gap-3 bg-amber-50 p-4 rounded-xl border border-amber-100">
                    <Info size={20} className="text-amber-600 flex-shrink-0 mt-1" />
                    <p className="text-amber-800 font-medium">{concepts[activeConcept].action}</p>
                  </div>
                </div>

                <div className="w-full md:w-1/3 flex justify-center py-12 bg-slate-50 rounded-2xl border border-slate-100">
                  <div className="flex items-center gap-8 relative">
                    {/* Visualización simplificada del DAG */}
                    <div className="w-12 h-12 bg-white rounded-full border-4 border-blue-500 flex items-center justify-center font-bold shadow-sm">A</div>
                    <div className="w-16 h-0.5 bg-slate-300 relative">
                      <div className="absolute right-0 top-1/2 -translate-y-1/2 translate-x-1/2 w-2 h-2 bg-slate-300 rotate-45"></div>
                    </div>
                    <div className="w-12 h-12 bg-white rounded-full border-4 border-slate-800 flex items-center justify-center font-bold shadow-sm">Y</div>

                    {activeConcept === 'confusor' && (
                      <div className="absolute -top-16 left-1/2 -translate-x-1/2 flex flex-col items-center">
                        <div className="w-12 h-12 bg-white rounded-full border-4 border-amber-500 flex items-center justify-center font-bold shadow-sm">C</div>
                        <div className="flex justify-between w-32 -mt-1">
                          <div className="w-0.5 h-8 bg-amber-500 rotate-[45deg] origin-top"></div>
                          <div className="w-0.5 h-8 bg-amber-500 -rotate-[45deg] origin-top"></div>
                        </div>
                      </div>
                    )}
                    {activeConcept === 'colisionador' && (
                      <div className="absolute -bottom-16 left-1/2 -translate-x-1/2 flex flex-col items-center">
                        <div className="flex justify-between w-32 -mb-1 rotate-180">
                          <div className="w-0.5 h-8 bg-rose-500 rotate-[45deg] origin-top"></div>
                          <div className="w-0.5 h-8 bg-rose-500 -rotate-[45deg] origin-top"></div>
                        </div>
                        <div className="w-12 h-12 bg-white rounded-full border-4 border-rose-500 flex items-center justify-center font-bold shadow-sm">C</div>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      );
    };

    const MetodosSection = () => {
      const methods = [
        {
          name: "Propensity Score",
          description: "Colapsa múltiples confusores en una sola probabilidad de ser tratado.",
          pro: "Reduce la dimensionalidad.",
          con: "No corrige por confusores no medidos."
        },
        {
          name: "IPTW",
          description: "Pondera a los pacientes inversamente a su probabilidad de tratamiento.",
          pro: "Mantiene toda la muestra original.",
          con: "Sensible a pesos extremos."
        },
        {
          name: "Matching",
          description: "Empareja a cada paciente tratado con uno no tratado 'clon' en sus características.",
          pro: "Fácil de explicar clínicamente.",
          con: "Se pierden datos si no hay 'parejas'."
        }
      ];

      return (
        <section className="animate-in fade-in slide-in-from-bottom-4 duration-700">
          <header className="mb-12">
            <span className="text-blue-600 font-bold tracking-widest uppercase text-xs mb-2 block">Herramientas</span>
            <h2 className="text-4xl font-extrabold text-slate-900 mb-4 text-balance">Métodos para Imitar la Aleatorización</h2>
          </header>

          <div className="space-y-6">
            {methods.map((m, i) => (
              <div key={i} className="group bg-white p-6 rounded-2xl border border-slate-200 hover:border-blue-400 transition-all">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-xl font-bold text-slate-900 flex items-center gap-2">
                    <div className="w-2 h-8 bg-blue-600 rounded-full group-hover:scale-y-125 transition-transform"></div>
                    {m.name}
                  </h3>
                  <Zap size={20} className="text-slate-300 group-hover:text-amber-400 transition-colors" />
                </div>
                <p className="text-slate-600 mb-6">{m.description}</p>
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-green-50 p-3 rounded-lg">
                    <span className="text-[10px] font-bold text-green-700 uppercase block mb-1">Ventaja</span>
                    <p className="text-xs font-medium text-green-900">{m.pro}</p>
                  </div>
                  <div className="bg-rose-50 p-3 rounded-lg">
                    <span className="text-[10px] font-bold text-rose-700 uppercase block mb-1">Limitación</span>
                    <p className="text-xs font-medium text-rose-900">{m.con}</p>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>
      );
    };

    const QuizSection = () => {
      const [currentQuestion, setCurrentQuestion] = useState(0);
      const [score, setScore] = useState(0);
      const [showResult, setShowResult] = useState(false);
      const [selectedOption, setSelectedOption] = useState(null);

      const questions = [
        {
          q: "¿Por qué los estudios observacionales de TRH fallaron inicialmente?",
          options: [
            "Las dosis eran incorrectas.",
            "El Sesgo del Usuario Sano (confusión).",
            "Los investigadores mintieron.",
            "No había suficientes pacientes."
          ],
          correct: 1
        },
        {
          q: "Si ajustas por un colisionador en un DAG, ¿qué sucede?",
          options: [
            "Limpias el sesgo de confusión.",
            "Descubres el mecanismo causal.",
            "Introduces un sesgo de selección artificial.",
            "La estimación se vuelve más precisa."
          ],
          correct: 2
        },
        {
          q: "¿Qué método crea una 'pseudo-población' donde el tratamiento es independiente de los confusores?",
          options: [
            "Estratificación simple.",
            "Regresión Lineal.",
            "IPTW (Inversa de la Probabilidad).",
            "Regresión de Cox."
          ],
          correct: 2
        }
      ];

      const handleOptionClick = (idx) => {
        if (selectedOption !== null) return;
        setSelectedOption(idx);
        if (idx === questions[currentQuestion].correct) {
          setScore(score + 1);
        }

        setTimeout(() => {
          if (currentQuestion < questions.length - 1) {
            setCurrentQuestion(currentQuestion + 1);
            setSelectedOption(null);
          } else {
            setShowResult(true);
          }
        }, 1500);
      };

      if (showResult) {
        return (
          <div className="bg-white p-12 rounded-3xl text-center shadow-xl border border-slate-100">
            <div className="w-20 h-20 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
              <Target size={40} />
            </div>
            <h3 className="text-3xl font-bold mb-2 text-slate-900">¡Reto Completado!</h3>
            <p className="text-slate-500 mb-8 text-lg">Has demostrado un gran entendimiento de la inferencia causal.</p>
            <div className="text-6xl font-black text-blue-600 mb-8">{Math.round((score / questions.length) * 100)}%</div>
            <button
              onClick={() => {
                setCurrentQuestion(0);
                setScore(0);
                setShowResult(false);
                setSelectedOption(null);
              }}
              className="bg-slate-900 text-white px-8 py-3 rounded-xl font-bold hover:bg-slate-800 transition-colors"
            >
              Reintentar Quiz
            </button>
          </div>
        );
      }

      return (
        <section className="animate-in fade-in slide-in-from-bottom-4 duration-700">
          <header className="mb-12">
            <span className="text-blue-600 font-bold tracking-widest uppercase text-xs mb-2 block">CheckPoint</span>
            <h2 className="text-4xl font-extrabold text-slate-900 mb-2">Evaluación Rápida</h2>
            <p className="text-slate-500">Pregunta {currentQuestion + 1} de {questions.length}</p>
          </header>

          <div className="bg-white p-8 rounded-3xl shadow-lg border border-slate-100">
            <h3 className="text-xl font-bold text-slate-900 mb-8 leading-relaxed">
              {questions[currentQuestion].q}
            </h3>

            <div className="space-y-3">
              {questions[currentQuestion].options.map((opt, i) => (
                <button
                  key={i}
                  onClick={() => handleOptionClick(i)}
                  className={`w-full text-left p-4 rounded-xl border-2 font-medium transition-all flex justify-between items-center ${selectedOption === null
                      ? 'border-slate-100 hover:border-blue-500 hover:bg-blue-50'
                      : i === questions[currentQuestion].correct
                        ? 'border-green-500 bg-green-50 text-green-700'
                        : selectedOption === i
                          ? 'border-rose-500 bg-rose-50 text-rose-700'
                          : 'border-slate-50 opacity-50'
                    }`}
                >
                  {opt}
                  {selectedOption !== null && i === questions[currentQuestion].correct && <CheckCircle2 size={18} />}
                  {selectedOption === i && i !== questions[currentQuestion].correct && <AlertCircle size={18} />}
                </button>
              ))}
            </div>
          </div>
        </section>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);

  </script>
</body>

</html>