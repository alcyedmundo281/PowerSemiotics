<!DOCTYPE html>
<html class="light" lang="es">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>Módulo Educativo: ERGE | Power Semiotics</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;900&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>

  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Tailwind Configuration -->
  <script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#8B3DFF",
            "secondary": "#FF4081",
            "background-light": "#f6f7f8",
            "background-dark": "#101922",
            "surface-light": "#ffffff",
            "surface-dark": "#1a242d",
            "border-light": "#e2e8f0",
            "border-dark": "#2d3748",
          },
          fontFamily: {
            "display": ["Lexend", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.5rem",
            "lg": "0.75rem",
            "xl": "1rem",
            "full": "9999px"
          },
        },
      },
    }
  </script>

  <style>
    .gradient-text {
      background: linear-gradient(135deg, #8B3DFF 0%, #FF4081 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .tab-active {
      @apply border-primary text-primary font-bold border-b-2;
    }

    .tab-inactive {
      @apply border-transparent text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 border-b-2;
    }

    .fade-in {
      animation: fadeIn 0.4s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Custom radio styling */
    .sr-only-input {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    input[type="radio"]:checked+div {
      border-color: #8B3DFF;
      background-color: rgba(139, 61, 255, 0.05);
    }

    input[type="radio"]:checked+div .radio-circle {
      border-color: #8B3DFF;
      background-color: #8B3DFF;
    }
  </style>
</head>

<body
  class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 font-display transition-colors duration-200 min-h-screen">

  <!-- Top Navigation -->
  <header
    class="sticky top-0 z-50 flex items-center justify-between border-b border-border-light dark:border-border-dark bg-surface-light/80 dark:bg-surface-dark/80 backdrop-blur-md px-6 py-4 shadow-sm">
    <div class="flex items-center gap-4">
      <a href="../index.html" class="flex items-center gap-3">
        <div class="size-10 bg-primary flex items-center justify-center text-white font-bold text-xl rounded-lg">P</div>
        <h2 class="text-xl font-bold leading-tight tracking-tight gradient-text">Powersemiotics</h2>
      </a>
      <div class="hidden md:block h-6 w-px bg-slate-200 dark:bg-slate-700 mx-2"></div>
      <span class="hidden md:block text-xs font-bold text-primary uppercase tracking-widest">Gastroenterología</span>
    </div>
    <div class="flex items-center gap-6">
      <a href="../gastroenterologia.html"
        class="hidden md:flex text-sm font-semibold text-slate-600 dark:text-slate-400 hover:text-primary transition-colors">Hub</a>
      <button id="header-auth-btn" onclick="handleSignOut()"
        class="px-4 py-2 rounded-full bg-slate-900 dark:bg-slate-700 text-white text-sm font-bold shadow-md hover:bg-primary transition-all">
        Cerrar Sesión
      </button>
      <button
        class="flex size-10 cursor-pointer items-center justify-center rounded-lg bg-background-light dark:bg-border-dark text-slate-600 dark:text-slate-300 hover:bg-slate-200 transition-colors"
        onclick="document.documentElement.classList.toggle('dark')">
        <span class="material-symbols-outlined text-xl">dark_mode</span>
      </button>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav
    class="bg-surface-light dark:bg-surface-dark border-b border-border-light dark:border-border-dark sticky top-[73px] z-40">
    <div class="max-w-5xl mx-auto px-4">
      <div class="flex space-x-8 overflow-x-auto" id="tab-nav">
        <button onclick="switchTab('teoria')" id="btn-teoria"
          class="tab-active py-4 px-1 whitespace-nowrap text-sm flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">book_2</span>
          1. Guía de Conocimiento
        </button>
        <button onclick="switchTab('caso')" id="btn-caso"
          class="tab-inactive py-4 px-1 whitespace-nowrap text-sm flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">clinical_notes</span>
          2. Caso Clínico (ABP)
        </button>
        <button onclick="switchTab('evaluacion')" id="btn-evaluacion"
          class="tab-inactive py-4 px-1 whitespace-nowrap text-sm flex items-center gap-2">
          <span class="material-symbols-outlined text-lg">assignment_turned_in</span>
          3. Evaluación Final
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-5xl mx-auto px-4 py-12 pb-24">

    <!-- SECTION 1: THEORY -->
    <section id="teoria" class="fade-in space-y-10">
      <!-- Hero with Nano Banana Illustration -->
      <div
        class="bg-surface-light dark:bg-surface-dark rounded-3xl border border-border-light dark:border-border-dark shadow-xl overflow-hidden relative min-h-[400px] flex flex-col md:flex-row shadow-primary/5">
        <div class="p-10 md:w-1/2 flex flex-col justify-center relative z-10">
          <div class="inline-block px-3 py-1 bg-primary/10 rounded-full mb-4 self-start">
            <span class="text-xs font-bold text-primary uppercase tracking-widest">Mecanismos</span>
          </div>
          <h1 class="text-4xl md:text-5xl font-black leading-tight tracking-tight mb-6">Fisiopatología de la ERGE</h1>
          <p class="text-slate-500 dark:text-slate-400 font-medium leading-relaxed">
            La Enfermedad por Reflujo ocurre cuando el contenido gástrico regresa al esófago, causando síntomas molestos
            o complicaciones. Es una falla sistémica de la <span class="text-primary font-bold">barrera
              antirreflujo</span>.
          </p>
          <div class="grid grid-cols-2 gap-4 mt-8">
            <div
              class="bg-background-light dark:bg-background-dark p-4 rounded-2xl border border-border-light dark:border-border-dark">
              <span class="text-2xl font-black text-primary">15-20%</span>
              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Prevalencia Global</p>
            </div>
            <div
              class="bg-background-light dark:bg-background-dark p-4 rounded-2xl border border-border-light dark:border-border-dark">
              <span class="text-2xl font-black text-secondary">10%</span>
              <p class="text-[10px] font-bold text-slate-400 uppercase tracking-tighter">Riesgo Esófago Barrett</p>
            </div>
          </div>
        </div>
        <div class="md:w-1/2 relative min-h-[300px] bg-slate-900 overflow-hidden">
          <img src="../assets/erge-nano-banana.png" class="absolute inset-0 w-full h-full object-cover opacity-80"
            alt="Reflujo Gastroesofágico Nano Banana Animation">
          <div
            class="absolute inset-0 bg-gradient-to-r from-surface-light dark:from-surface-dark via-transparent to-transparent md:block hidden">
          </div>
          <div class="absolute bottom-6 left-6 right-6">
            <div class="bg-black/40 backdrop-blur-md p-4 rounded-xl border border-white/10">
              <p class="text-white text-xs leading-relaxed italic">"Visualización de la unión gastroesofágica y la
                incompetencia del EEI."</p>
            </div>
          </div>
        </div>
        <div class="absolute -top-24 -right-24 size-64 bg-primary/5 rounded-full blur-3xl pointer-events-none"></div>
      </div>

      <!-- Detailed content cards -->
      <div class="grid md:grid-cols-2 gap-8">
        <!-- Physio -->
        <div
          class="bg-surface-light dark:bg-surface-dark p-8 rounded-3xl border border-border-light dark:border-border-dark shadow-sm">
          <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
            <span
              class="material-symbols-outlined text-primary size-10 bg-primary/10 rounded-xl flex items-center justify-center">settings_suggest</span>
            La Barrera Rota
          </h3>
          <ul class="space-y-6">
            <li class="flex gap-4">
              <div
                class="size-6 bg-primary/20 text-primary flex-shrink-0 rounded-full flex items-center justify-center font-bold text-xs">
                1</div>
              <div>
                <h4 class="font-bold text-sm text-slate-900 dark:text-white uppercase tracking-wide">RTEEI</h4>
                <p class="text-sm text-slate-500 mt-1 leading-relaxed">Relajaciones Transitorias del Esfínter Esofágico
                  Inferior. Mecanismo principal.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <div
                class="size-6 bg-primary/20 text-primary flex-shrink-0 rounded-full flex items-center justify-center font-bold text-xs">
                2</div>
              <div>
                <h4 class="font-bold text-sm text-slate-900 dark:text-white uppercase tracking-wide">Hipotensión del EEI
                </h4>
                <p class="text-sm text-slate-500 mt-1 leading-relaxed">Presión basal < 10 mmHg.</p>
              </div>
            </li>
            <li class="flex gap-4">
              <div
                class="size-6 bg-primary/20 text-primary flex-shrink-0 rounded-full flex items-center justify-center font-bold text-xs">
                3</div>
              <div>
                <h4 class="font-bold text-sm text-slate-900 dark:text-white uppercase tracking-wide">Hernia Hiatal</h4>
                <p class="text-sm text-slate-500 mt-1 leading-relaxed">Desplaza la unión GE, alterando la válvula "flap"
                  mecánica.</p>
              </div>
            </li>
          </ul>
        </div>

        <!-- Phenotypes -->
        <div
          class="bg-surface-light dark:bg-surface-dark p-8 rounded-3xl border border-border-light dark:border-border-dark shadow-sm">
          <h3 class="text-xl font-bold mb-6 flex items-center gap-3">
            <span
              class="material-symbols-outlined text-secondary size-10 bg-secondary/10 rounded-xl flex items-center justify-center">category</span>
            Espectro Clínico
          </h3>
          <div class="space-y-4">
            <div
              class="p-4 bg-green-500/5 dark:bg-green-500/10 rounded-2xl border border-green-500/20 group hover:border-green-500/50 transition-all">
              <span class="text-[10px] font-black text-green-600 uppercase tracking-widest">ERNE</span>
              <h4 class="font-bold text-slate-900 dark:text-white">Reflujo No Erosivo</h4>
              <p class="text-xs text-slate-500 mt-1">Síntomas presentes sin daño visible en endoscopia (70%).</p>
            </div>
            <div
              class="p-4 bg-amber-500/5 dark:bg-amber-500/10 rounded-2xl border border-amber-500/20 group hover:border-amber-500/50 transition-all">
              <span class="text-[10px] font-black text-amber-600 uppercase tracking-widest">Esofagitis</span>
              <h4 class="font-bold text-slate-900 dark:text-white">Esofagitis Erosiva</h4>
              <p class="text-xs text-slate-500 mt-1">Daño mucoso evidente. Clasificación Los Angeles (A-D).</p>
            </div>
            <div
              class="p-4 bg-red-500/5 dark:bg-red-500/10 rounded-2xl border border-red-500/20 group hover:border-red-500/50 transition-all">
              <span class="text-[10px] font-black text-red-600 uppercase tracking-widest">Complicaciones</span>
              <h4 class="font-bold text-slate-900 dark:text-white">Barrett y Adenocarcinoma</h4>
              <p class="text-xs text-slate-500 mt-1">Metaplasia intestinal secundaria a injuria crónica.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Diagnostics Summary -->
      <div class="bg-slate-900 text-white rounded-[2.5rem] p-10 shadow-2xl relative overflow-hidden">
        <div class="absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-[100px]"></div>
        <div class="relative z-10 grid md:grid-cols-3 gap-12">
          <div class="space-y-4">
            <h4 class="text-primary font-black uppercase text-xs tracking-widest">Signos de Alarma</h4>
            <ul class="space-y-3 text-sm font-medium text-slate-300">
              <li class="flex items-center gap-2 text-secondary"><span
                  class="material-symbols-outlined text-sm">warning</span> Disfagia / Odinofagia</li>
              <li class="flex items-center gap-2"><span class="material-symbols-outlined text-sm">check_circle</span>
                Pérdida de peso</li>
              <li class="flex items-center gap-2 text-secondary"><span
                  class="material-symbols-outlined text-sm">emergency_home</span> Sangrado digestivo</li>
              <li class="flex items-center gap-2"><span class="material-symbols-outlined text-sm">check_circle</span>
                Anemia</li>
            </ul>
          </div>
          <div class="space-y-4">
            <h4 class="text-primary font-black uppercase text-xs tracking-widest">Diagnóstico Inicial</h4>
            <p class="text-sm text-slate-300 leading-relaxed italic">"En pacientes jóvenes sin signos de alarma, la
              prueba terapéutica con IBP es el primer paso."</p>
          </div>
          <div class="space-y-4">
            <h4 class="text-primary font-black uppercase text-xs tracking-widest">Gold Standard Dx</h4>
            <div class="bg-white/5 p-4 rounded-2xl border border-white/10 uppercase font-black text-center">
              <p class="text-lg">pH-metría</p>
              <p class="text-[9px] text-primary">con Impedanciometría</p>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center pt-8">
        <button onclick="switchTab('caso')"
          class="bg-primary hover:bg-secondary text-white font-bold py-4 px-10 rounded-xl shadow-lg shadow-primary/20 transition-all flex items-center justify-center gap-3 mx-auto group">
          <span>IR AL CASO CLÍNICO</span>
          <span class="material-symbols-outlined group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </button>
      </div>
    </section>

    <!-- SECTION 2: CLINICAL CASE -->
    <section id="caso" class="hidden fade-in space-y-8">
      <div
        class="bg-surface-light dark:bg-surface-dark p-10 rounded-3xl border border-border-light dark:border-border-dark shadow-sm">
        <div
          class="flex flex-col md:flex-row items-center gap-8 border-b border-border-light dark:border-border-dark pb-10 mb-10">
          <div
            class="size-24 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center ring-8 ring-primary/5">
            <span class="material-symbols-outlined text-5xl text-slate-400">person</span>
          </div>
          <div class="text-center md:text-left">
            <h2 class="text-3xl font-black mb-1">Paciente: Carlos</h2>
            <div class="flex flex-wrap justify-center md:justify-start gap-3 mt-2">
              <span class="px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-[10px] font-bold uppercase">45
                años</span>
              <span
                class="px-3 py-1 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full text-[10px] font-bold uppercase">IMC
                32 (Obesidad I)</span>
              <span
                class="px-3 py-1 bg-slate-100 dark:bg-slate-800 rounded-full text-[10px] font-bold uppercase">Fumador</span>
            </div>
          </div>
        </div>

        <!-- Interactive Timeline -->
        <div
          class="space-y-12 relative before:absolute before:left-[19px] before:top-4 before:bottom-4 before:w-0.5 before:bg-slate-200 dark:before:bg-slate-700">

          <!-- Phase 1 -->
          <div class="relative pl-12">
            <div
              class="absolute left-0 top-0 size-10 rounded-full bg-primary flex items-center justify-center text-white font-bold z-10 shadow-lg shadow-primary/20">
              1</div>
            <div
              class="bg-background-light dark:bg-background-dark p-6 rounded-2xl border border-border-light dark:border-border-dark group hover:border-primary/50 transition-all">
              <h3 class="font-black text-lg mb-2">Presentación Clínica</h3>
              <p class="text-sm text-slate-500 leading-relaxed italic border-l-4 border-primary pl-4 py-1">
                "Ardor en el pecho diario desde hace 6 meses. Empeora tras cenas copiosas y al acostarse. Tiene
                regurgitación ácida."
              </p>
              <div class="mt-4 flex items-center gap-2 text-xs font-bold text-green-600">
                <span class="material-symbols-outlined text-sm">verified_user</span>
                NIEGA DISFAGIA, PÉRDIDA DE PESO O SANGRADO.
              </div>
            </div>
          </div>

          <!-- Phase 2 -->
          <div class="relative pl-12">
            <div
              class="absolute left-0 top-0 size-10 rounded-full bg-secondary flex items-center justify-center text-white font-bold z-10 shadow-lg shadow-secondary/20">
              ?</div>
            <div class="bg-secondary/5 p-6 rounded-2xl border border-secondary/20 border-dashed">
              <h3 class="font-black text-lg text-secondary mb-2">Rincón del Razonamiento</h3>
              <p class="text-sm text-slate-600 dark:text-slate-400 mb-4 font-medium">¿Tiene signos de alarma? ¿Cuál es
                el manejo inicial recomendado?</p>

              <button onclick="toggleFeedback('feedback1')"
                class="text-xs bg-secondary hover:bg-primary text-white font-bold px-4 py-2 rounded-lg transition-all flex items-center gap-2">
                <span class="material-symbols-outlined text-base">visibility</span> REVELAR ANÁLISIS
              </button>

              <div id="feedback1"
                class="hidden mt-6 p-5 bg-surface-light dark:bg-surface-dark border border-secondary/20 rounded-xl text-sm fade-in">
                <p class="leading-relaxed">
                  <strong class="text-secondary">Análisis Profesional:</strong> Carlos presenta síntomas típicos
                  (pirosis + regurgitación) con factores de riesgo claros (obesidad, tabaco). <br><br>
                  <strong class="text-secondary">Signos de Alarma:</strong> Ausentes. <br>
                  <strong class="text-secondary">Manejo:</strong> No requiere endoscopia inicial. Se indica
                  <strong>Prueba Terapéutica con IBP</strong> por 8 semanas.
                </p>
              </div>
            </div>
          </div>

          <!-- Phase 3 -->
          <div class="relative pl-12">
            <div
              class="absolute left-0 top-0 size-10 rounded-full bg-green-500 flex items-center justify-center text-white font-bold z-10 shadow-lg shadow-green-500/20">
              3</div>
            <div
              class="bg-background-light dark:bg-background-dark p-6 rounded-2xl border border-border-light dark:border-border-dark">
              <h3 class="font-black text-lg mb-2 text-green-600">Evolución Clínica</h3>
              <p class="text-sm text-slate-500">Regresa tras 8 semanas con Omeprazol 20mg. Reporta mejoría del <span
                  class="text-green-600 font-bold">90%</span>.</p>

              <div class="mt-6 space-y-3">
                <p class="text-xs font-bold text-slate-400 uppercase">Decisión Terapéutica:</p>
                <div class="grid gap-2">
                  <button onclick="toggleFeedback('feedback2')"
                    class="p-3 text-left text-sm rounded-xl border border-border-light dark:border-border-dark hover:border-primary transition-all flex justify-between items-center group">
                    <span>Retirar IBP gradualmente / A demanda</span>
                    <span
                      class="material-symbols-outlined text-primary opacity-0 group-hover:opacity-100">task_alt</span>
                  </button>
                </div>
              </div>
              <div id="feedback2"
                class="hidden mt-4 text-xs font-bold text-green-600 bg-green-50 dark:bg-green-900/10 p-4 rounded-xl border border-green-500/20 fade-in">
                ¡CORRECTO! En ERNE o ERGE no complicada que responde, el objetivo es la dosis mínima efectiva o retiro
                gradual. No requiere EDA de control.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="text-center pt-8">
        <button onclick="switchTab('evaluacion')"
          class="bg-primary hover:bg-secondary text-white font-bold py-4 px-10 rounded-xl shadow-lg transition-all flex items-center justify-center gap-3 mx-auto">
          <span>FINALIZAR EVALUACIÓN</span>
          <span class="material-symbols-outlined">send</span>
        </button>
      </div>
    </section>

    <!-- SECTION 3: EVALUATION -->
    <section id="evaluacion" class="hidden fade-in max-w-3xl mx-auto space-y-8">
      <div
        class="bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark rounded-[2.5rem] shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-primary to-secondary p-10 text-white text-center relative overflow-hidden">
          <div class="absolute -top-10 -right-10 size-40 bg-white/10 rounded-full blur-2xl"></div>
          <h2 class="text-3xl font-black mb-2">Evaluación Final</h2>
          <p class="text-white/70 text-sm font-medium">Demuestra tu conocimiento y completa el módulo.</p>
        </div>

        <form id="quizForm" class="p-10 space-y-10">
          <!-- Session Data -->
          <div
            class="grid gap-6 p-6 bg-slate-50 dark:bg-slate-800/50 rounded-3xl border border-border-light dark:border-border-dark">
            <div class="grid md:grid-cols-2 gap-4">
              <div>
                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Nombre
                  Completo</label>
                <input type="text" id="studentName" required
                  class="w-full bg-white dark:bg-surface-dark border-border-light dark:border-border-dark rounded-xl px-4 py-3 focus:ring-primary focus:border-primary transition-all text-sm outline-none"
                  placeholder="Tu nombre">
              </div>
              <div>
                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Email
                  Institucional</label>
                <input type="email" id="studentEmail" required
                  class="w-full bg-white dark:bg-surface-dark border-border-light dark:border-border-dark rounded-xl px-4 py-3 focus:ring-primary focus:border-primary transition-all text-sm outline-none"
                  placeholder="correo@universidad.edu">
              </div>
            </div>
          </div>

          <!-- Question Loop Template -->
          <div id="quiz-container" class="space-y-10">
            <!-- Questions will be dynamically enhanced but let's keep it static for stability -->
            <div class="quiz-item">
              <p class="font-bold text-lg mb-6 leading-tight flex gap-3">
                <span
                  class="size-6 bg-primary/10 text-primary flex items-center justify-center rounded-full text-xs flex-shrink-0 mt-1">1</span>
                1. Hombre de 45 años, obeso, con ardor retroesternal postprandial que empeora al acostarse. ¿Cuál es el
                mecanismo fisiopatológico primario?
              </p>
              <div class="grid gap-3">
                <label class="relative cursor-pointer group">
                  <input class="sr-only-input" name="q1" type="radio" value="A">
                  <div
                    class="flex items-center gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50 group-hover:border-primary/50 transition-all">
                    <div
                      class="size-5 rounded-full border-2 border-slate-300 dark:border-slate-500 radio-circle flex items-center justify-center transition-all">
                    </div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">A) Hipersecreción de ácido por
                      gastrinoma.</span>
                  </div>
                </label>
                <label class="relative cursor-pointer group">
                  <input class="sr-only-input" name="q1" type="radio" value="B">
                  <div
                    class="flex items-center gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50 group-hover:border-primary/50 transition-all">
                    <div
                      class="size-5 rounded-full border-2 border-slate-300 dark:border-slate-500 radio-circle flex items-center justify-center transition-all">
                    </div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">B) Infección por H.
                      pylori.</span>
                  </div>
                </label>
                <label class="relative cursor-pointer group">
                  <input class="sr-only-input" name="q1" type="radio" value="C">
                  <div
                    class="flex items-center gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50 group-hover:border-primary/50 transition-all">
                    <div
                      class="size-5 rounded-full border-2 border-slate-300 dark:border-slate-500 radio-circle flex items-center justify-center transition-all">
                    </div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">C) Relajaciones transitorias
                      del EEI (RTEEI).</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- ... Rest of questions follow same pattern ... -->
            <div class="quiz-item">
              <p class="font-bold text-lg mb-6 leading-tight flex gap-3">
                <span
                  class="size-6 bg-primary/10 text-primary flex items-center justify-center rounded-full text-xs flex-shrink-0 mt-1">2</span>
                2. Mujer de 52 años, hipertensa y diabética, con dolor retroesternal urente hace 2 horas. ¿Cuál es el
                paso inicial MÁS apropiado?
              </p>
              <div class="grid gap-3">
                <label class="relative cursor-pointer group">
                  <input class="sr-only-input" name="q2" type="radio" value="A">
                  <div
                    class="flex items-center gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50 group-hover:border-primary/50 transition-all">
                    <div
                      class="size-5 rounded-full border-2 border-slate-300 dark:border-slate-500 radio-circle flex items-center justify-center transition-all">
                    </div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">A) Endoscopia digestiva alta
                      inmediata.</span>
                  </div>
                </label>
                <label class="relative cursor-pointer group">
                  <input class="sr-only-input" name="q2" type="radio" value="C">
                  <div
                    class="flex items-center gap-4 p-4 rounded-xl border border-border-light dark:border-border-dark bg-slate-50 dark:bg-slate-800/50 group-hover:border-primary/50 transition-all">
                    <div
                      class="size-5 rounded-full border-2 border-slate-300 dark:border-slate-500 radio-circle flex items-center justify-center transition-all">
                    </div>
                    <span class="text-sm font-medium text-slate-600 dark:text-slate-300">C) Realizar un
                      Electrocardiograma (ECG).</span>
                  </div>
                </label>
              </div>
            </div>

            <div id="resultMessage" class="hidden p-6 rounded-2xl text-center font-bold fade-in"></div>

            <button type="submit" id="submitBtn"
              class="w-full bg-slate-900 dark:bg-primary hover:bg-primary dark:hover:bg-secondary text-white font-black py-4 rounded-2xl shadow-xl transition-all flex justify-center items-center gap-3 group">
              <span>ENVIAR EVALUACIÓN</span>
              <span class="material-symbols-outlined group-hover:rotate-12 transition-transform">send</span>
            </button>
          </div>
        </form>
      </div>
    </section>

  </main>

  <footer
    class="bg-surface-light dark:bg-surface-dark border-t border-border-light dark:border-border-dark py-12 text-center">
    <div class="max-w-5xl mx-auto px-6 flex flex-col items-center gap-4">
      <div class="flex items-center gap-2">
        <div class="size-6 bg-primary rounded-md"></div>
        <span class="font-black text-slate-900 dark:text-white">Powersemiotics</span>
      </div>
      <p class="text-slate-400 text-xs font-medium uppercase tracking-[0.2em]">© 2025 Gastroenterología Clínica de Alto
        Nivel</p>
    </div>
  </footer>

  <!-- LOGIC SCRIPT -->
  <script>
    // Supabase Init
    var supabaseClient = null;
    var SUPABASE_URL_VAL = 'https://dyfjawopnbkjrjsnhbyn.supabase.co';
    var SUPABASE_KEY_VAL = 'sb_publishable_9fyCTrHL9ArHojgrTMSX1A_UlwZSOCa';

    try {
      if (typeof window.supabase !== 'undefined') {
        supabaseClient = window.supabase.createClient(SUPABASE_URL_VAL, SUPABASE_KEY_VAL);
      }
    } catch (e) { console.error("Error init Supabase", e); }

    async function handleSignOut() {
      if (!supabaseClient) return;
      await supabaseClient.auth.signOut();
      window.location.href = '../gastroenterologia.html';
    }

    async function checkSession() {
      if (!supabaseClient) return;
      const { data: { session } } = await supabaseClient.auth.getSession();
      if (!session) {
        window.location.href = '../gastroenterologia.html';
        return;
      }
      const emailInput = document.getElementById('studentEmail');
      if (emailInput && session.user.email) {
        emailInput.value = session.user.email;
        emailInput.readOnly = true;
        emailInput.classList.add('bg-slate-100', 'dark:bg-slate-800', 'cursor-not-allowed', 'text-slate-400');
      }
    }

    checkSession();

    window.switchTab = function (tabId) {
      document.getElementById('teoria').classList.add('hidden');
      document.getElementById('caso').classList.add('hidden');
      document.getElementById('evaluacion').classList.add('hidden');
      document.getElementById(tabId).classList.remove('hidden');

      ['teoria', 'caso', 'evaluacion'].forEach(id => {
        const btn = document.getElementById('btn-' + id);
        if (btn) btn.className = (id === tabId) ? 'tab-active py-4 px-1 whitespace-nowrap text-sm flex items-center gap-2' : 'tab-inactive py-4 px-1 whitespace-nowrap text-sm flex items-center gap-2';
      });
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    window.toggleFeedback = function (id) {
      const el = document.getElementById(id);
      if (el) el.classList.toggle('hidden');
    }

    const correctAnswers = { q1: 'C', q2: 'C' };

    document.getElementById('quizForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const btn = document.getElementById('submitBtn');
      const resultDiv = document.getElementById('resultMessage');

      btn.disabled = true;
      btn.innerHTML = '<span class="material-symbols-outlined animate-spin">sync</span> Procesando...';

      let score = 0;
      let userAnswers = {};
      const formData = new FormData(this);

      for (let [key, value] of formData.entries()) {
        if (key.startsWith('q')) {
          userAnswers[key] = value;
          if (value === correctAnswers[key]) score++;
        }
      }

      const name = document.getElementById('studentName').value;
      const email = document.getElementById('studentEmail').value;
      const finalScore = (score / 2) * 100;

      resultDiv.classList.remove('hidden');
      if (finalScore >= 80) {
        resultDiv.className = "p-6 rounded-2xl text-center font-bold bg-green-500/10 text-green-600 border border-green-500/20";
        resultDiv.innerHTML = `<p class="text-2xl mb-1">¡Excelente!</p><p class="text-sm italic">Puntaje: ${finalScore}%</p>`;
      } else {
        resultDiv.className = "p-6 rounded-2xl text-center font-bold bg-amber-500/10 text-amber-600 border border-amber-500/20";
        resultDiv.innerHTML = `<p class="text-2xl mb-1">Casi lo logras</p><p class="text-sm italic">Puntaje: ${finalScore}%. Revisa la teoría.</p>`;
      }

      if (supabaseClient) {
        try {
          await supabaseClient.from('evaluaciones_erge').insert([{ nombre: name, email: email, respuestas: userAnswers, score: finalScore, created_at: new Date() }]);
        } catch (err) { console.error("Error Supabase:", err); }
      }
      btn.innerHTML = 'Enviado con éxito';
    });
  </script>
</body>

</html>