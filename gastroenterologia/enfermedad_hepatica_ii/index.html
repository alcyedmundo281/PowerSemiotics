<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a de Estudio: Enfermedad Hep√°tica</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-link {
            transition: all 0.2s ease-in-out;
        }
        .sidebar-link.active {
            background-color: #1D4ED8; /* bg-blue-700 */
            color: white;
            font-weight: 600;
        }
        .quiz-option {
            transition: all 0.2s ease-in-out;
            border: 2px solid transparent;
        }
        .quiz-option:hover:not([disabled]) {
            border-color: #3B82F6; /* border-blue-500 */
        }
        .quiz-option.selected {
            border-color: #1D4ED8; /* border-blue-700 */
            background-color: #DBEAFE; /* bg-blue-100 */
        }
        .quiz-option.correct {
            background-color: #D1FAE5 !important; /* bg-green-100 */
            border-color: #10B981 !important; /* border-green-500 */
            color: #065F46; /* text-green-800 */
        }
        .quiz-option.incorrect {
            background-color: #FEE2E2 !important; /* bg-red-100 */
            border-color: #EF4444 !important; /* border-red-500 */
            color: #991B1B; /* text-red-800 */
        }
        .quiz-option[disabled] {
            cursor: not-allowed;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Estilos para la presentaci√≥n y el simulador */
        .embedded-content-container {
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .text-guide h3 {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e3a8a; /* text-blue-900 */
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }
        .text-guide h4 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827; /* text-gray-900 */
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
        }
        .text-guide p, .text-guide li {
            color: #374151; /* text-gray-700 */
            margin-bottom: 0.75rem;
        }
        .text-guide ul {
            list-style-type: disc;
            padding-left: 1.5rem;
        }
        .text-guide .highlight-box {
            background-color: #eff6ff; /* bg-blue-50 */
            border-left: 4px solid #3b82f6; /* border-blue-500 */
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-full md:w-64 bg-gray-800 text-white p-6 md:p-4 space-y-2 flex-shrink-0">
            <h1 class="text-2xl font-bold mb-4 text-center">PowerSemiotics</h1>
            <h2 class="text-lg font-semibold mb-4 text-center text-gray-300">Enfermedad Hep√°tica</h2>
            <nav id="navigation-menu">
                <!-- Los enlaces se generan din√°micamente -->
            </nav>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
            <!-- El contenido se genera din√°micamente -->
        </main>
    </div>

    <script>
        // Funci√≥n global para ser llamada desde el HTML
        window.checkAnswer = (sectionIndex, questionIndex, selectedOptionIndex) => {
            const quizData = studyGuideData[sectionIndex].quizzes[questionIndex];
            const feedbackId = `feedback-${sectionIndex}-${questionIndex}`;
            
            const feedbackEl = document.getElementById(feedbackId);
            const quizContainer = feedbackEl.closest('.quiz-container');
            const options = quizContainer.querySelectorAll('.quiz-option');

            // Deshabilitar todos los botones para esta pregunta
            options.forEach(button => button.disabled = true);
            
            const selectedButton = options[selectedOptionIndex];
            
            if (selectedOptionIndex === quizData.correct) {
                selectedButton.classList.add('correct');
                feedbackEl.innerHTML = `<strong>¬°Correcto!</strong> ${quizData.feedback}`;
                feedbackEl.className = 'mt-4 text-sm p-4 rounded-lg bg-green-100 text-green-800 animate-fade-in';
            } else {
                selectedButton.classList.add('incorrect');
                options[quizData.correct].classList.add('correct');
                feedbackEl.innerHTML = `<strong>Incorrecto.</strong> La respuesta correcta se ha resaltado en verde. ${quizData.feedback}`;
                feedbackEl.className = 'mt-4 text-sm p-4 rounded-lg bg-red-100 text-red-800 animate-fade-in';
            }
        };

        const studyGuideData = [
            {
                id: 'intro',
                title: 'Bienvenida',
                content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Gu√≠a de Estudio Interactiva: Enfermedad Hep√°tica</h2>
                        <p class="text-lg text-gray-600 mb-6">Este recurso unificado est√° dise√±ado para ser tu compa√±ero de estudio principal para las semanas 10 y 11. Aqu√≠ encontrar√°s todo lo que necesitas, desde la presentaci√≥n de clase hasta un simulador y una autoevaluaci√≥n.</p>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-blue-800">¬øC√≥mo usar este recurso?</h4>
                            <ul class="list-disc list-inside mt-2 text-blue-700">
                                <li><strong>Presentaci√≥n de Clase:</strong> √ösala para seguir la clase o como una revisi√≥n visual r√°pida de los temas.</li>
                                <li><strong>Simulador Cl√≠nico:</strong> ¬°Ponte a prueba! Aplica tus conocimientos para manejar una emergencia m√©dica en un entorno seguro.</li>
                                <li><strong>Autoevaluaci√≥n Final:</strong> Eval√∫a tu comprensi√≥n con casos cl√≠nicos y obt√©n retroalimentaci√≥n detallada.</li>
                                <li><strong>Texto Gu√≠a (Repaso):</strong> Consulta el material de lectura detallado para profundizar y repasar los conceptos despu√©s de clase.</li>
                            </ul>
                        </div>
                        <p class="mt-6 text-gray-600">Usa el men√∫ de la izquierda para navegar entre las diferentes herramientas. ¬°√âxitos en tu estudio!</p>
                    </div>
                `
            },
            {
                id: 'presentacion',
                title: '1. Presentaci√≥n de Clase',
                content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Presentaci√≥n: Enfermedad Hep√°tica II y III</h2>
                        <div id="presentation-content" class="embedded-content-container"></div>
                    </div>
                `,
                script: 'presentationScript'
            },
            {
                id: 'simulador',
                title: '2. Simulador Cl√≠nico (HVA)',
                content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Simulador: Manejo de Hemorragia Variceal Aguda</h2>
                        <div id="simulator-content" class="embedded-content-container"></div>
                    </div>
                `,
                script: 'simulatorScript'
            },
            {
                id: 'autoevaluacion',
                title: '3. Autoevaluaci√≥n Final',
                content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h3 class="text-3xl font-bold text-gray-800 mb-2">üöÄ Autoevaluaci√≥n Final</h3>
                        <p class="text-gray-600 mb-6">Es hora de conectar todos los puntos. Responde a los siguientes casos cl√≠nicos para evaluar tu dominio del tema.</p>
                        <div class="quiz-container space-y-6">
                            <!-- El quiz se genera din√°micamente -->
                        </div>
                    </div>
                `,
                quizzes: [
                    {
                        question: "1. Un agricultor de 45 a√±os, de Morona Santiago, acude por astenia. Laboratorio: ALT 85 U/L. Perfil viral: HBsAg (+), Anti-HBc total (+), Anti-HBc IgM (-), HBeAg (-), Anti-HBe (+). ¬øCu√°l es el siguiente paso M√ÅS apropiado?",
                        options: [
                            "Iniciar Tenofovir inmediatamente.",
                            "Solicitar carga viral (ADN-VHB) y repetir transaminasas.",
                            "Asegurar que es un portador inactivo y dar seguimiento anual.",
                            "Solicitar ecograf√≠a para descartar esteatosis."
                        ],
                        correct: 1,
                        feedback: "Correcto. El paciente tiene una hepatitis B cr√≥nica HBeAg-negativa. Para diferenciar si est√° en la fase inmunoactiva (que requiere tratamiento) o es un portador inactivo, es indispensable conocer el nivel de ADN-VHB y confirmar la persistencia de la elevaci√≥n de ALT."
                    },
                    {
                        question: "2. Una mujer de 32 a√±os en su semana 28 de gestaci√≥n es HBsAg (+). Ex√°menes: HBeAg (+), ALT 30 U/L y carga viral de 500,000 UI/mL. ¬øCu√°l es la conducta M√ÅS adecuada?",
                        options: [
                            "Iniciar Tenofovir a la madre y planificar vacuna + HBIg al reci√©n nacido.",
                            "Recomendar ces√°rea electiva.",
                            "Administrar √∫nicamente la vacuna al reci√©n nacido.",
                            "Suspender la lactancia materna."
                        ],
                        correct: 0,
                        feedback: "Correcto. Con una carga viral >200,000 UI/mL, est√° indicada la terapia antiviral en el tercer trimestre para reducir la transmisi√≥n, adem√°s de la inmunoprofilaxis completa (activa y pasiva) al neonato."
                    },
                    {
                        question: "3. Paciente de 62 a√±os con cirrosis (Child-Pugh B8) llega a emergencias por hematemesis. PA 85/50, FC 115 lpm. Adem√°s de la resucitaci√≥n, ¬øqu√© f√°rmacos debe administrar INMEDIATAMENTE?",
                        options: [
                            "Omeprazol IV y Metoclopramida IV.",
                            "Furosemida IV y Lactulosa.",
                            "Terlipresina IV y Ceftriaxona IV.",
                            "Alb√∫mina humana IV y Vitamina K IV."
                        ],
                        correct: 2,
                        feedback: "Correcto. El manejo inicial de la HVA se basa en resucitaci√≥n, f√°rmacos vasoactivos (Terlipresina) para reducir la presi√≥n portal y profilaxis antibi√≥tica (Ceftriaxona) para prevenir infecciones, que son un gatillo de resangrado."
                    },
                    {
                        question: "4. Paciente de 68 a√±os con cirrosis alcoh√≥lica (Child C11) es hospitalizado por encefalopat√≠a. Tiene fiebre, disuria y ascitis. ¬øCu√°l es el factor precipitante M√ÅS probable y c√≥mo lo confirma?",
                        options: [
                            "Estre√±imiento / Tacto rectal.",
                            "Hemorragia digestiva oculta / Sangre oculta en heces.",
                            "Infecci√≥n (PBE o ITU) / Paracentesis diagn√≥stica y examen de orina.",
                            "Exceso de prote√≠nas / Niveles de amonio."
                        ],
                        correct: 2,
                        feedback: "Correcto. La infecci√≥n es uno de los precipitantes m√°s comunes y graves de EH. Ante un paciente con ascitis, fiebre y encefalopat√≠a, es mandatorio descartar PBE mediante una paracentesis."
                    },
                    {
                        question: "5. Paciente de 55 a√±os con cirrosis por VHB (Child-Pugh A5) acude a su control semestral. ¬øCu√°l es la indicaci√≥n de VIGILANCIA m√°s importante para la detecci√≥n temprana de CHC?",
                        options: [
                            "Alfa-fetoprote√≠na (AFP) s√©rica cada 6 meses.",
                            "TC de abdomen con contraste anualmente.",
                            "Ecograf√≠a abdominal cada 6 meses.",
                            "Endoscopia digestiva alta cada 2 a√±os."
                        ],
                        correct: 2,
                        feedback: "Correcto. La piedra angular de la vigilancia del carcinoma hepatocelular en todos los pacientes con cirrosis es la ecograf√≠a abdominal cada 6 meses. La AFP es un complemento, pero no la reemplaza."
                    }
                ]
            },
            {
                id: 'texto-guia',
                title: '4. Texto Gu√≠a (Repaso)',
                content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in text-guide">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Material de Lectura Detallado</h2>
                        
                        <h3>Hepatitis Virales Cr√≥nicas en Ecuador: VHB y VHC</h3>
                        <h4>Panorama Epidemiol√≥gico Nacional</h4>
                        <p>Las hepatitis virales son un problema de salud p√∫blica global y nacional. En Ecuador, la vigilancia epidemiol√≥gica es clave para la sospecha cl√≠nica:</p>
                        <ul>
                            <li><strong>Hepatitis B (VHB):</strong> La prevalencia general es baja (<2%), pero existen focos de endemicidad intermedia (2-7%) en la <strong>cuenca Amaz√≥nica</strong>. El genotipo predominante es el F. El grupo m√°s afectado es el de 20 a 49 a√±os.</li>
                            <li><strong>Hepatitis C (VHC):</strong> La mayor√≠a de los infectados no conocen su diagn√≥stico. El MSP promueve activamente el tamizaje y tratamiento.</li>
                        </ul>
                        
                        <h4>Diagn√≥stico y Estratificaci√≥n de la Hepatitis B Cr√≥nica (VHB)</h4>
                        <p>La cronicidad se define por la persistencia del <strong>HBsAg por m√°s de 6 meses</strong>. Una vez confirmada, se debe estratificar la fase de la enfermedad para decidir el manejo, usando HBeAg, Anti-HBe, ALT y carga viral (ADN-VHB).</p>
                        <div class="highlight-box">
                            <strong>Fases de la Infecci√≥n Cr√≥nica por VHB:</strong>
                            <ul>
                                <li><strong>Inmunotolerancia:</strong> Alta carga viral, ALT normal. Se vigila.</li>
                                <li><strong>Inmunoactiva (HBeAg+ o HBeAg-):</strong> Carga viral elevada y ALT elevada. <strong>Requiere tratamiento.</strong></li>
                                <li><strong>Portador Inactivo:</strong> Carga viral baja (<2,000 UI/mL), ALT normal. Se vigila.</li>
                            </ul>
                        </div>

                        <h3>Cirrosis Hep√°tica: Diagn√≥stico y Pron√≥stico</h3>
                        <h4>Diagn√≥stico</h4>
                        <p>La cirrosis es el estadio final de m√∫ltiples hepatopat√≠as. Se diagnostica por una combinaci√≥n de hallazgos:</p>
                        <ul>
                            <li><strong>Cl√≠nicos:</strong> Estigmas de hepatopat√≠a (ictericia, ara√±as vasculares, eritema palmar).</li>
                            <li><strong>Laboratorio:</strong> Trombocitopenia (a menudo el primer signo), hipoalbuminemia, INR prolongado.</li>
                            <li><strong>Imagen (Ecograf√≠a):</strong> H√≠gado de contornos nodulares, esplenomegalia, ascitis.</li>
                        </ul>
                        <h4>Escalas Pron√≥sticas: Child-Pugh y MELD</h4>
                        <p>Son herramientas esenciales para estratificar la severidad.</p>
                        <ul>
                            <li><strong>Child-Pugh:</strong> Eval√∫a 5 par√°metros (Bilirrubina, Alb√∫mina, Ascitis, Encefalopat√≠a, INR). Clasifica la cirrosis en Clase A (compensada), B (compromiso funcional) y C (descompensada). Es √∫til para la evaluaci√≥n cl√≠nica global.</li>
                            <li><strong>MELD:</strong> Usa Bilirrubina, INR y Creatinina. Predice la mortalidad a 90 d√≠as y se usa para priorizar en listas de trasplante hep√°tico.</li>
                        </ul>

                        <h3>Manejo de las Complicaciones Mayores</h3>
                        <h4>Hemorragia Variceal Aguda (HVA)</h4>
                        <p>Es una emergencia m√©dica con alta mortalidad. El manejo inicial es crucial.</p>
                        <div class="highlight-box">
                            <strong>Protocolo "C√≥digo HVA":</strong>
                            <ol class="list-decimal list-inside">
                                <li><strong>Estabilizaci√≥n Hemodin√°mica:</strong> 2 v√≠as IV gruesas, resucitaci√≥n con cristaloides.</li>
                                <li><strong>Transfusi√≥n Restrictiva:</strong> Objetivo de Hb 7-8 g/dL. ¬°Evitar sobretransfusi√≥n!</li>
                                <li><strong>F√°rmacos Inmediatos:</strong> Terlipresina (vasoactivo) + Ceftriaxona (antibi√≥tico profil√°ctico).</li>
                                <li><strong>Endoscopia Urgente (<12h):</strong> Para realizar ligadura con bandas.</li>
                            </ol>
                        </div>

                        <h4>Ascitis y Peritonitis Bacteriana Espont√°nea (PBE)</h4>
                        <ul>
                            <li><strong>Ascitis:</strong> Se maneja con restricci√≥n de sodio y diur√©ticos (Espironolactona ¬± Furosemida). Un GASA ‚â• 1.1 g/dL confirma hipertensi√≥n portal.</li>
                            <li><strong>PBE:</strong> Es la infecci√≥n del l√≠quido asc√≠tico. Se sospecha ante fiebre, dolor o encefalopat√≠a. El diagn√≥stico se hace con una paracentesis que muestre un recuento de Polimorfonucleares (PMN) ‚â• 250/mm¬≥. El tratamiento es con cefalosporinas de 3¬™ generaci√≥n.</li>
                        </ul>

                        <h4>Encefalopat√≠a Hep√°tica (EH)</h4>
                        <p>Es una disfunci√≥n cerebral por insuficiencia hep√°tica. Es un diagn√≥stico de exclusi√≥n.</p>
                        <div class="highlight-box">
                            <strong>Manejo de la EH:</strong>
                            <ol class="list-decimal list-inside">
                                <li><strong>¬°Buscar y tratar el factor precipitante!</strong> Es el paso m√°s importante (infecciones, HDA, deshidrataci√≥n, f√°rmacos).</li>
                                <li><strong>Terapia para reducir el amonio:</strong> Lactulosa es la primera l√≠nea, con el objetivo de lograr 2-3 deposiciones blandas al d√≠a.</li>
                            </ol>
                        </div>
                        
                        <h4>Carcinoma Hepatocelular (CHC)</h4>
                        <p>Es la consecuencia m√°s temida a largo plazo. La detecci√≥n temprana es la √∫nica opci√≥n curativa.</p>
                        <ul>
                            <li><strong>Poblaci√≥n de Riesgo:</strong> TODOS los pacientes con cirrosis.</li>
                            <li><strong>Protocolo de Vigilancia:</strong> Ecograf√≠a abdominal cada 6 meses. Es una responsabilidad del m√©dico general asegurar su cumplimiento.</li>
                        </ul>
                    </div>
                `
            }
        ];

        // Contenido de los componentes externos
        const presentationScript = () => {
            const container = document.getElementById('presentation-content');
            container.innerHTML = `
                <style>
                    .slider-container { width: 100%; position: relative; border: 1px solid #ddd; box-shadow: 0 4px 8px rgba(0,0,0,0.1); background-color: white; overflow: hidden; border-radius: 0.5rem;}
                    .slide { display: none; padding: 20px 30px; min-height: 450px; }
                    .slide.active { display: block; }
                    .slide h1, .slide h2, .slide h3 { color: #00568c; }
                    .slide h1 { font-size: 1.8em; text-align: center; border-bottom: 2px solid #00568c; padding-bottom: 10px; margin-bottom: 20px; }
                    .slide h2 { font-size: 1.5em; margin-top: 20px; }
                    .slide h3 { font-size: 1.2em; color: #007b9e; }
                    .slide p, .slide li { line-height: 1.6; font-size: 1em; }
                    .slide ul { list-style-type: disc; padding-left: 20px; }
                    .slide .navigation { display: flex; justify-content: space-between; padding: 15px; background-color: #00568c; position: absolute; bottom: 0; left: 0; right: 0; }
                    .slide .nav-button { background-color: #007b9e; color: white; border: none; padding: 8px 16px; font-size: 1em; cursor: pointer; border-radius: 5px; transition: background-color 0.3s; }
                    .slide .nav-button:hover { background-color: #009acd; }
                    .slide .slide-counter { color: white; font-size: 1.1em; align-self: center; }
                    .slide .highlight { background-color: #e7f5ff; border-left: 5px solid #007b9e; padding: 10px; margin: 15px 0; border-radius: 5px; }
                    .slide .ecuador-focus { border: 2px solid #fec107; padding: 10px; background-color: #fffbeb; border-radius: 8px; margin-top: 15px; }
                </style>
                <div class="slider-container">
                    <!-- Slides -->
                    <div class="slide active"><h1>Enfermedad Hep√°tica II y III</h1><h2>Semanas 10 y 11</h2><div class="highlight"><p><strong>Objetivo:</strong> Capacitar al futuro m√©dico general en el diagn√≥stico, estratificaci√≥n y manejo de la enfermedad hep√°tica cr√≥nica y sus complicaciones.</p></div></div>
                    <div class="slide"><h2>Hepatitis Virales Cr√≥nicas en Ecuador</h2><div class="ecuador-focus"><h3>Enfoque Ecuador</h3><ul><li><strong>Hepatitis B:</strong> Focos de endemicidad intermedia (2-7%) en la cuenca amaz√≥nica.</li><li><strong>Genotipo VHB:</strong> Predominante es el Genotipo F (96%).</li></ul></div></div>
                    <div class="slide"><h2>Fases de la Infecci√≥n Cr√≥nica por VHB</h2><ul><li><strong>Inmunotolerancia:</strong> Alta carga viral, ALT normal.</li><li><strong>Inmunoactiva:</strong> Alta carga viral, ALT elevada. <strong>Requiere tratamiento.</strong></li><li><strong>Portador Inactivo:</strong> Baja carga viral, ALT normal.</li><li><strong>Hepatitis Cr√≥nica HBeAg-negativo:</strong> Carga viral >2,000 UI/mL, ALT elevada. <strong>Requiere tratamiento.</strong></li></ul></div>
                    <div class="slide"><h2>Cirrosis: Diagn√≥stico y Pron√≥stico</h2><h3>Hallazgos Clave</h3><ul><li><strong>Laboratorio:</strong> Trombocitopenia (primer signo), hipoalbuminemia, INR prolongado.</li><li><strong>Imagen (Eco):</strong> H√≠gado nodular, esplenomegalia, ascitis.</li></ul><h3>Escalas Pron√≥sticas</h3><p><strong>Child-Pugh:</strong> Eval√∫a severidad global. <strong>MELD:</strong> Predice mortalidad a 90 d√≠as.</p></div>
                    <div class="slide"><h2>Hemorragia Variceal Aguda (HVA)</h2><h3>Protocolo "C√≥digo HVA"</h3><ol><li>Estabilizaci√≥n Hemodin√°mica</li><li>Transfusi√≥n Restrictiva (Hb 7-8 g/dL)</li><li>F√°rmacos: Terlipresina + Ceftriaxona</li><li>Endoscopia Urgente (<12h)</li></ol></div>
                    <div class="slide"><h2>Otras Complicaciones</h2><h3>Ascitis y PBE</h3><ul><li><strong>GASA ‚â• 1.1 g/dL</strong> indica hipertensi√≥n portal.</li><li><strong>PBE:</strong> PMN ‚â• 250/mm¬≥ en l√≠quido asc√≠tico. Tto: Cefalosporinas de 3ra gen.</li></ul><h3>Encefalopat√≠a Hep√°tica (EH)</h3><p><strong>Manejo:</strong> 1. Buscar y tratar el factor precipitante. 2. Lactulosa.</p></div>
                    <div class="slide"><h2>Carcinoma Hepatocelular (CHC)</h2><h3>Vigilancia y Diagn√≥stico</h3><ul><li><strong>Poblaci√≥n de Riesgo:</strong> TODOS los pacientes con cirrosis.</li><li><strong>Protocolo:</strong> Ecograf√≠a abdominal cada 6 meses.</li></ul></div>
                    <!-- Navigation -->
                    <div class="navigation"><button id="prevBtn" class="nav-button">Anterior</button><div id="slideCounter" class="slide-counter"></div><button id="nextBtn" class="nav-button">Siguiente</button></div>
                </div>
            `;
            const slides = container.querySelectorAll('.slide');
            const prevBtn = container.querySelector('#prevBtn');
            const nextBtn = container.querySelector('#nextBtn');
            const slideCounter = container.querySelector('#slideCounter');
            let currentSlide = 0;

            function showSlide(n) {
                slides.forEach(slide => slide.classList.remove('active'));
                slides[n].classList.add('active');
                currentSlide = n;
                slideCounter.textContent = `Diapositiva ${currentSlide + 1} de ${slides.length}`;
            }
            nextBtn.addEventListener('click', () => { if (currentSlide < slides.length - 1) showSlide(currentSlide + 1); });
            prevBtn.addEventListener('click', () => { if (currentSlide > 0) showSlide(currentSlide - 1); });
            showSlide(0);
        };

        const simulatorScript = () => {
            const container = document.getElementById('simulator-content');
            container.innerHTML = `
                <style>
                    #game-container { width: 100%; background-color: white; border-radius: 10px; padding: 20px; border-top: 8px solid #c0392b;}
                    #scenario-text-sim { font-size: 1.1em; line-height: 1.6; margin-bottom: 20px; border-left: 4px solid #3498db; padding-left: 15px; }
                    #vitals-display-sim { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin-bottom: 20px; border-radius: 5px; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px; }
                    .vital-sim { font-size: 1em; text-align: center; }
                    .vital-label-sim { font-weight: bold; color: #555; display: block; }
                    .vital-value-sim { color: #c0392b; font-weight: bold; }
                    .vital-value-sim.stable { color: #27ae60; }
                    #options-container-sim button { display: block; width: 100%; padding: 12px; margin-bottom: 8px; font-size: 1em; background-color: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.3s; text-align: left; }
                    #options-container-sim button:hover:not(:disabled) { background-color: #2980b9; }
                    #options-container-sim button:disabled { background-color: #bdc3c7; cursor: not-allowed; opacity: 0.7; }
                    #feedback-text-sim { margin-top: 15px; padding: 12px; border-radius: 5px; font-size: 1em; line-height: 1.5; display: none; animation: fadeInFeedback 0.5s; }
                    .feedback-correct-sim { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
                    .feedback-incorrect-sim { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
                </style>
                <div id="game-container">
                    <h1 class="text-xl font-bold text-center text-red-700 mb-4">Simulador Cl√≠nico: C√≥digo HVA</h1>
                    <div id="vitals-display-sim"></div>
                    <div id="scenario-text-sim">Cargando simulaci√≥n...</div>
                    <div id="options-container-sim"></div>
                    <div id="feedback-text-sim"></div>
                </div>
            `;
            
            const scenarioText = container.querySelector('#scenario-text-sim');
            const optionsContainer = container.querySelector('#options-container-sim');
            const feedbackText = container.querySelector('#feedback-text-sim');
            const vitalsDisplay = container.querySelector('#vitals-display-sim');
            let state = {};

            const scenarios = [
                { id: 0, text: "Paciente de 58 a√±os con cirrosis llega por hematemesis. Est√° let√°rgico y desorientado.", options: [ { text: "Asegurar v√≠a a√©rea (ABCDE) y canalizar 2 v√≠as IV.", correct: true, nextScenario: 1, feedback: "Correcto. La prioridad es la estabilizaci√≥n hemodin√°mica." }, { text: "Llamar a endoscopia urgentemente.", correct: false, nextScenario: 'fail_endoscopy_first' }, { text: "Administrar un sedante (diazepam).", correct: false, nextScenario: 'fail_sedation' } ] },
                { id: 'fail_endoscopy_first', text: "El paciente sufre una parada cardiorrespiratoria por hipovolemia. **Error Cr√≠tico:** La resucitaci√≥n es ANTES que la endoscopia.", options: [ { text: "Reiniciar Simulaci√≥n", nextScenario: 0 } ] },
                { id: 'fail_sedation', text: "Las benzodiacepinas empeoran la encefalopat√≠a. El paciente entra en coma. **Error Cr√≠tico:** Evitar sedantes.", options: [ { text: "Reiniciar Simulaci√≥n", nextScenario: 0 } ] },
                { id: 1, text: "V√≠a a√©rea asegurada y accesos IV listos. ¬øSiguiente paso URGENTE?", updateState: (s) => { s.ivAccess = true; return s; }, options: [ { text: "Administrar Terlipresina y Ceftriaxona IV.", correct: true, nextScenario: 2, feedback: "Excelente. La terapia farmacol√≥gica temprana reduce la mortalidad." }, { text: "Transfundir 2 paquetes de gl√≥bulos rojos.", correct: false, nextScenario: 'fail_liberal_transfusion' } ] },
                { id: 'fail_liberal_transfusion', text: "La transfusi√≥n agresiva eleva la presi√≥n portal y provoca resangrado masivo. **Error Cr√≠tico:** La transfusi√≥n debe ser RESTRICTIVA (objetivo Hb 7-8 g/dL).", options: [ { text: "Reiniciar Simulaci√≥n", nextScenario: 0 } ] },
                { id: 2, text: "F√°rmacos administrados. Lab: Hb 6.5 g/dL. PA 90/50. ¬øPol√≠tica de transfusi√≥n?", updateState: (s) => { s.vasoactiveGiven = true; s.antibioticGiven = true; s.vitals.pas = 90; s.vitals.fc = 110; return s; }, options: [ { text: "Transfundir 1 paquete GR para objetivo Hb > 7 g/dL.", correct: true, nextScenario: 3, feedback: "Perfecto. Estrategia restrictiva para mantener perfusi√≥n sin exacerbar hipertensi√≥n portal." }, { text: "Transfundir hasta Hb > 10 g/dL.", correct: false, nextScenario: 'fail_liberal_transfusion' } ] },
                { id: 3, text: "Hb en 7.5 g/dL. Paciente m√°s estable (PA 95/60, FC 100). ¬øAhora qu√©?", updateState: (s) => { s.vitals.hb = 7.5; s.vitals.pas = 95; s.vitals.fc = 100; return s; }, options: [ { text: "Coordinar endoscopia urgente (<12h).", correct: true, nextScenario: 4, feedback: "Correcto. Una vez estabilizado, el siguiente paso es el tratamiento endosc√≥pico." }, { text: "Esperar 24h a ver si se detiene el sangrado.", correct: false, nextScenario: 'fail_wait' } ] },
                { id: 'fail_wait', text: "Retrasar la endoscopia aumenta el riesgo de resangrado. El paciente vuelve a sangrar. **Error:** La endoscopia debe ser temprana.", options: [ { text: "Reiniciar Simulaci√≥n", nextScenario: 0 } ] },
                { id: 4, text: "¬°Excelente! Ha estabilizado al paciente. El gastroenter√≥logo est√° en camino. Ha completado con √©xito el manejo inicial.", options: [ { text: "Reiniciar Simulaci√≥n", nextScenario: 0 } ] },
            ];

            function getInitialState() { return { vitals: { pas: 80, fc: 125, hb: 6.5, encefalopatia: 2 }, ivAccess: false, vasoactiveGiven: false, antibioticGiven: false }; }
            
            function renderVitals() { vitalsDisplay.innerHTML = `<div class="vital-sim"><span class="vital-label-sim">PAS</span> <span class="vital-value-sim ${state.vitals.pas >= 90 ? 'stable' : ''}">${state.vitals.pas}</span></div> <div class="vital-sim"><span class="vital-label-sim">FC</span> <span class="vital-value-sim ${state.vitals.fc <= 100 ? 'stable' : ''}">${state.vitals.fc}</span></div> <div class="vital-sim"><span class="vital-label-sim">Hb</span> <span class="vital-value-sim ${state.vitals.hb >= 7 ? 'stable' : ''}">${state.vitals.hb}</span></div>`; }
            
            function renderScenario(id) {
                const scenario = scenarios.find(s => s.id === id);
                if (!scenario) return;
                if (scenario.updateState) state = scenario.updateState(state);
                renderVitals();
                scenarioText.innerHTML = scenario.text;
                optionsContainer.innerHTML = '';
                feedbackText.style.display = 'none';
                scenario.options.forEach(option => {
                    const button = document.createElement('button');
                    button.innerHTML = option.text;
                    button.onclick = () => handleOptionClick(option);
                    optionsContainer.appendChild(button);
                });
            }

            function handleOptionClick(selectedOption) {
                feedbackText.style.display = 'block';
                Array.from(optionsContainer.children).forEach(btn => btn.disabled = true);
                if (selectedOption.correct) {
                    feedbackText.innerHTML = `<strong>${selectedOption.feedback}</strong>`;
                    feedbackText.className = 'feedback-correct-sim';
                    setTimeout(() => renderScenario(selectedOption.nextScenario), 2500);
                } else {
                    const failScenario = scenarios.find(s => s.id === selectedOption.nextScenario);
                    feedbackText.innerHTML = failScenario.text;
                    feedbackText.className = 'feedback-incorrect-sim';
                    optionsContainer.innerHTML = '';
                    failScenario.options.forEach(opt => {
                        const button = document.createElement('button');
                        button.innerHTML = opt.text;
                        button.onclick = () => { if (opt.nextScenario === 0) state = getInitialState(); renderScenario(opt.nextScenario); };
                        optionsContainer.appendChild(button);
                    });
                }
            }
            state = getInitialState();
            renderScenario(0);
        };

        const mainContent = document.getElementById('main-content');
        const navigationMenu = document.getElementById('navigation-menu');

        function renderSection(sectionId) {
            const section = studyGuideData.find(s => s.id === sectionId);
            if (section) {
                mainContent.innerHTML = section.content;
                mainContent.scrollTop = 0;

                // Ejecutar script si existe
                if (section.script === 'presentationScript') {
                    presentationScript();
                } else if (section.script === 'simulatorScript') {
                    simulatorScript();
                }

                // Renderizar quizzes si existen
                if (section.quizzes) {
                    const quizContainer = mainContent.querySelector('.quiz-container');
                    section.quizzes.forEach((quiz, quizIndex) => {
                        const quizEl = document.createElement('div');
                        quizEl.className = 'bg-white p-6 rounded-lg border-2 border-gray-200';
                        
                        const questionP = document.createElement('p');
                        questionP.className = 'font-medium text-gray-700 mb-4';
                        questionP.textContent = quiz.question;
                        quizEl.appendChild(questionP);

                        const optionsDiv = document.createElement('div');
                        optionsDiv.className = 'space-y-3';
                        quiz.options.forEach((option, optionIndex) => {
                            const button = document.createElement('button');
                            button.className = 'quiz-option w-full text-left p-4 rounded-lg bg-gray-100 hover:bg-blue-100';
                            button.textContent = `${String.fromCharCode(65 + optionIndex)}) ${option}`;
                            button.onclick = () => checkAnswer(studyGuideData.indexOf(section), quizIndex, optionIndex);
                            optionsDiv.appendChild(button);
                        });
                        quizEl.appendChild(optionsDiv);

                        const feedbackDiv = document.createElement('div');
                        feedbackDiv.id = `feedback-${studyGuideData.indexOf(section)}-${quizIndex}`;
                        feedbackDiv.className = 'mt-4 text-sm p-4 rounded-lg hidden';
                        quizEl.appendChild(feedbackDiv);

                        quizContainer.appendChild(quizEl);
                    });
                }

                // Actualizar enlace activo en la barra lateral
                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('data-id') === sectionId) {
                        link.classList.add('active');
                    }
                });
            }
        }

        // Inicializar la aplicaci√≥n
        window.onload = () => {
            // Poblar el men√∫ de navegaci√≥n
            studyGuideData.forEach(section => {
                const link = document.createElement('a');
                link.href = '#';
                link.textContent = section.title;
                link.className = 'sidebar-link block w-full text-left p-3 rounded-md hover:bg-gray-700';
                link.setAttribute('data-id', section.id);
                link.onclick = (e) => {
                    e.preventDefault();
                    renderSection(section.id);
                };
                navigationMenu.appendChild(link);
            });

            // Renderizar la primera secci√≥n por defecto
            renderSection('intro');
        };
    </script>
</body>
</html>
