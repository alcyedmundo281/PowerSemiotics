<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guía de Estudio: Enfermedad Hepática</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="../../assets/tailwind.css" rel="stylesheet" />
  </head>
  <body class="font-sans bg-gray-100">
    <div class="flex flex-col md:flex-row min-h-screen">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="w-full md:w-64 bg-gray-800 text-white p-6 md:p-4 space-y-2 flex-shrink-0"
      >
        <h1 class="text-2xl font-bold mb-4 text-center">PowerSemiotics</h1>
        <h2 class="text-lg font-semibold mb-4 text-center text-gray-300">
          Enfermedad Hepática
        </h2>
        <nav id="navigation-menu">
          <!-- Los enlaces se generan dinámicamente -->
        </nav>
      </aside>

      <!-- Main Content -->
      <main id="main-content" class="flex-1 p-6 md:p-10 overflow-y-auto">
        <!-- El contenido se genera dinámicamente -->
      </main>
    </div>

    <script>
      // Función global para ser llamada desde el HTML
      window.checkAnswer = (
        sectionIndex,
        questionIndex,
        selectedOptionIndex,
      ) => {
        const quizData = studyGuideData[sectionIndex].quizzes[questionIndex];
        const feedbackId = `feedback-${sectionIndex}-${questionIndex}`;

        const feedbackEl = document.getElementById(feedbackId);
        const quizContainer = feedbackEl.closest('.quiz-container');
        const options = quizContainer.querySelectorAll('.quiz-option');

        // Deshabilitar todos los botones para esta pregunta
        options.forEach((button) => (button.disabled = true));

        const selectedButton = options[selectedOptionIndex];

        if (selectedOptionIndex === quizData.correct) {
          selectedButton.classList.add('correct');
          feedbackEl.innerHTML = `<strong>¡Correcto!</strong> ${quizData.feedback}`;
          feedbackEl.className =
            'mt-4 text-sm p-4 rounded-lg bg-green-100 text-green-800 animate-fade-in';
        } else {
          selectedButton.classList.add('incorrect');
          options[quizData.correct].classList.add('correct');
          feedbackEl.innerHTML = `<strong>Incorrecto.</strong> La respuesta correcta se ha resaltado en verde. ${quizData.feedback}`;
          feedbackEl.className =
            'mt-4 text-sm p-4 rounded-lg bg-red-100 text-red-800 animate-fade-in';
        }
      };

      const studyGuideData = [
        {
          id: 'intro',
          title: 'Bienvenida',
          content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Guía de Estudio Interactiva: Enfermedad Hepática</h2>
                        <p class="text-lg text-gray-600 mb-6">Este recurso unificado está diseñado para ser tu compañero de estudio principal para las semanas 10 y 11. Aquí encontrarás todo lo que necesitas, desde la presentación de clase hasta un simulador y una autoevaluación.</p>
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg">
                            <h4 class="font-bold text-blue-800">¿Cómo usar este recurso?</h4>
                            <ul class="list-disc list-inside mt-2 text-blue-700">
                                <li><strong>Presentación de Clase:</strong> Úsala para seguir la clase o como una revisión visual rápida de los temas.</li>
                                <li><strong>Simulador Clínico:</strong> ¡Ponte a prueba! Aplica tus conocimientos para manejar una emergencia médica en un entorno seguro.</li>
                                <li><strong>Texto y Autoevaluación:</strong> Consulta el material de lectura detallado en cada sección para profundizar y luego pon a prueba tu comprensión con los casos clínicos.</li>
                            </ul>
                        </div>
                        <p class="mt-6 text-gray-600">Usa el menú de la izquierda para navegar entre las diferentes herramientas. ¡Éxitos en tu estudio!</p>
                    </div>
                `,
        },
        {
          id: 'presentacion',
          title: '1. Presentación de Clase',
          content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Presentación: Enfermedad Hepática II y III</h2>
                        <div id="presentation-content"></div>
                    </div>
                `,
          script: 'presentationScript',
        },
        {
          id: 'simulador',
          title: '2. Simulador Clínico (HVA)',
          content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Simulador: Manejo de Hemorragia Variceal Aguda</h2>
                        <div id="simulator-content" class="embedded-content-container"></div>
                    </div>
                `,
          script: 'simulatorScript',
        },
        {
          id: 'texto-autoevaluacion',
          title: '3. Texto y Autoevaluación',
          content: `
                    <div class="bg-white p-8 rounded-xl shadow-lg animate-fade-in text-guide">
                        <h2 class="text-3xl font-bold text-gray-800 mb-6">Texto Guía y Casos Clínicos</h2>
                        
                        <h3>Hepatitis Virales Crónicas en Ecuador: VHB y VHC</h3>
                        <h4>Panorama Epidemiológico Nacional</h4>
                        <p>Las hepatitis virales son un problema de salud pública global y nacional. En Ecuador, la vigilancia epidemiológica es clave para la sospecha clínica:</p>
                        <ul>
                            <li><strong>Hepatitis B (VHB):</strong> La prevalencia general es baja (<2%), pero existen focos de endemicidad intermedia (2-7%) en la <strong>cuenca Amazónica</strong>. El genotipo predominante es el F. El grupo más afectado es el de 20 a 49 años.</li>
                            <li><strong>Hepatitis C (VHC):</strong> La mayoría de los infectados no conocen su diagnóstico. El MSP promueve activamente el tamizaje y tratamiento.</li>
                        </ul>
                        <div class="mt-8">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">Ponte a Prueba</h4>
                            <div class="quiz-container space-y-4"></div>
                        </div>
                        
                        <h3>Diagnóstico y Estratificación de la Hepatitis B Crónica (VHB)</h3>
                        <p>La cronicidad se define por la persistencia del <strong>HBsAg por más de 6 meses</strong>. Una vez confirmada, se debe estratificar la fase de la enfermedad para decidir el manejo, usando HBeAg, Anti-HBe, ALT y carga viral (ADN-VHB).</p>
                        <div class="highlight-box">
                            <strong>Fases de la Infección Crónica por VHB:</strong>
                            <ul>
                                <li><strong>Inmunotolerancia:</strong> Alta carga viral, ALT normal. Se vigila.</li>
                                <li><strong>Inmunoactiva (HBeAg+ o HBeAg-):</strong> Carga viral elevada y ALT elevada. <strong>Requiere tratamiento.</strong></li>
                                <li><strong>Portador Inactivo:</strong> Carga viral baja (<2,000 UI/mL), ALT normal. Se vigila.</li>
                            </ul>
                        </div>
                        <div class="mt-8">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">Ponte a Prueba</h4>
                            <div class="quiz-container space-y-4"></div>
                        </div>

                        <h3>Cirrosis Hepática: Diagnóstico y Pronóstico</h3>
                        <h4>Diagnóstico y Escalas Pronósticas</h4>
                        <p>La cirrosis es el estadio final de múltiples hepatopatías. Se diagnostica por una combinación de hallazgos clínicos, de laboratorio e imagen. Las escalas de <strong>Child-Pugh</strong> (evaluación clínica global) y <strong>MELD</strong> (predicción de mortalidad) son cruciales para estratificar la severidad.</p>
                        <div class="mt-8">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">Ponte a Prueba</h4>
                            <div class="quiz-container space-y-4"></div>
                        </div>

                        <h3>Manejo de las Complicaciones Mayores</h3>
                        <h4>Hemorragia Variceal Aguda (HVA) y Otras Complicaciones</h4>
                        <p>La HVA es una emergencia médica que requiere un protocolo claro: resucitación, transfusión restrictiva, fármacos (vasoactivos + antibióticos) y endoscopia temprana. Otras complicaciones como la Ascitis, PBE y Encefalopatía Hepática (EH) también requieren un manejo específico, donde es clave identificar y tratar los factores precipitantes.</p>
                        <div class="mt-8">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">Ponte a Prueba</h4>
                            <div class="quiz-container space-y-4"></div>
                        </div>

                        <h3>Vigilancia del Carcinoma Hepatocelular (CHC)</h3>
                        <p>Es la consecuencia más temida a largo plazo. La detección temprana es la única opción curativa y se basa en la vigilancia estricta de la población de riesgo.</p>
                        <div class="mt-8">
                            <h4 class="text-xl font-semibold text-gray-800 mb-4">Ponte a Prueba</h4>
                            <div class="quiz-container space-y-4"></div>
                        </div>
                    </div>
                `,
          quizzes: [
            {
              question:
                'Un agricultor de 45 años, de Morona Santiago, acude por astenia. Laboratorio: ALT 85 U/L. Perfil viral: HBsAg (+), Anti-HBc total (+), Anti-HBc IgM (-), HBeAg (-), Anti-HBe (+). ¿Cuál es el siguiente paso MÁS apropiado?',
              options: [
                'Iniciar Tenofovir inmediatamente.',
                'Solicitar carga viral (ADN-VHB) y repetir transaminasas.',
                'Asegurar que es un portador inactivo y dar seguimiento anual.',
                'Solicitar ecografía para descartar esteatosis.',
              ],
              correct: 1,
              feedback:
                'Correcto. El paciente tiene una hepatitis B crónica HBeAg-negativa. Para diferenciar si está en la fase inmunoactiva (que requiere tratamiento) o es un portador inactivo, es indispensable conocer el nivel de ADN-VHB y confirmar la persistencia de la elevación de ALT.',
            },
            {
              question:
                'Una mujer de 32 años en su semana 28 de gestación es HBsAg (+). Exámenes: HBeAg (+), ALT 30 U/L y carga viral de 500,000 UI/mL. ¿Cuál es la conducta MÁS adecuada?',
              options: [
                'Iniciar Tenofovir a la madre y planificar vacuna + HBIg al recién nacido.',
                'Recomendar cesárea electiva.',
                'Administrar únicamente la vacuna al recién nacido.',
                'Suspender la lactancia materna.',
              ],
              correct: 0,
              feedback:
                'Correcto. Con una carga viral >200,000 UI/mL, está indicada la terapia antiviral en el tercer trimestre para reducir la transmisión, además de la inmunoprofilaxis completa (activa y pasiva) al neonato.',
            },
            {
              question:
                'Paciente de 62 años con cirrosis (Child-Pugh B8) llega a emergencias por hematemesis. PA 85/50, FC 115 lpm. Además de la resucitación, ¿qué fármacos debe administrar INMEDIATAMENTE?',
              options: [
                'Omeprazol IV y Metoclopramida IV.',
                'Furosemida IV y Lactulosa.',
                'Terlipresina IV y Ceftriaxona IV.',
                'Albúmina humana IV y Vitamina K IV.',
              ],
              correct: 2,
              feedback:
                'Correcto. El manejo inicial de la HVA se basa en resucitación, fármacos vasoactivos (Terlipresina) para reducir la presión portal y profilaxis antibiótica (Ceftriaxona) para prevenir infecciones, que son un gatillo de resangrado.',
            },
            {
              question:
                'Paciente de 68 años con cirrosis alcohólica (Child C11) es hospitalizado por encefalopatía. Tiene fiebre, disuria y ascitis. ¿Cuál es el factor precipitante MÁS probable y cómo lo confirma?',
              options: [
                'Estreñimiento / Tacto rectal.',
                'Hemorragia digestiva oculta / Sangre oculta en heces.',
                'Infección (PBE o ITU) / Paracentesis diagnóstica y examen de orina.',
                'Exceso de proteínas / Niveles de amonio.',
              ],
              correct: 2,
              feedback:
                'Correcto. La infección es uno de los precipitantes más comunes y graves de EH. Ante un paciente con ascitis, fiebre y encefalopatía, es mandatorio descartar PBE mediante una paracentesis.',
            },
            {
              question:
                'Paciente de 55 años con cirrosis por VHB (Child-Pugh A5) acude a su control semestral. ¿Cuál es la indicación de VIGILANCIA más importante para la detección temprana de CHC?',
              options: [
                'Alfa-fetoproteína (AFP) sérica cada 6 meses.',
                'TC de abdomen con contraste anualmente.',
                'Ecografía abdominal cada 6 meses.',
                'Endoscopia digestiva alta cada 2 años.',
              ],
              correct: 2,
              feedback:
                'Correcto. La piedra angular de la vigilancia del carcinoma hepatocelular en todos los pacientes con cirrosis es la ecografía abdominal cada 6 meses. La AFP es un complemento, pero no la reemplaza.',
            },
          ],
        },
      ];

      // Contenido de los componentes externos
      const presentationScript = () => {
        const container = document.getElementById('presentation-content');
        container.innerHTML = `
                
                <div class="slider-container">
                    <div class="slide active">
                        <h1>Enfermedad Hepática II y III</h1>
                        <h2>Semanas 10 y 11: De la Hepatitis Crónica a las Complicaciones Mayores</h2>
                        <p>Un paquete educativo para estudiantes de Medicina en Ecuador.</p>
                        <div class="highlight">
                            <p><strong>Objetivo General:</strong> Capacitar al futuro médico general en el diagnóstico, estratificación y manejo de la enfermedad hepática crónica y sus complicaciones, con un enfoque en la realidad epidemiológica y los recursos del sistema de salud ecuatoriano.</p>
                        </div>
                    </div>
                    <div class="slide">
                        <h1>Semana 10: De la Hepatitis Crónica a la Cirrosis</h1>
                        <h2>Sección 1: Hepatitis Virales Crónicas en Ecuador (VHB y VHC)</h2>
                        <p>Las hepatitis virales son un problema de salud pública global y nacional, siendo una causa principal de enfermedad hepática crónica.</p>
                        <div class="ecuador-focus">
                            <h3>Enfoque Ecuador</h3>
                            <ul>
                                <li><strong>Hepatitis B (2024):</strong> 155 casos reportados hasta la SE 24. Provincia más afectada: Pichincha (44 casos). Grupo etario principal: 20-49 años.</li>
                                <li><strong>Endemicidad:</strong> Prevalencia general baja (<2%), pero con focos de endemicidad intermedia (2-7%) en la cuenca amazónica.</li>
                                <li><strong>Genotipos:</strong> VHB predominante es el Genotipo F (96%).</li>
                            </ul>
                        </div>
                    </div>
                    <div class="slide">
                        <h2>Diagnóstico y Estratificación de la Hepatitis B Crónica (VHB)</h2>
                        <p>El diagnóstico preciso requiere una interpretación correcta de los marcadores serológicos.</p>
                        <h3>Fases de la Infección Crónica por VHB</h3>
                        <ul>
                            <li><strong>Infección Crónica HBeAg-positivo (Inmunotolerancia):</strong> Alta carga viral (ADN-VHB), ALT normal. Vigilancia.</li>
                            <li><strong>Hepatitis Crónica HBeAg-positivo (Inmunoactiva):</strong> Alta carga viral, ALT elevada. Requiere tratamiento.</li>
                            <li><strong>Infección Crónica HBeAg-negativo (Portador Inactivo):</strong> Baja carga viral (<2,000 UI/mL), ALT normal. Vigilancia.</li>
                            <li><strong>Hepatitis Crónica HBeAg-negativo (Mutante):</strong> Carga viral fluctuante (>2,000 UI/mL), ALT elevada. Requiere tratamiento.</li>
                        </ul>
                        <div class="highlight"><strong>Clave:</strong> La decisión de tratar se basa en la combinación de ADN-VHB, ALT y el grado de fibrosis.</div>
                    </div>
                    <div class="slide">
                        <h2>Manejo según Guías del MSP y Estándares Internacionales</h2>
                        <h3>Principios Terapéuticos</h3>
                        <ul>
                            <li><strong>Objetivo VHB:</strong> Supresión viral a largo plazo, prevenir progresión a cirrosis y CHC.</li>
                            <li><strong>Fármacos de 1ra Línea (VHB) en Ecuador:</strong> Entecavir (ETV) y Tenofovir (TDF).</li>
                            <li><strong>Diagnóstico VHC:</strong> Inicia con Anti-VHC. Si es reactivo, confirmar con carga viral (ARN-VHC).</li>
                            <li><strong>Tratamiento VHC:</strong> Antivirales de Acción Directa (AAD) con tasas de curación >95%.</li>
                            <li><strong>Prevención TMI del VHB:</strong> Tamizaje a gestantes. Terapia antiviral en 3er trimestre si carga viral >200,000 UI/mL. Vacuna + Inmunoglobulina (HBIg) al recién nacido.</li>
                        </ul>
                        <p>El rol del médico general es clave en el tamizaje, diagnóstico inicial y la referencia oportuna al especialista.</p>
                    </div>
                    <div class="slide">
                        <h2>Sección 2: Cirrosis Hepática: Diagnóstico y Pronóstico</h2>
                        <p>La cirrosis es la vía final común de múltiples hepatopatías crónicas. Su diagnóstico es clínico, de laboratorio e imagenológico.</p>
                        <h3>Hallazgos Clave</h3>
                        <ul>
                            <li><strong>Clínicos:</strong> Estigmas de hepatopatía (ictericia, arañas vasculares, eritema palmar).</li>
                            <li><strong>Laboratorio:</strong> Trombocitopenia (a menudo el primer signo), hipoalbuminemia, INR prolongado.</li>
                            <li><strong>Imagen (Eco):</strong> Hígado nodular, esplenomegalia, ascitis.</li>
                        </ul>
                        <div class="highlight">
                            <p>El <strong>Índice APRI</strong> (AST/Plaquetas) es una herramienta no invasiva y accesible para estimar la fibrosis.</p>
                        </div>
                    </div>
                    <div class="slide">
                        <h2>Escalas Pronósticas: Child-Pugh y MELD</h2>
                        <p>Herramientas esenciales para estratificar la severidad y predecir la mortalidad.</p>
                        <h3>Escala de Child-Pugh</h3>
                        <p>Evalúa 5 parámetros (Bilirrubina, Albúmina, Ascitis, Encefalopatía, INR). Clasifica la cirrosis en:</p>
                        <ul>
                            <li><strong>Clase A (5-6 pts):</strong> Compensada. Buen pronóstico.</li>
                            <li><strong>Clase B (7-9 pts):</strong> Compromiso funcional.</li>
                            <li><strong>Clase C (10-15 pts):</strong> Descompensada. Mal pronóstico.</li>
                        </ul>
                        <h3>Escala MELD</h3>
                        <p>Fórmula logarítmica (Bilirrubina, INR, Creatinina). Predice mortalidad a 90 días y prioriza para trasplante hepático.</p>
                        <div class="ecuador-focus">
                            <h3>Aplicación Práctica</h3>
                            <p>El médico general usará <strong>Child-Pugh</strong> para evaluar la severidad global en la consulta. <strong>MELD</strong> es la herramienta del especialista y del centro de trasplantes.</p>
                        </div>
                    </div>
                    <div class="slide">
                        <h1>Semana 11: Manejo de las Complicaciones Mayores</h1>
                        <h2>Sección 3: Hemorragia Variceal Aguda (HVA)</h2>
                        <p>Una emergencia médica con una mortalidad de hasta el 20%. El manejo inicial es crucial.</p>
                        <h3>Protocolo "Código HVA": Pasos Críticos</h3>
                        <ol>
                            <li><strong>Estabilización Hemodinámica:</strong> 2 vías IV, resucitación con cristaloides.</li>
                            <li><strong>Transfusión Restrictiva:</strong> Objetivo de Hb 7-8 g/dL. ¡Evitar sobretransfusión!</li>
                            <li><strong>Fármacos Inmediatos:</strong>
                                <ul>
                                    <li><strong>Vasoactivos:</strong> Terlipresina o Octreótide ANTES de la endoscopia.</li>
                                    <li><strong>Antibióticos:</strong> Ceftriaxona 1g IV profiláctico para todos.</li>
                                </ul>
                            </li>
                            <li><strong>Endoscopia Urgente (<12h):</strong> Ligadura con bandas es la terapia de elección para várices esofágicas.</li>
                        </ol>
                    </div>
                    <div class="slide">
                        <h2>Manejo del Fracaso y Prevención Secundaria de HVA</h2>
                        <h3>Fracaso del Tratamiento (10-20% de los casos)</h3>
                        <ul>
                            <li><strong>Terapia de Rescate:</strong> Sonda-balón (Sengstaken-Blakemore) como puente temporal.</li>
                            <li><strong>Tratamiento Definitivo de Rescate:</strong> TIPS (Shunt Portosistémico Intrahepático Transyugular). Considerar TIPS "temprano" (<72h) en pacientes de alto riesgo.</li>
                        </ul>
                        <h3>Prevención Secundaria (para evitar resangrado)</h3>
                        <div class="highlight">
                            <p><strong>La mejor estrategia:</strong> Terapia combinada de <strong>Beta-bloqueadores no selectivos</strong> (Propranolol) + <strong>Ligadura endoscópica seriada</strong> hasta erradicar las várices.</p>
                        </div>
                    </div>
                    <div class="slide">
                        <h2>Sección 4: Otras Complicaciones de la Cirrosis</h2>
                        <h3>Ascitis y Peritonitis Bacteriana Espontánea (PBE)</h3>
                        <ul>
                            <li><strong>Diagnóstico Ascitis:</strong> GASA (Gradiente Albúmina Suero-Ascitis) ≥ 1.1 g/dL indica hipertensión portal.</li>
                            <li><strong>Manejo Ascitis:</strong> Restricción de sodio, diuréticos (Espironolactona ± Furosemida).</li>
                            <li><strong>Diagnóstico PBE:</strong> Paracentesis en paciente con ascitis y fiebre/dolor/encefalopatía. PMN ≥ 250/mm³ en líquido ascítico.</li>
                            <li><strong>Tratamiento PBE:</strong> Cefalosporinas de 3ra generación (ej. Cefotaxima).</li>
                        </ul>
                    </div>
                    <div class="slide">
                        <h2>Encefalopatía Hepática (EH)</h2>
                        <p>Disfunción cerebral por insuficiencia hepática. Es un diagnóstico de exclusión.</p>
                        <h3>Clasificación de West Haven</h3>
                        <ul>
                            <li><strong>Grado 1:</strong> Alteración leve, euforia/ansiedad.</li>
                            <li><strong>Grado 2:</strong> Letargia, desorientación, asterixis.</li>
                            <li><strong>Grado 3:</strong> Somnolencia, confusión marcada.</li>
                            <li><strong>Grado 4:</strong> Coma.</li>
                        </ul>
                        <div class="ecuador-focus">
                            <h3>Manejo Práctico</h3>
                            <p><strong>Pregunta Clave:</strong> ¿Por qué tiene EH *hoy*? Buscar y tratar el <strong>factor precipitante</strong> es fundamental (infecciones, HDA, deshidratación, fármacos).</p>
                            <p><strong>Tratamiento 1ra Línea:</strong> Lactulosa (oral/enema) para lograr 2-3 deposiciones/día.</p>
                        </div>
                    </div>
                    <div class="slide">
                        <h2>Sección 5: Carcinoma Hepatocelular (CHC)</h2>
                        <p>La consecuencia más temida a largo plazo de la cirrosis.</p>
                        <h3>Vigilancia y Diagnóstico</h3>
                        <ul>
                            <li><strong>Población de Alto Riesgo:</strong> TODOS los pacientes con cirrosis.</li>
                            <li><strong>Protocolo de Vigilancia:</strong> Ecografía abdominal cada 6 meses. Es una responsabilidad del médico general asegurar su cumplimiento.</li>
                            <li><strong>Diagnóstico:</strong> En pacientes de alto riesgo, una lesión con patrón vascular típico en TC/RM contrastada es suficiente (no requiere biopsia).</li>
                        </ul>
                        <div class="highlight">
                            <p><strong>Mensaje Final:</strong> El manejo de la enfermedad hepática crónica es un maratón, no un sprint. El médico general es el director de orquesta que coordina la vigilancia, el manejo de las complicaciones y la referencia oportuna para salvar y mejorar la calidad de vida de sus pacientes.</p>
                        </div>
                    </div>
                    <div class="navigation">
                        <button id="prevBtn" class="nav-button">Anterior</button>
                        <div id="slideCounter" class="slide-counter"></div>
                        <button id="nextBtn" class="nav-button">Siguiente</button>
                    </div>
                </div>
            `;
        const slides = container.querySelectorAll('.slide');
        const prevBtn = container.querySelector('#prevBtn');
        const nextBtn = container.querySelector('#nextBtn');
        const slideCounter = container.querySelector('#slideCounter');
        let currentSlide = 0;

        function showSlide(n) {
          slides.forEach((slide) => slide.classList.remove('active'));
          slides[n].classList.add('active');
          currentSlide = n;
          slideCounter.textContent = `Diapositiva ${currentSlide + 1} de ${slides.length}`;
        }
        nextBtn.addEventListener('click', () => {
          if (currentSlide < slides.length - 1) showSlide(currentSlide + 1);
        });
        prevBtn.addEventListener('click', () => {
          if (currentSlide > 0) showSlide(currentSlide - 1);
        });
        showSlide(0);
      };

      const simulatorScript = () => {
        const container = document.getElementById('simulator-content');
        container.innerHTML = `
                
                <div id="game-container">
                    <h1 class="text-xl font-bold text-center text-red-700 mb-4">Simulador Clínico: Código HVA</h1>
                    <div id="vitals-display-sim"></div>
                    <div id="scenario-text-sim">Cargando simulación...</div>
                    <div id="options-container-sim"></div>
                    <div id="feedback-text-sim"></div>
                </div>
            `;

        const scenarioText = container.querySelector('#scenario-text-sim');
        const optionsContainer = container.querySelector(
          '#options-container-sim',
        );
        const feedbackText = container.querySelector('#feedback-text-sim');
        const vitalsDisplay = container.querySelector('#vitals-display-sim');
        let state = {};

        const scenarios = [
          {
            id: 0,
            text: 'Paciente de 58 años con cirrosis llega por hematemesis. Está letárgico y desorientado.',
            options: [
              {
                text: 'Asegurar vía aérea (ABCDE) y canalizar 2 vías IV.',
                correct: true,
                nextScenario: 1,
                feedback:
                  'Correcto. La prioridad es la estabilización hemodinámica.',
              },
              {
                text: 'Llamar a endoscopia urgentemente.',
                correct: false,
                nextScenario: 'fail_endoscopy_first',
              },
              {
                text: 'Administrar un sedante (diazepam).',
                correct: false,
                nextScenario: 'fail_sedation',
              },
            ],
          },
          {
            id: 'fail_endoscopy_first',
            text: 'El paciente sufre una parada cardiorrespiratoria por hipovolemia. **Error Crítico:** La resucitación es ANTES que la endoscopia.',
            options: [{ text: 'Reiniciar Simulación', nextScenario: 0 }],
          },
          {
            id: 'fail_sedation',
            text: 'Las benzodiacepinas empeoran la encefalopatía. El paciente entra en coma. **Error Crítico:** Evitar sedantes.',
            options: [{ text: 'Reiniciar Simulación', nextScenario: 0 }],
          },
          {
            id: 1,
            text: 'Vía aérea asegurada y accesos IV listos. ¿Siguiente paso URGENTE?',
            updateState: (s) => {
              s.ivAccess = true;
              return s;
            },
            options: [
              {
                text: 'Administrar Terlipresina y Ceftriaxona IV.',
                correct: true,
                nextScenario: 2,
                feedback:
                  'Excelente. La terapia farmacológica temprana reduce la mortalidad.',
              },
              {
                text: 'Transfundir 2 paquetes de glóbulos rojos.',
                correct: false,
                nextScenario: 'fail_liberal_transfusion',
              },
            ],
          },
          {
            id: 'fail_liberal_transfusion',
            text: 'La transfusión agresiva eleva la presión portal y provoca resangrado masivo. **Error Crítico:** La transfusión debe ser RESTRICTIVA (objetivo Hb 7-8 g/dL).',
            options: [{ text: 'Reiniciar Simulación', nextScenario: 0 }],
          },
          {
            id: 2,
            text: 'Fármacos administrados. Lab: Hb 6.5 g/dL. PA 90/50. ¿Política de transfusión?',
            updateState: (s) => {
              s.vasoactiveGiven = true;
              s.antibioticGiven = true;
              s.vitals.pas = 90;
              s.vitals.fc = 110;
              return s;
            },
            options: [
              {
                text: 'Transfundir 1 paquete GR para objetivo Hb > 7 g/dL.',
                correct: true,
                nextScenario: 3,
                feedback:
                  'Perfecto. Estrategia restrictiva para mantener perfusión sin exacerbar hipertensión portal.',
              },
              {
                text: 'Transfundir hasta Hb > 10 g/dL.',
                correct: false,
                nextScenario: 'fail_liberal_transfusion',
              },
            ],
          },
          {
            id: 3,
            text: 'Hb en 7.5 g/dL. Paciente más estable (PA 95/60, FC 100). ¿Ahora qué?',
            updateState: (s) => {
              s.vitals.hb = 7.5;
              s.vitals.pas = 95;
              s.vitals.fc = 100;
              return s;
            },
            options: [
              {
                text: 'Coordinar endoscopia urgente (<12h).',
                correct: true,
                nextScenario: 4,
                feedback:
                  'Correcto. Una vez estabilizado, el siguiente paso es el tratamiento endoscópico.',
              },
              {
                text: 'Esperar 24h a ver si se detiene el sangrado.',
                correct: false,
                nextScenario: 'fail_wait',
              },
            ],
          },
          {
            id: 'fail_wait',
            text: 'Retrasar la endoscopia aumenta el riesgo de resangrado. El paciente vuelve a sangrar. **Error:** La endoscopia debe ser temprana.',
            options: [{ text: 'Reiniciar Simulación', nextScenario: 0 }],
          },
          {
            id: 4,
            text: '¡Excelente! Ha estabilizado al paciente. El gastroenterólogo está en camino. Ha completado con éxito el manejo inicial.',
            options: [{ text: 'Reiniciar Simulación', nextScenario: 0 }],
          },
        ];

        function getInitialState() {
          return {
            vitals: { pas: 80, fc: 125, hb: 6.5, encefalopatia: 2 },
            ivAccess: false,
            vasoactiveGiven: false,
            antibioticGiven: false,
          };
        }

        function renderVitals() {
          vitalsDisplay.innerHTML = `<div class="vital-sim"><span class="vital-label-sim">PAS</span> <span class="vital-value-sim ${state.vitals.pas >= 90 ? 'stable' : ''}">${state.vitals.pas}</span></div> <div class="vital-sim"><span class="vital-label-sim">FC</span> <span class="vital-value-sim ${state.vitals.fc <= 100 ? 'stable' : ''}">${state.vitals.fc}</span></div> <div class="vital-sim"><span class="vital-label-sim">Hb</span> <span class="vital-value-sim ${state.vitals.hb >= 7 ? 'stable' : ''}">${state.vitals.hb}</span></div>`;
        }

        function renderScenario(id) {
          const scenario = scenarios.find((s) => s.id === id);
          if (!scenario) return;
          if (scenario.updateState) state = scenario.updateState(state);
          renderVitals();
          scenarioText.innerHTML = scenario.text;
          optionsContainer.innerHTML = '';
          feedbackText.style.display = 'none';
          scenario.options.forEach((option) => {
            const button = document.createElement('button');
            button.innerHTML = option.text;
            button.onclick = () => handleOptionClick(option);
            optionsContainer.appendChild(button);
          });
        }

        function handleOptionClick(selectedOption) {
          feedbackText.style.display = 'block';
          Array.from(optionsContainer.children).forEach(
            (btn) => (btn.disabled = true),
          );
          if (selectedOption.correct) {
            feedbackText.innerHTML = `<strong>${selectedOption.feedback}</strong>`;
            feedbackText.className = 'feedback-correct-sim';
            setTimeout(() => renderScenario(selectedOption.nextScenario), 2500);
          } else {
            const failScenario = scenarios.find(
              (s) => s.id === selectedOption.nextScenario,
            );
            feedbackText.innerHTML = failScenario.text;
            feedbackText.className = 'feedback-incorrect-sim';
            optionsContainer.innerHTML = '';
            failScenario.options.forEach((opt) => {
              const button = document.createElement('button');
              button.innerHTML = opt.text;
              button.onclick = () => {
                if (opt.nextScenario === 0) state = getInitialState();
                renderScenario(opt.nextScenario);
              };
              optionsContainer.appendChild(button);
            });
          }
        }
        state = getInitialState();
        renderScenario(0);
      };

      const mainContent = document.getElementById('main-content');
      const navigationMenu = document.getElementById('navigation-menu');

      function renderSection(sectionId) {
        const section = studyGuideData.find((s) => s.id === sectionId);
        if (section) {
          mainContent.innerHTML = section.content;
          mainContent.scrollTop = 0;

          // Ejecutar script si existe
          if (section.script === 'presentationScript') {
            presentationScript();
          } else if (section.script === 'simulatorScript') {
            simulatorScript();
          }

          // Renderizar quizzes si existen
          if (section.quizzes) {
            const quizContainers =
              mainContent.querySelectorAll('.quiz-container');
            section.quizzes.forEach((quiz, quizIndex) => {
              // Asignar cada quiz a su contenedor correspondiente
              if (quizContainers[quizIndex]) {
                const quizEl = document.createElement('div');
                quizEl.className =
                  'bg-white p-6 rounded-lg border-2 border-gray-200';

                const questionP = document.createElement('p');
                questionP.className = 'font-medium text-gray-700 mb-4';
                questionP.textContent = quiz.question;
                quizEl.appendChild(questionP);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'space-y-3';
                quiz.options.forEach((option, optionIndex) => {
                  const button = document.createElement('button');
                  button.className =
                    'quiz-option w-full text-left p-4 rounded-lg bg-gray-100 hover:bg-blue-100';
                  button.textContent = `${String.fromCharCode(65 + optionIndex)}) ${option}`;
                  button.onclick = () =>
                    checkAnswer(
                      studyGuideData.indexOf(section),
                      quizIndex,
                      optionIndex,
                    );
                  optionsDiv.appendChild(button);
                });
                quizEl.appendChild(optionsDiv);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.id = `feedback-${studyGuideData.indexOf(section)}-${quizIndex}`;
                feedbackDiv.className = 'mt-4 text-sm p-4 rounded-lg hidden';
                quizEl.appendChild(feedbackDiv);

                quizContainers[quizIndex].appendChild(quizEl);
              }
            });
          }

          // Actualizar enlace activo en la barra lateral
          document.querySelectorAll('.sidebar-link').forEach((link) => {
            link.classList.remove('active');
            if (link.getAttribute('data-id') === sectionId) {
              link.classList.add('active');
            }
          });
        }
      }

      // Inicializar la aplicación
      window.onload = () => {
        // Poblar el menú de navegación
        studyGuideData.forEach((section) => {
          const link = document.createElement('a');
          link.href = '#';
          link.textContent = section.title;
          link.className =
            'sidebar-link block w-full text-left p-3 rounded-md hover:bg-gray-700';
          link.setAttribute('data-id', section.id);
          link.onclick = (e) => {
            e.preventDefault();
            renderSection(section.id);
          };
          navigationMenu.appendChild(link);
        });

        // Renderizar la primera sección por defecto
        renderSection('intro');
      };
    </script>
  </body>
</html>
