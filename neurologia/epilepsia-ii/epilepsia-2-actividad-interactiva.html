<!doctype html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Actividad Interactiva: Caso Clínico de EE</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <link href="../../assets/tailwind.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
    }

    .font-mono {
      font-family: 'JetBrains Mono', monospace;
    }

    /* Scrollbar Premium */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #020617;
    }

    ::-webkit-scrollbar-thumb {
      background: #1e293b;
      border-radius: 4px;
      border: 1px solid #0f172a;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #334155;
    }

    @keyframes pulse-red {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.5;
      }
    }

    .animate-pulse-red {
      animation: pulse-red 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
  </style>
</head>

<body
  class="bg-slate-950 text-slate-200 font-sans antialiased selection:bg-cyan-500 selection:text-white overflow-x-hidden">
  <!-- Background Gradients -->
  <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
    <div class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-cyan-900/10 rounded-full blur-[120px]"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-900/10 rounded-full blur-[120px]"></div>
  </div>
  <div class="container mx-auto p-4 md:p-8 relative min-h-screen">
    <header class="text-center mb-12">
      <h1 class="text-4xl font-extrabold text-white">
        Actividad Interactiva: Manejo del Estado Epiléptico
      </h1>
      <p class="text-lg text-gray-400 mt-2">
        Toma decisiones críticas en una simulación de caso clínico.
      </p>
    </header>

    <main class="grid lg:grid-cols-3 gap-8">
      <div class="lg:col-span-1 space-y-6">
        <div
          class="bg-black border-4 border-slate-800 rounded-2xl p-6 shadow-2xl relative overflow-hidden group hover:border-slate-700 transition-colors">
          <div
            class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-green-500 to-transparent opacity-50 animate-pulse">
          </div>

          <div class="flex justify-between items-start mb-6">
            <div>
              <h2 class="text-[10px] font-mono text-slate-500 uppercase tracking-widest mb-1">Estado Vital</h2>
              <div id="status" class="text-xl font-bold text-red-500 animate-pulse-red font-mono">CONVULSIONANDO</div>
            </div>
            <div class="text-right">
              <div class="text-[10px] font-mono text-slate-500 uppercase tracking-widest mb-1">Tiempo Elapsado</div>
              <div id="timer" class="text-3xl font-mono font-black text-white tracking-tighter">00:00</div>
            </div>
          </div>

          <div class="grid grid-cols-3 gap-2 border-y border-slate-800 py-6 my-6 font-mono">
            <div class="text-center">
              <span class="block text-[10px] text-slate-500 uppercase mb-1">FC</span>
              <span id="fc-val" class="text-2xl text-green-400 font-bold">135</span>
              <span class="text-[8px] text-slate-600 block">BPM</span>
            </div>
            <div class="text-center border-x border-slate-800">
              <span class="block text-[10px] text-slate-500 uppercase mb-1">PA</span>
              <span id="pa-val" class="text-2xl text-yellow-500 font-bold leading-none">150/90</span>
              <span class="text-[8px] text-slate-600 block">mmHg</span>
            </div>
            <div class="text-center">
              <span class="block text-[10px] text-slate-500 uppercase mb-1">SpO2</span>
              <span id="spo2-val" class="text-2xl text-blue-400 font-bold">92</span>
              <span class="text-[8px] text-slate-600 block">%</span>
            </div>
          </div>

          <div id="patient-info" class="space-y-3 text-xs">
            <div class="flex justify-between border-b border-slate-900 pb-2">
              <span class="text-slate-500 uppercase font-mono tracking-tighter">Paciente:</span>
              <span class="text-slate-300 font-bold uppercase">Varón, 30 años</span>
            </div>
            <div class="flex justify-between border-b border-slate-900 pb-2">
              <span class="text-slate-500 uppercase font-mono tracking-tighter">Motivo:</span>
              <span class="text-slate-300 font-bold uppercase">Crisis Convulsiva</span>
            </div>
          </div>
        </div>
      </div>

      <div class="lg:col-span-2 space-y-8">
        <div id="actions-container"
          class="bg-slate-900/50 backdrop-blur-md border border-slate-800 rounded-2xl p-8 shadow-xl">
          <div class="flex items-center gap-3 mb-6">
            <span
              class="bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 px-3 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider">Protocolo
              UCI</span>
            <h3 id="action-title" class="text-xl font-bold text-white tracking-tight">
              Paso 1: Estabilización Inicial
            </h3>
          </div>
          <div id="action-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Botones se generan con JS -->
          </div>
        </div>

        <div class="bg-slate-900/50 backdrop-blur-md border border-slate-800 rounded-2xl p-8 shadow-xl">
          <h3 class="text-xl font-bold text-white mb-6 tracking-tight flex items-center gap-2">
            <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Registro de Intervenciones
          </h3>
          <ol id="timeline" class="relative border-l-2 border-slate-800 space-y-6 ml-3">
            <!-- Eventos se generan con JS -->
          </ol>
        </div>
      </div>
    </main>

    <footer class="text-center mt-12 pt-6 border-t border-gray-700">
      <a href="index.html" class="text-blue-500 hover:underline">← Volver al Menú del Módulo</a>
    </footer>
  </div>

  <script>
    const patientStatusEl = document.getElementById('status');
    const timerEl = document.getElementById('timer');
    const actionTitleEl = document.getElementById('action-title');
    const actionButtonsEl = document.getElementById('action-buttons');
    const timelineEl = document.getElementById('timeline');

    let gameTime = 0;
    let gameInterval;
    let currentStep = 0;
    let hasIVAccess = false;

    const steps = [
      {
        title: 'Paso 1: Estabilización Inicial (0-5 min)',
        actions: [
          {
            text: 'Asegurar vía aérea (ABC)',
            correct: true,
            feedback:
              'Vía aérea permeable. Paciente posicionado para evitar aspiración.',
          },
          {
            text: 'Administrar Benzodiacepinas IV',
            correct: false,
            feedback:
              'Error crítico: Aún no has monitorizado ni obtenido acceso IV. Primero, estabiliza y evalúa.',
          },
          {
            text: 'Monitorizar signos vitales',
            correct: true,
            feedback: 'Monitor conectado. FC: 130, TA: 150/95, SatO2: 92%.',
          },
          {
            text: 'Obtener acceso IV y tomar muestras',
            correct: true,
            feedback:
              'Acceso IV periférico logrado. Muestras enviadas para labs y glucemia.',
          },
        ],
        required: 3,
      },
      {
        title: 'Paso 2: Tratamiento de Primera Línea (5-20 min)',
        actions: [
          {
            text: 'Administrar Lorazepam IV',
            correct: true,
            feedback:
              'Dosis de 4mg de Lorazepam IV administrada. Monitorizando respuesta.',
          },
          {
            text: 'Administrar Fenitoína IV',
            correct: false,
            feedback:
              'Error: La Fenitoína es de segunda línea. Debes usar una benzodiacepina primero.',
          },
          {
            text: 'Administrar Midazolam IM',
            correct: false,
            feedback:
              'Incorrecto: Ya tienes un acceso IV funcional. Se prefiere la vía IV.',
          },
        ],
        required: 1,
      },
      {
        title: 'Paso 3: Tratamiento de Segunda Línea (20-40 min)',
        actions: [
          {
            text: 'Repetir dosis de Lorazepam',
            correct: false,
            feedback:
              'Error: No se recomienda repetir las benzodiacepinas. Se debe proceder a un FAE de segunda línea.',
          },
          {
            text: 'Cargar Fenitoína IV',
            correct: true,
            feedback:
              'Iniciando carga de Fenitoína 20mg/kg. Monitorizando TA y ECG de cerca.',
          },
          {
            text: 'Preparar para intubación',
            correct: false,
            feedback:
              'Aún no. La intubación se reserva para la fase 4 si los FAE de segunda línea fallan.',
          },
        ],
        required: 1,
      },
      {
        title: 'Paso 4: Manejo en UCI (>40 min)',
        actions: [
          {
            text: 'Llamar a UCI y preparar para traslado',
            correct: true,
            feedback:
              'Equipo de UCI notificado. Se preparan para recibir al paciente.',
          },
          {
            text: 'Iniciar infusión de Propofol',
            correct: true,
            feedback:
              'Paciente en UCI. Iniciando anestesia general con Propofol bajo monitorización EEG continua.',
          },
        ],
        required: 2,
      },
    ];

    function startGame() {
      gameTime = 0;
      currentStep = 0;
      hasIVAccess = false;
      timelineEl.innerHTML = '';
      patientStatusEl.textContent = 'CONVULSIONANDO';
      patientStatusEl.classList.remove('text-green-500');
      patientStatusEl.classList.add('text-red-500', 'animate-pulse-red');

      clearInterval(gameInterval);
      gameInterval = setInterval(() => {
        gameTime++;
        const minutes = Math.floor(gameTime / 60)
          .toString()
          .padStart(2, '0');
        const seconds = (gameTime % 60).toString().padStart(2, '0');
        timerEl.textContent = `${minutes}:${seconds}`;

        if (gameTime === 5 * 60)
          addTimelineEvent(
            '5 min',
            'Umbral T1 alcanzado. Riesgo de autoperpetuación.',
            'text-yellow-400',
          );
        if (gameTime === 20 * 60)
          addTimelineEvent(
            '20 min',
            'EE establecido. Riesgo de farmacorresistencia.',
            'text-orange-400',
          );
        if (gameTime === 30 * 60)
          addTimelineEvent(
            '30 min',
            'Umbral T2 alcanzado. Riesgo de daño neuronal.',
            'text-red-500',
          );
        if (gameTime === 40 * 60)
          addTimelineEvent(
            '40 min',
            'EE refractario establecido.',
            'text-red-700',
          );
      }, 1000 / 60); // Acelerado para la simulación (1 segundo real = 1 minuto de juego)

      loadStep(0);
    }

    function loadStep(stepIndex) {
      const step = steps[stepIndex];
      actionTitleEl.textContent = step.title;
      actionButtonsEl.innerHTML = '';

      let correctActionsTaken = 0;

      step.actions.forEach((action) => {
        const button = document.createElement('button');
        button.textContent = action.text;
        button.className =
          'p-4 bg-slate-800/50 border border-slate-700 text-slate-300 rounded-xl hover:border-cyan-500 hover:shadow-[0_0_20px_rgba(6,182,212,0.2)] hover:text-white transition-all text-left text-sm font-medium';
        button.onclick = () => {
          button.disabled = true;
          button.classList.add('opacity-40', 'cursor-not-allowed');

          if (action.correct) {
            button.classList.remove('border-slate-700');
            button.classList.add('border-green-500', 'bg-green-500/10', 'text-green-400');
            addTimelineEvent(
              timerEl.textContent,
              action.feedback,
              'text-green-400 font-mono text-xs',
            );
            correctActionsTaken++;
            if (action.text.includes('acceso IV')) hasIVAccess = true;

            // Stop seizure checks
            if (currentStep === 1) {
              // 1st line treatment
              patientStatusEl.textContent = 'ESTABILIZADO';
              patientStatusEl.classList.remove('text-red-500', 'animate-pulse-red');
              patientStatusEl.classList.add('text-green-500');
              clearInterval(gameInterval);
              endGame(true);
            } else if (currentStep === 2) {
              // 2nd line
              patientStatusEl.textContent = 'ESTABILIZADO';
              patientStatusEl.classList.remove('text-red-500', 'animate-pulse-red');
              patientStatusEl.classList.add('text-green-500');
              clearInterval(gameInterval);
              endGame(true);
            }
          } else {
            button.classList.remove('border-slate-700');
            button.classList.add('border-red-500', 'bg-red-500/10', 'text-red-400');
            addTimelineEvent(
              timerEl.textContent,
              action.feedback,
              'text-red-400 font-mono text-xs',
            );
          }

          if (correctActionsTaken >= step.required) {
            currentStep++;
            if (currentStep < steps.length) {
              setTimeout(() => loadStep(currentStep), 1500);
            }
          }
        };
        actionButtonsEl.appendChild(button);
      });
    }

    function addTimelineEvent(time, text, colorClass) {
      const li = document.createElement('li');
      li.className = `ml-5 p-4 bg-slate-900 border border-slate-800 rounded-xl relative ${colorClass}`;
      li.innerHTML = `
                <span class="absolute flex items-center justify-center w-2 h-2 bg-slate-700 rounded-full -left-[25px] top-6 ring-4 ring-slate-950"></span>
                <time class="block mb-1 text-[10px] font-mono leading-none text-slate-500 uppercase tracking-widest">${time} MARK</time>
                <p class="text-xs font-medium leading-relaxed">${text}</p>`;
      timelineEl.prepend(li);
      // Highlight the new step
      setTimeout(() => li.classList.add('border-slate-600'), 100);
    }

    function endGame(success) {
      actionTitleEl.textContent = success
        ? '¡Caso Resuelto con Éxito!'
        : 'Fin de la Simulación';
      actionButtonsEl.innerHTML = `<button onclick="startGame()" class="p-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors w-full md:col-span-2">Reiniciar Simulación</button>`;
    }

    startGame();
  </script>
  <script src="/assets/ask-ai.js"></script>
</body>

</html>