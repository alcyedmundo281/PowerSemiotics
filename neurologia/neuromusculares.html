<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CanvasMed-AI: Enfermedades Neuromusculares</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Estilos base para asegurar que el canvas ocupe toda la pantalla */
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background-color: #0f172a; /* Color de fondo base (slate-900) */
        font-family: 'Inter', sans-serif;
        color: #f8fafc; /* Color de texto base (slate-50) */
      }
      /* Estilos del canvas */
      #presentationCanvas {
        display: block;
        width: 100%;
        height: 100%;
      }
      /* Estilos de la capa de instrucciones inicial */
      #instructions-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(15, 23, 42, 0.9); /* Fondo semitransparente */
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
        cursor: pointer;
        z-index: 10;
        transition: opacity 0.5s ease;
      }
      #instructions-overlay h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #38bdf8; /* Color de acento (sky-400) */
      }
      #instructions-overlay p {
        font-size: 1.2rem;
        max-width: 600px;
        line-height: 1.6;
      }
      #instructions-overlay .key-icon {
        display: inline-block;
        background-color: #334155; /* slate-700 */
        padding: 0.5rem 0.8rem;
        border-radius: 0.5rem;
        border-bottom: 3px solid #1e293b; /* slate-800 */
        margin: 0 0.25rem;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <!-- Capa de instrucciones que desaparece al hacer clic -->
    <div id="instructions-overlay">
      <div>
        <h1>Bienvenido</h1>
        <p>
          Utilice las teclas de flecha <span class="key-icon">▲</span> (Arriba)
          y <span class="key-icon">▼</span> (Abajo) para navegar por la
          presentación.
        </p>
        <p style="margin-top: 2rem; font-size: 1rem; opacity: 0.7">
          (Haga clic en cualquier lugar para comenzar)
        </p>
      </div>
    </div>

    <!-- El canvas donde se dibujará toda la presentación -->
    <canvas id="presentationCanvas"></canvas>

    <script>
      // --- CONFIGURACIÓN Y VARIABLES GLOBALES ---

      const canvas = document.getElementById('presentationCanvas');
      const ctx = canvas.getContext('2d');
      const instructionsOverlay = document.getElementById(
        'instructions-overlay',
      );

      let currentSlide = 0;

      // Objeto de estilos para centralizar la configuración visual
      const STYLES = {
        BACKGROUND: '#0f172a', // slate-900
        TEXT: '#f8fafc', // slate-50
        ACCENT: '#38bdf8', // sky-400
        TABLE_HEADER_BG: '#1e293b', // slate-800
        TABLE_BORDER: '#334155', // slate-700
        FONT_FAMILY: 'Inter, sans-serif',
      };

      // --- CONTENIDO DE LAS DIAPOSITIVAS ---
      // Todo el contenido de la presentación se define aquí para una fácil gestión.
      const slides = [
        {
          type: 'title',
          title: 'Enfermedades de la Unión Neuromuscular y Músculo',
          subtitle: 'Un Análisis Clínico por CanvasMed-AI',
        },
        {
          type: 'content',
          title: 'Introducción: Enfermedades Neuromusculares (ENM)',
          points: [
            'Grupo heterogéneo de patologías que afectan la unidad motora.',
            'Abarcan desde la motoneurona hasta el músculo.',
            'Son condiciones crónicas, progresivas y a menudo incapacitantes.',
            'Clasificación principal: Trastornos de la unión, Distrofias y Miopatías.',
          ],
        },
        {
          type: 'content',
          title: 'Fisiopatología de la Miastenia Gravis (MG)',
          points: [
            'Enfermedad autoinmune mediada por anticuerpos.',
            'Ataque a proteínas de la membrana postsináptica, principalmente receptores de acetilcolina (AChR).',
            'Resultado: Interrupción de la transmisión neuromuscular.',
            'El timo juega un papel central, con hiperplasia o timomas frecuentes.',
          ],
        },
        {
          type: 'content',
          title: 'Clínica de la Miastenia Gravis',
          points: [
            'Característica principal: Debilidad muscular fluctuante y fatigable.',
            'Forma Ocular: Ptosis (párpado caído) y diplopía (visión doble).',
            'Forma Generalizada: Afecta músculos bulbares (habla, deglución), axiales y de extremidades.',
            'Crisis Miasténica: Emergencia médica con compromiso respiratorio que requiere ventilación mecánica.',
          ],
        },
        {
          type: 'content',
          title: 'Diagnóstico de la Miastenia Gravis',
          points: [
            'Clínico: Historia de debilidad fatigable.',
            'Electrodiagnóstico: Estimulación Nerviosa Repetitiva (ENR) y EMG de Fibra Única (EMG-SF), la más sensible.',
            'Serología: Detección de anticuerpos anti-AChR (85%) y anti-MuSK.',
            'Pruebas de cabecera: Test de la bolsa de hielo.',
          ],
        },
        {
          type: 'content',
          title: 'Tratamiento de la Miastenia Gravis',
          points: [
            'Sintomático: Piridostigmina (inhibidor de acetilcolinesterasa).',
            'Inmunoterapia a largo plazo: Corticosteroides (Prednisona) y ahorradores como Azatioprina.',
            'Terapias de rescate (crisis): Inmunoglobulina Intravenosa (IVIg) y Plasmaféresis.',
            'Quirúrgico: Timectomía, especialmente en pacientes jóvenes con MG generalizada AChR+.',
          ],
        },
        {
          type: 'title',
          title: 'Transición: Distrofias Musculares',
          subtitle:
            'Enfermedades genéticas que causan degeneración muscular progresiva',
        },
        {
          type: 'content',
          title: 'Fisiopatología de la Distrofia de Duchenne (DMD)',
          points: [
            'Trastorno genético recesivo ligado al cromosoma X.',
            'Causado por mutaciones en el gen que codifica la proteína Distrofina.',
            'DMD: Ausencia casi total de distrofina funcional.',
            'La falta de distrofina hace que las fibras musculares sean frágiles, llevando a necrosis, fibrosis y reemplazo por grasa.',
          ],
        },
        {
          type: 'content',
          title: 'Clínica de la Distrofia de Duchenne (DMD)',
          points: [
            'Inicio en la infancia temprana (2-5 años).',
            'Signo de Gowers: El niño "trepa" por sus propias piernas para levantarse.',
            'Pseudo-hipertrofia de pantorrillas.',
            'Progresión rápida: Pérdida de la marcha en la adolescencia temprana y afectación cardiorrespiratoria severa.',
          ],
        },
        {
          type: 'content',
          title: 'Diagnóstico de la Distrofia de Duchenne (DMD)',
          points: [
            'Sospecha clínica y niveles de Creatina Quinasa (CK) masivamente elevados (>100x).',
            'Confirmación: Prueba genética molecular para identificar la mutación en el gen DMD.',
            'Biopsia muscular: Muestra ausencia de distrofina (usada si la prueba genética no es concluyente).',
            'El diagnóstico diferencial clave es la Distrofia de Becker (DMB), una forma más leve con distrofina anormal o reducida.',
          ],
        },
        {
          type: 'title',
          title: 'Transición: Miopatías Inflamatorias',
          subtitle: 'Enfermedades autoinmunes que atacan el músculo estriado',
        },
        {
          type: 'content',
          title: 'Clasificación de las Miopatías Inflamatorias (MII)',
          points: [
            'Dermatomiositis (DM): Debilidad muscular con manifestaciones cutáneas (eritema en heliotropo, pápulas de Gottron).',
            'Polimiositis (PM): Debilidad muscular sin afectación cutánea.',
            'Miopatía Necrotizante Inmunomediada (MNIM): Forma severa con necrosis muscular extensa.',
            'Miositis por Cuerpos de Inclusión (MCI): Afecta a mayores de 50 años, progresión lenta, resistente a tratamiento.',
          ],
        },
        {
          type: 'content',
          title: 'Clínica de Dermatomiositis (DM) y Polimiositis (PM)',
          points: [
            'Debilidad muscular proximal y simétrica (cinturas escapular y pélvica).',
            'Afectación de flexores del cuello.',
            'Manifestaciones sistémicas: Enfermedad pulmonar intersticial, artritis, fenómeno de Raynaud.',
            'En DM de adultos, existe un riesgo aumentado de malignidad subyacente, requiriendo cribado oncológico.',
          ],
        },
        {
          type: 'table',
          title: 'Tabla Comparativa de Patologías Clave',
          headers: [
            'Característica',
            'Miastenia Gravis',
            'Duchenne (DMD)',
            'Miopatías (DM/PM)',
          ],
          rows: [
            [
              'Etiología',
              'Autoinmune (Anti-AChR)',
              'Genética (Ausencia de distrofina)',
              'Autoinmune (Inflamación muscular)',
            ],
            [
              'Inicio Típico',
              'Mujeres <40, Hombres >60',
              'Infancia (2-5 años)',
              'Niños y Adultos (40-50 años)',
            ],
            [
              'Clínica Clave',
              'Debilidad fatigable, ptosis',
              'Signo de Gowers, debilidad progresiva',
              'Debilidad proximal, rash (en DM)',
            ],
            [
              'Marcador DX',
              'Anticuerpos, EMG (decremento)',
              'CK muy elevada, Test genético',
              'CK elevada, Biopsia, Auto-ACs',
            ],
          ],
        },
        {
          type: 'title',
          title: 'Conclusiones y Cierre',
          subtitle:
            'El diagnóstico preciso y el manejo multidisciplinario son clave para mejorar la calidad de vida en pacientes con ENM.',
        },
      ];

      // --- FUNCIONES DE DIBUJO Y LÓGICA ---

      /**
       * Convierte un valor de viewport width (vw) a píxeles.
       * @param {number} baseVw - El valor base en vw.
       * @returns {number} El tamaño en píxeles.
       */
      function getDynamicFontSize(baseVw) {
        return (baseVw / 100) * canvas.width;
      }

      /**
       * Dibuja texto con ajuste de línea automático y centrado.
       * @param {CanvasRenderingContext2D} ctx - El contexto del canvas.
       * @param {string} text - El texto a dibujar.
       * @param {number} x - La coordenada X central.
       * @param {number} y - La coordenada Y inicial.
       * @param {number} maxWidth - El ancho máximo de la línea.
       * @param {number} lineHeight - La altura de la línea.
       * @returns {number} La altura total del bloque de texto dibujado.
       */
      function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(' ');
        let line = '';
        let totalHeight = 0;
        let currentY = y;

        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + ' ';
          const metrics = ctx.measureText(testLine);
          const testWidth = metrics.width;
          if (testWidth > maxWidth && n > 0) {
            ctx.fillText(line, x, currentY);
            line = words[n] + ' ';
            currentY += lineHeight;
            totalHeight += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line, x, currentY);
        totalHeight += lineHeight;
        return totalHeight;
      }

      /**
       * Dibuja una diapositiva de tipo 'título'.
       * @param {object} slide - El objeto de la diapositiva.
       */
      function drawTitleSlide(slide) {
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;

        // Dibujar título principal
        ctx.font = `bold ${getDynamicFontSize(4.5)}px ${STYLES.FONT_FAMILY}`;
        ctx.fillStyle = STYLES.TEXT;
        const titleHeight = wrapText(
          ctx,
          slide.title,
          centerX,
          centerY - getDynamicFontSize(2),
          canvas.width * 0.8,
          getDynamicFontSize(5),
        );

        // Dibujar subtítulo
        if (slide.subtitle) {
          ctx.font = `400 ${getDynamicFontSize(2)}px ${STYLES.FONT_FAMILY}`;
          ctx.fillStyle = STYLES.ACCENT;
          wrapText(
            ctx,
            slide.subtitle,
            centerX,
            centerY + titleHeight / 2,
            canvas.width * 0.7,
            getDynamicFontSize(2.5),
          );
        }
      }

      /**
       * Dibuja una diapositiva de tipo 'contenido' con título y viñetas.
       * @param {object} slide - El objeto de la diapositiva.
       */
      function drawContentSlide(slide) {
        const centerX = canvas.width / 2;
        const contentWidth = canvas.width * 0.75;
        const startYMargin = canvas.height * 0.15;

        // Calcular altura total para centrar verticalmente
        let totalContentHeight = 0;
        const titleSize = getDynamicFontSize(3.5);
        const pointSize = getDynamicFontSize(2);
        const titleLineHeight = titleSize * 1.2;
        const pointLineHeight = pointSize * 1.5;
        const titleMarginBottom = getDynamicFontSize(4);

        // Medir altura del título
        ctx.font = `bold ${titleSize}px ${STYLES.FONT_FAMILY}`;
        const tempTitle = document.createElement('canvas').getContext('2d');
        tempTitle.font = ctx.font;
        totalContentHeight +=
          wrapText(
            tempTitle,
            slide.title,
            0,
            0,
            contentWidth,
            titleLineHeight,
          ) + titleMarginBottom;

        // Medir altura de los puntos
        ctx.font = `400 ${pointSize}px ${STYLES.FONT_FAMILY}`;
        const tempPoint = document.createElement('canvas').getContext('2d');
        tempPoint.font = ctx.font;
        slide.points.forEach((point) => {
          totalContentHeight += wrapText(
            tempPoint,
            '• ' + point,
            0,
            0,
            contentWidth,
            pointLineHeight,
          );
        });

        let currentY = (canvas.height - totalContentHeight) / 2;

        // Dibujar título
        ctx.font = `bold ${titleSize}px ${STYLES.FONT_FAMILY}`;
        ctx.fillStyle = STYLES.ACCENT;
        const titleHeight = wrapText(
          ctx,
          slide.title,
          centerX,
          currentY,
          contentWidth,
          titleLineHeight,
        );
        currentY += titleHeight + titleMarginBottom;

        // Dibujar viñetas
        ctx.font = `400 ${pointSize}px ${STYLES.FONT_FAMILY}`;
        ctx.fillStyle = STYLES.TEXT;
        ctx.textAlign = 'left'; // Alinear viñetas a la izquierda del bloque centrado
        const pointStartX = (canvas.width - contentWidth) / 2;
        slide.points.forEach((point) => {
          const pointText = `• ${point}`;
          const pointHeight = wrapText(
            ctx,
            pointText,
            pointStartX,
            currentY,
            contentWidth,
            pointLineHeight,
          );
          currentY += pointHeight + pointLineHeight * 0.5;
        });
      }

      /**
       * Dibuja una diapositiva de tipo 'tabla'.
       * @param {object} slide - El objeto de la diapositiva.
       */
      function drawTableSlide(slide) {
        const centerX = canvas.width / 2;
        const tableWidth = canvas.width * 0.85;
        const startX = (canvas.width - tableWidth) / 2;

        // Dibujar título de la tabla
        ctx.font = `bold ${getDynamicFontSize(3)}px ${STYLES.FONT_FAMILY}`;
        ctx.fillStyle = STYLES.ACCENT;
        ctx.textAlign = 'center';
        const titleY = canvas.height * 0.15;
        wrapText(
          ctx,
          slide.title,
          centerX,
          titleY,
          tableWidth,
          getDynamicFontSize(3.5),
        );

        const tableY = titleY + getDynamicFontSize(8);
        const numCols = slide.headers.length;
        const colWidth = tableWidth / numCols;
        const rowHeight = getDynamicFontSize(8);
        const cellPadding = colWidth * 0.05;

        ctx.font = `bold ${getDynamicFontSize(1.6)}px ${STYLES.FONT_FAMILY}`;
        ctx.textBaseline = 'middle';

        // Dibujar cabecera
        for (let i = 0; i < numCols; i++) {
          const cellX = startX + i * colWidth;
          ctx.fillStyle = STYLES.TABLE_HEADER_BG;
          ctx.fillRect(cellX, tableY, colWidth, rowHeight);
          ctx.fillStyle = STYLES.TEXT;
          wrapText(
            ctx,
            slide.headers[i],
            cellX + colWidth / 2,
            tableY + rowHeight / 2,
            colWidth - cellPadding * 2,
            getDynamicFontSize(1.8),
          );
        }

        // Dibujar filas de contenido
        ctx.font = `400 ${getDynamicFontSize(1.5)}px ${STYLES.FONT_FAMILY}`;
        for (let i = 0; i < slide.rows.length; i++) {
          const rowY = tableY + (i + 1) * rowHeight;
          for (let j = 0; j < numCols; j++) {
            const cellX = startX + j * colWidth;
            ctx.fillStyle = STYLES.TEXT;
            wrapText(
              ctx,
              slide.rows[i][j],
              cellX + colWidth / 2,
              rowY + rowHeight / 2,
              colWidth - cellPadding * 2,
              getDynamicFontSize(1.7),
            );
          }
        }

        // Dibujar bordes de la tabla
        ctx.strokeStyle = STYLES.TABLE_BORDER;
        ctx.lineWidth = 2;
        // Bordes verticales
        for (let i = 0; i <= numCols; i++) {
          const lineX = startX + i * colWidth;
          ctx.beginPath();
          ctx.moveTo(lineX, tableY);
          ctx.lineTo(lineX, tableY + (slide.rows.length + 1) * rowHeight);
          ctx.stroke();
        }
        // Bordes horizontales
        for (let i = 0; i <= slide.rows.length + 1; i++) {
          const lineY = tableY + i * rowHeight;
          ctx.beginPath();
          ctx.moveTo(startX, lineY);
          ctx.lineTo(startX + tableWidth, lineY);
          ctx.stroke();
        }
      }

      /**
       * Función principal de renderizado que se llama para dibujar cualquier diapositiva.
       * @param {number} index - El índice de la diapositiva a dibujar.
       */
      function drawSlide(index) {
        // Limpiar el canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Dibujar el fondo
        ctx.fillStyle = STYLES.BACKGROUND;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const slide = slides[index];
        if (!slide) return;

        // Configuración de texto por defecto para cada diapositiva
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // Llamar a la función de dibujo apropiada según el tipo de diapositiva
        switch (slide.type) {
          case 'title':
            drawTitleSlide(slide);
            break;
          case 'content':
            drawContentSlide(slide);
            break;
          case 'table':
            drawTableSlide(slide);
            break;
          default:
            console.error(`Tipo de diapositiva desconocido: ${slide.type}`);
        }
      }

      /**
       * Ajusta el tamaño del canvas a la ventana y redibuja la diapositiva actual.
       */
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        drawSlide(currentSlide);
      }

      /**
       * Maneja la navegación con las teclas de flecha.
       * @param {KeyboardEvent} e - El evento del teclado.
       */
      function handleKeyDown(e) {
        if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
          if (currentSlide < slides.length - 1) {
            currentSlide++;
            drawSlide(currentSlide);
          }
        } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
          if (currentSlide > 0) {
            currentSlide--;
            drawSlide(currentSlide);
          }
        }
      }

      // --- INICIALIZACIÓN Y EVENT LISTENERS ---

      // Listener para ocultar las instrucciones
      instructionsOverlay.addEventListener('click', () => {
        instructionsOverlay.style.opacity = '0';
        setTimeout(() => {
          instructionsOverlay.style.display = 'none';
        }, 500); // Coincide con la duración de la transición CSS
      });

      // Listeners para la navegación y el redimensionamiento
      window.addEventListener('keydown', handleKeyDown);
      window.addEventListener('resize', resizeCanvas);

      // Llamada inicial para configurar el canvas y dibujar la primera diapositiva
      resizeCanvas();
    </script>
  </body>
</html>
