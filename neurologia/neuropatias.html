<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Módulo Interactivo: Neuropatías Periféricas</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f0f4f8;
      }

      /* --- Estilos Generales de Navegación --- */
      .module-section {
        display: none;
      }
      .module-section.active {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .nav-link {
        display: flex;
        align-items: center;
        padding: 0.75rem 1rem;
        border-left: 4px solid transparent;
        transition: all 0.3s ease;
        color: #4b5563;
      }
      .nav-link:hover {
        background-color: #f3f4f6;
        border-left-color: #9ca3af;
        color: #111827;
      }
      .nav-link.active {
        border-left-color: #3b82f6;
        background-color: #eff6ff;
        color: #1d4ed8;
        font-weight: 600;
      }
      .nav-link .nav-icon {
        margin-right: 0.75rem;
        width: 20px;
        text-align: center;
      }

      /* --- Estilos de la Presentación (Componente 1) --- */
      #presentation-container .slide-content {
        display: none;
        animation: fadeIn 0.6s ease-in-out;
      }
      #presentation-container .slide-content.active {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      #presentation-container .nerve-diagram .nerve-bg {
        fill: #dbeafe;
      }
      #presentation-container .nerve-diagram .axon {
        stroke: #60a5fa;
        stroke-width: 4;
      }
      #presentation-container .nerve-diagram .myelin {
        fill: #bfdbfe;
      }
      #presentation-container .nerve-diagram .label {
        font-family: 'Inter', sans-serif;
        font-size: 14px;
        font-weight: 600;
        fill: #1e3a8a;
      }
      #presentation-container .nerve-diagram .axon-dying {
        stroke: #f87171;
        stroke-dasharray: 8 4;
        animation: dying-pulse 2s infinite;
      }
      @keyframes dying-pulse {
        0% {
          stroke-width: 4;
        }
        50% {
          stroke-width: 2;
        }
        100% {
          stroke-width: 4;
        }
      }
      #presentation-container .nerve-diagram .myelin-damaged {
        fill: #fca5a5;
        opacity: 0.7;
      }
      #presentation-container .custom-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }
      #presentation-container .custom-table th,
      #presentation-container .custom-table td {
        border: 1px solid #e5e7eb;
        padding: 6px 10px;
        text-align: left;
      }
      #presentation-container .custom-table th {
        background-color: #f3f4f6;
        font-weight: 700;
        color: #1f2937;
      }
      #presentation-container .custom-table tr:nth-child(even) {
        background-color: #f9fafb;
      }

      /* --- Estilos del Diagnóstico Interactivo (Componente 2) --- */
      #diagnostic-tool-container .checkbox-label input[type='checkbox'] {
        display: none;
      }
      #diagnostic-tool-container .checkbox-label .checkbox-custom {
        width: 1.25em;
        height: 1.25em;
        border: 2px solid #9ca3af;
        border-radius: 0.25rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease-in-out;
        margin-right: 0.75rem;
        flex-shrink: 0;
      }
      #diagnostic-tool-container .checkbox-label .checkbox-custom .fa-check {
        font-size: 0.8em;
        color: white;
        opacity: 0;
        transform: scale(0.5);
        transition: all 0.2s ease-in-out;
      }
      #diagnostic-tool-container
        .checkbox-label
        input[type='checkbox']:checked
        + .checkbox-custom {
        background-color: #0ea5e9;
        border-color: #0ea5e9;
      }
      #diagnostic-tool-container
        .checkbox-label
        input[type='checkbox']:checked
        + .checkbox-custom
        .fa-check {
        opacity: 1;
        transform: scale(1);
      }
      #diagnostic-tool-container .checkbox-label:has(input:checked) {
        border-color: #0ea5e9;
        background-color: #f0f9ff;
        box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.2);
      }
      #diagnostic-tool-container #resultCard {
        transition:
          opacity 0.5s ease-in-out,
          transform 0.5s ease-in-out;
      }
      @keyframes pulse-bg {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.01);
        }
        100% {
          transform: scale(1);
        }
      }
      #diagnostic-tool-container .card-pulse {
        animation: pulse-bg 0.5s ease-in-out;
      }

      /* --- Estilos de la Autoevaluación (Componente 3) --- */
      #quiz-container .quiz-card {
        transition:
          opacity 0.5s ease-out,
          transform 0.5s ease-out;
      }
      #quiz-container .quiz-card.fade-out {
        opacity: 0;
        transform: scale(0.95);
      }
      #quiz-container .progress-bar-inner {
        transition: width 0.5s ease-out;
      }
      #quiz-container .option-btn.selected {
        border-width: 2px;
        transform: scale(1.02);
      }
      #quiz-container .option-btn.correct {
        background-color: #dcfce7;
        border-color: #4ade80;
        color: #166534;
        font-weight: 700;
      }
      #quiz-container .option-btn.incorrect {
        background-color: #fee2e2;
        border-color: #f87171;
        color: #991b1b;
        font-weight: 700;
      }
      #quiz-container .feedback-container,
      #quiz-container .next-btn-container {
        display: none;
        animation: slideUpFadeIn 0.5s ease-out forwards;
      }
      #quiz-container .progress-ring__circle {
        transition: stroke-dashoffset 1s ease-out;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
        animation: progress-animation 1.5s ease-out forwards;
      }
      @keyframes progress-animation {
        from {
          stroke-dashoffset: 377;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
      <div class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-3">
          Módulo Interactivo: Neuropatías Periféricas
        </h1>
        <p class="text-lg text-gray-600">
          Un enfoque integral desde la fisiopatología hasta la práctica clínica
          en Ecuador.
        </p>
      </div>

      <div class="flex flex-col lg:flex-row gap-8">
        <aside class="w-full lg:w-1/4 lg:sticky top-8 self-start">
          <div class="bg-white p-4 rounded-xl shadow-lg">
            <h3 class="text-lg font-bold text-gray-800 mb-4 px-4">
              Índice del Módulo
            </h3>
            <nav id="module-nav" class="space-y-1">
              <a href="#guia" class="nav-link active"
                ><i class="fas fa-book-open nav-icon"></i>Guía de
                Conocimiento</a
              >
              <a href="#presentacion" class="nav-link"
                ><i class="fas fa-desktop nav-icon"></i>Presentación
                Interactiva</a
              >
              <a href="#herramienta" class="nav-link"
                ><i class="fas fa-stethoscope nav-icon"></i>Herramienta
                Diagnóstica</a
              >
              <a href="#autoevaluacion" class="nav-link"
                ><i class="fas fa-vial-circle-check nav-icon"></i>Autoevaluación
                Gamificada</a
              >
            </nav>
          </div>
        </aside>

        <main class="w-full lg:w-3/4">
          <div
            id="content-container"
            class="bg-white p-6 md:p-8 rounded-xl shadow-lg min-h-[600px]"
          >
            <section id="section-guia" class="module-section active">
              <h2
                class="text-3xl font-bold text-gray-800 mb-6 border-b-2 border-blue-200 pb-3"
              >
                Bienvenido al Módulo de Neuropatías Periféricas
              </h2>
              <div class="space-y-6 text-gray-700 leading-loose">
                <p>
                  Este módulo interactivo está diseñado para guiarle a través de
                  los conceptos fundamentales de las neuropatías periféricas,
                  con un enfoque especial en el contexto clínico y de salud
                  pública de Ecuador. Utilice el
                  <b class="text-blue-600">panel de navegación</b> a la
                  izquierda para explorar los diferentes componentes de
                  aprendizaje.
                </p>

                <div class="bg-sky-50 p-6 rounded-lg border-l-4 border-sky-500">
                  <h3 class="text-xl font-semibold text-sky-800 mb-2">
                    Puntos Clave a Recordar
                  </h3>
                  <ul class="list-disc list-inside space-y-2">
                    <li>
                      La
                      <b class="text-sky-700">Polineuropatía Diabética (PND)</b>
                      es la causa más común de neuropatía en Ecuador y un
                      problema de salud pública de primer orden.
                    </li>
                    <li>
                      El
                      <b class="text-sky-700"
                        >Síndrome de Guillain-Barré (SGB)</b
                      >
                      es el prototipo de la neuropatía aguda y una emergencia
                      neurológica.
                    </li>
                    <li>
                      El razonamiento clínico para diferenciar los patrones (ej.
                      <b class="text-sky-700">axonopatía vs. desmielinización</b
                      >,
                      <b class="text-sky-700"
                        >polineuropatía vs. mononeuropatía múltiple</b
                      >) es más importante que memorizar listas de causas.
                    </li>
                  </ul>
                </div>
                <p>
                  Comience con la
                  <b class="text-blue-600">Presentación Interactiva</b> para
                  establecer una base sólida, luego ponga a prueba su
                  razonamiento con la
                  <b class="text-blue-600">Herramienta Diagnóstica</b> y
                  finalmente, evalúe su conocimiento con la
                  <b class="text-blue-600">Autoevaluación Gamificada</b>.
                </p>

                <!-- Enlaces a los AI Dashboards -->
                <div class="mt-8 bg-white p-4 rounded-lg shadow-md">
                  <h4 class="text-lg font-semibold text-blue-600 mb-2">
                    ¿Necesitas ayuda de IA con este tema?
                  </h4>
                  <ul class="list-disc list-inside space-y-1">
                    <li>
                      <a
                        href="/ai_dashboard.html"
                        class="text-blue-500 hover:underline"
                        >AI Dashboard (API)</a
                      >
                    </li>
                    <li>
                      <a
                        href="/ai_dashboard_local.html"
                        class="text-blue-500 hover:underline"
                        >AI Dashboard (Local)</a
                      >
                    </li>
                  </ul>
                  <p class="text-sm text-gray-500 mt-2">
                    Usa estos paneles para resumir, traducir, formular preguntas
                    o generar ejemplos del contenido de este módulo.
                  </p>
                </div>
                <!-- Fin de enlaces a los AI Dashboards -->
              </div>
            </section>

            <section id="section-presentacion" class="module-section"></section>
            <section id="section-herramienta" class="module-section"></section>
            <section
              id="section-autoevaluacion"
              class="module-section"
            ></section>
          </div>
        </main>
      </div>
    </div>

    <template id="presentation-template">
      <div id="presentation-container">
        <div
          class="w-full h-full flex flex-col bg-white/70 backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden ring-1 ring-black ring-opacity-5"
        >
          <div class="flex-grow p-4 md:p-8 overflow-y-auto">
            <div
              class="bg-slate-100 rounded-lg w-full h-full flex items-center justify-center p-8 md:p-12 min-h-[500px] relative"
            ></div>
          </div>
          <div
            class="flex-shrink-0 p-4 bg-slate-200/50 border-t border-slate-300/70"
          >
            <div class="flex items-center justify-between max-w-md mx-auto">
              <button
                id="prevBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <i class="fas fa-arrow-left mr-2"></i> Anterior
              </button>
              <div
                id="slide-counter"
                class="text-lg font-semibold text-slate-700"
              ></div>
              <button
                id="nextBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-colors"
              >
                Siguiente <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </template>

    <template id="diagnostic-tool-template">
      <div id="diagnostic-tool-container" class="w-full max-w-2xl mx-auto">
        <div
          id="diagnosisCard"
          class="bg-gradient-to-br from-sky-50 to-cyan-100 rounded-2xl shadow-xl p-8 md:p-12"
        >
          <div class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800">
              Asistente de Diagnóstico Diferencial
            </h1>
            <p class="text-slate-500 mt-2">
              Seleccione los hallazgos clínicos clave para obtener una
              orientación diagnóstica.
            </p>
          </div>
          <div id="symptomsContainer" class="space-y-4 mb-8">
            <label
              class="checkbox-label flex items-center p-4 bg-white border-2 border-slate-200 rounded-lg cursor-pointer transition-all duration-200 hover:bg-sky-50 hover:border-sky-400"
              ><input type="checkbox" data-symptom="ascendingWeakness" /><span
                class="checkbox-custom"
                ><i class="fas fa-check"></i></span
              ><span class="font-semibold text-slate-700"
                >Debilidad ascendente y simétrica</span
              ></label
            >
            <label
              class="checkbox-label flex items-center p-4 bg-white border-2 border-slate-200 rounded-lg cursor-pointer transition-all duration-200 hover:bg-sky-50 hover:border-sky-400"
              ><input type="checkbox" data-symptom="arreflexia" /><span
                class="checkbox-custom"
                ><i class="fas fa-check"></i></span
              ><span class="font-semibold text-slate-700"
                >Arreflexia generalizada</span
              ></label
            >
            <label
              class="checkbox-label flex items-center p-4 bg-white border-2 border-slate-200 rounded-lg cursor-pointer transition-all duration-200 hover:bg-sky-50 hover:border-sky-400"
              ><input type="checkbox" data-symptom="burningPain" /><span
                class="checkbox-custom"
                ><i class="fas fa-check"></i></span
              ><span class="font-semibold text-slate-700"
                >Dolor quemante en "guante y calcetín"</span
              ></label
            >
            <label
              class="checkbox-label flex items-center p-4 bg-white border-2 border-slate-200 rounded-lg cursor-pointer transition-all duration-200 hover:bg-sky-50 hover:border-sky-400"
              ><input type="checkbox" data-symptom="vibratoryLoss" /><span
                class="checkbox-custom"
                ><i class="fas fa-check"></i></span
              ><span class="font-semibold text-slate-700"
                >Pérdida de sensibilidad vibratoria</span
              ></label
            >
            <label
              class="checkbox-label flex items-center p-4 bg-white border-2 border-slate-200 rounded-lg cursor-pointer transition-all duration-200 hover:bg-sky-50 hover:border-sky-400"
              ><input
                type="checkbox"
                data-symptom="mononeuropathyMultiplex"
              /><span class="checkbox-custom"><i class="fas fa-check"></i></span
              ><span class="font-semibold text-slate-700"
                >Mononeuropatía múltiple (asimétrica)</span
              ></label
            >
          </div>
          <button
            id="analyzeBtn"
            class="w-full flex items-center justify-center p-4 bg-gradient-to-r from-sky-500 to-cyan-500 text-white font-bold text-lg rounded-lg shadow-lg transition-all duration-300 hover:scale-105 hover:brightness-110"
          >
            <i class="fa-solid fa-stethoscope mr-3"></i> Analizar Hallazgos
          </button>
        </div>
        <div
          id="resultCard"
          class="mt-8 bg-white rounded-2xl shadow-xl p-8 text-center opacity-0 transform translate-y-5"
          style="display: none"
        >
          <div id="resultIcon" class="text-6xl mb-4 mx-auto"></div>
          <h2 id="resultTitle" class="text-4xl font-extrabold"></h2>
          <p
            id="resultJustification"
            class="text-slate-600 mt-4 text-lg leading-relaxed"
          ></p>
        </div>
      </div>
    </template>

    <template id="quiz-template">
      <div id="quiz-container" class="w-full max-w-3xl mx-auto">
        <div
          id="quiz-card"
          class="quiz-card bg-white rounded-2xl shadow-xl overflow-hidden"
        >
          <div class="p-8 pb-0">
            <div class="bg-gray-200 rounded-full h-2.5">
              <div
                id="progress-bar"
                class="bg-gradient-to-r from-cyan-500 to-blue-500 h-2.5 rounded-full progress-bar-inner"
                style="width: 0%"
              ></div>
            </div>
          </div>
          <div id="question-area" class="p-8">
            <h2
              class="text-lg font-bold text-blue-600 mb-2"
              id="question-counter"
            ></h2>
            <p
              class="text-xl text-slate-800 font-semibold leading-relaxed"
              id="question-text"
            ></p>
            <div id="options-container" class="mt-8 space-y-4"></div>
            <div id="feedback-container" class="feedback-container mt-6">
              <div id="feedback-box" class="p-4 rounded-lg">
                <h3 class="font-bold mb-2">Justificación Pedagógica:</h3>
                <div id="feedback-text" class="space-y-2 text-sm"></div>
              </div>
            </div>
            <div id="next-btn-container" class="next-btn-container mt-6">
              <button
                id="next-btn"
                class="w-full p-3 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 transition-all duration-300"
              >
                Siguiente Pregunta <i class="fas fa-arrow-right ml-2"></i>
              </button>
            </div>
          </div>
        </div>
        <div
          id="results-container"
          class="text-center p-8 bg-white rounded-2xl shadow-xl"
          style="display: none"
        >
          <h2 class="text-3xl font-extrabold text-slate-800 mb-4">
            Quiz Completado
          </h2>
          <div class="relative inline-flex items-center justify-center my-6">
            <svg class="w-40 h-40">
              <circle
                class="text-gray-200"
                stroke-width="10"
                stroke="currentColor"
                fill="transparent"
                r="60"
                cx="80"
                cy="80"
              />
              <circle
                id="progress-ring"
                class="progress-ring__circle text-blue-500"
                stroke-width="10"
                stroke-linecap="round"
                stroke="currentColor"
                fill="transparent"
                r="60"
                cx="80"
                cy="80"
              /></svg
            ><span
              id="score-text"
              class="absolute text-4xl font-extrabold text-blue-600"
            ></span>
          </div>
          <p
            id="results-feedback"
            class="text-xl text-slate-600 font-semibold mb-8"
          ></p>
          <button
            id="restart-btn"
            class="w-full max-w-xs mx-auto p-4 bg-gray-800 text-white font-bold rounded-lg shadow-md hover:bg-gray-900 transition-all duration-300"
          >
            <i class="fas fa-redo mr-2"></i> Repetir el Quiz
          </button>
        </div>
      </div>
    </template>

    <script>
      document.addEventListener('DOMContentLoaded', () => {

          // --- LÓGICA DE NAVEGACIÓN PRINCIPAL ---
          const navLinks = document.querySelectorAll('.nav-link');
          const sections = document.querySelectorAll('.module-section');
          const contentContainer = document.getElementById('content-container');

          const contentLoaders = {
              'section-presentacion': (container) => {
                  const template = document.getElementById('presentation-template');
                  container.innerHTML = '';
                  container.appendChild(template.content.cloneNode(true));
                  setupPresentation(container.querySelector('#presentation-container'));
              },
              'section-herramienta': (container) => {
                  const template = document.getElementById('diagnostic-tool-template');
                  container.innerHTML = '';
                  container.appendChild(template.content.cloneNode(true));
                  setupDiagnosticTool(container.querySelector('#diagnostic-tool-container'));
              },
              'section-autoevaluacion': (container) => {
                  const template = document.getElementById('quiz-template');
                  container.innerHTML = '';
                  container.appendChild(template.content.cloneNode(true));
                  setupQuiz(container.querySelector('#quiz-container'));
              }
          };

          function switchSection(hash) {
              hash = hash.substring(1);
              let targetSectionId = 'section-' + hash;
              let targetSection = document.getElementById(targetSectionId);

              if (!targetSection) {
                  hash = 'guia';
                  targetSectionId = 'section-guia';
                  targetSection = document.getElementById(targetSectionId);
              }

              navLinks.forEach(link => link.classList.toggle('active', link.hash === '#' + hash));
              sections.forEach(section => section.classList.toggle('active', section.id === targetSectionId));

              if (contentLoaders[targetSectionId] && !targetSection.dataset.loaded) {
                  contentLoaders[targetSectionId](targetSection);
                  targetSection.dataset.loaded = "true";
              }
          }

          navLinks.forEach(link => {
              link.addEventListener('click', (e) => {
                  e.preventDefault();
                  const targetId = link.getAttribute('href');
                  switchSection(targetId);
                  history.pushState(null, null, targetId);
                  window.scrollTo({ top: contentContainer.offsetTop - 80, behavior: 'smooth' });
              });
          });

          if (window.location.hash) {
              switchSection(window.location.hash);
          } else {
              switchSection('#guia');
          }

          // --- LÓGICA DE LA PRESENTACIÓN (Componente 1) ---
          function setupPresentation(container) {
              const slideData = [
                  // Diapositivas 1-5: Introducción y Fundamentos
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 1</h3><h2 class="text-4xl font-extrabold text-slate-800">Neuropatías Periféricas: Un Enfoque Integral</h2><p class="text-lg text-slate-600 mt-4">Desde la Fisiopatología hasta la Práctica Clínica en el Sistema de Salud Ecuatoriano.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 2</h3><h2 class="text-3xl font-bold text-slate-800">Definición y Alcance</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Grupo heterogéneo de trastornos por daño al <b class="text-blue-600">Sistema Nervioso Periférico (SNP)</b>. Se manifiestan con síntomas motores, sensitivos y autonómicos, representando un desafío diagnóstico.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 3</h3><h2 class="text-3xl font-bold text-slate-800">Relevancia en Ecuador</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl"><b class="text-red-600">Diabetes Mellitus:</b> 2ª causa de mortalidad general, con hasta 70% de pacientes desarrollando neuropatía. <br><b class="text-red-600">Síndrome de Guillain-Barré (SGB):</b> Prototipo de neuropatía aguda que requiere vigilancia epidemiológica activa.</p></div>`,
                  `<div class="w-full"><h3 class="text-2xl font-semibold text-blue-600 mb-2 text-center">Diapositiva 4</h3><h2 class="text-3xl font-bold text-slate-800 mb-4 text-center">Arquitectura del Nervio Periférico</h2><svg viewBox="0 0 800 200" class="nerve-diagram w-full h-auto"><text x="400" y="20" text-anchor="middle" class="text-xl font-bold fill-slate-700">Estructura Microscópica</text><g transform="translate(50, 50)"><rect x="0" y="0" width="700" height="100" class="nerve-bg" rx="10"/><path d="M 10 50 H 690" class="axon"/><rect x="50" y="25" width="80" height="50" class="myelin" rx="5"/><text x="90" y="90" class="label" text-anchor="middle">Mielina</text><rect x="150" y="25" width="80" height="50" class="myelin" rx="5"/><rect x="250" y="25" width="80" height="50" class="myelin" rx="5"/><rect x="350" y="25" width="80" height="50" class="myelin" rx="5"/><rect x="450" y="25" width="80" height="50" class="myelin" rx="5"/><text x="590" y="55" class="label" text-anchor="middle">Nodo de Ranvier</text></g></svg><p class="text-center mt-2 text-slate-600">La <b class="text-blue-600">mielina</b>, producida por las células de Schwann, permite la conducción saltatoria y rápida del impulso nervioso.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 5</h3><h2 class="text-3xl font-bold text-slate-800">Mecanismos Fisiopatológicos Clave</h2><div class="flex gap-6 mt-4"><div class="flex-1 bg-white p-4 rounded-lg shadow-sm"><h4 class="font-bold text-lg">Axonopatía Distal</h4><p class="text-sm">Daño primario al axón, típico de causas metabólicas (DM). Progresión "en guante y calcetín".</p></div><div class="flex-1 bg-white p-4 rounded-lg shadow-sm"><h4 class="font-bold text-lg">Desmielinización Segmentaria</h4><p class="text-sm">Daño primario a la mielina, típico de causas inflamatorias (SGB). Causa enlentecimiento drástico de la conducción.</p></div></div></div>`,
                  // Diapositivas 6-10: Diagnóstico
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 6</h3><h2 class="text-3xl font-bold text-slate-800">Clasificación de las Neuropatías</h2><ul class="list-disc list-inside text-left max-w-lg mx-auto mt-4 text-lg"><li><b class="text-blue-600">Temporalidad:</b> Aguda (SGB), Subaguda, Crónica (PND).</li><li><b class="text-blue-600">Distribución:</b> Mononeuropatía, Mononeuropatía Múltiple, Polineuropatía.</li><li><b class="text-blue-600">Fibra Afectada:</b> Motora, Sensitiva (fibras grandes/pequeñas), Autonómica.</li></ul></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 7</h3><h2 class="text-3xl font-bold text-slate-800">Correlación Clínico-Fisiopatológica</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">La habilidad clave es inferir el mecanismo a partir de la clínica. <br> <b class="text-red-600">Debilidad aguda + arreflexia ➡️ Desmielinización (SGB).</b> <br> <b class="text-red-600">Dolor crónico distal + simétrico ➡️ Axonopatía (PND).</b></p></div>`,
                  `<div class="text-left"><h3 class="text-2xl font-semibold text-blue-600 mb-4 text-center">Diapositiva 8</h3><h2 class="text-3xl font-bold text-slate-800 text-center mb-4">El Pilar del Diagnóstico: Anamnesis</h2><ul class="list-disc list-inside text-lg space-y-2"><li><b class="text-slate-800">Síntomas:</b> Diferenciar negativos (pérdida: adormecimiento) vs. positivos (ganancia anómala: dolor).</li><li><b class="text-slate-800">Distribución:</b> ¿Dónde comenzaron? ¿Simétricos o asimétricos?</li><li><b class="text-slate-800">Tipo de Fibra:</b> ¿Dificultad con botones (grandes)? ¿Dolor quemante (pequeñas)? ¿Mareo al pararse (autonómicas)?</li></ul></div>`,
                  `<div class="text-left"><h3 class="text-2xl font-semibold text-blue-600 mb-4 text-center">Diapositiva 9</h3><h2 class="text-3xl font-bold text-slate-800 text-center mb-4">El Pilar del Diagnóstico: Examen Físico</h2><ul class="list-disc list-inside text-lg space-y-2"><li><b class="text-slate-800">Motor:</b> Fuerza (MRC), Tono, y <b class="text-red-600">Reflejos Osteotendinosos</b> (la arreflexia aquílea es clave).</li><li><b class="text-slate-800">Sensitivo:</b> Diapasón 128 Hz (vibración), alfiler (dolor).</li><li><b class="text-slate-800">Tamizaje en Diabetes:</b> <b class="text-red-600">Monofilamento de 10g</b> para evaluar pérdida de sensación protectora y riesgo de úlcera.</li></ul></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 10</h3><h2 class="text-3xl font-bold text-slate-800">Estudios Electrodiagnósticos (EDX)</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Son una extensión del examen físico para diferenciar patrones. <br> <b class="text-blue-600">Patrón Axonal:</b> Reducción de amplitud (pérdida de axones). <br> <b class="text-blue-600">Patrón Desmielinizante:</b> Disminución de velocidad (daño a la mielina).</p></div>`,
                  // Diapositivas 11-15: Modelos Prototípicos
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 11</h3><h2 class="text-3xl font-bold text-slate-800">Modelo Crónico: Polineuropatía Diabética (PND)</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">La hiperglicemia crónica daña los nervios por múltiples vías (polioles, AGEs, estrés oxidativo). <b class="text-red-600">Cerca del 50% son asintomáticos al inicio,</b> lo que subraya la importancia del tamizaje activo.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 12</h3><h2 class="text-3xl font-bold text-slate-800">Modelo Agudo: Síndrome de Guillain-Barré (SGB)</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Trastorno post-infeccioso (ej. *Campylobacter jejuni*, Zika) que constituye una <b class="text-red-600">emergencia neurológica</b> por el riesgo de insuficiencia respiratoria.</p></div>`,
                  `<div class="text-left"><h3 class="text-2xl font-semibold text-blue-600 mb-4 text-center">Diapositiva 13</h3><h2 class="text-3xl font-bold text-slate-800 text-center mb-4">SGB: Criterios Diagnósticos</h2><ul class="list-disc list-inside text-lg space-y-2"><li class="font-bold text-red-600">Requerido: Debilidad progresiva + Arreflexia/hiporreflexia marcada.</li><li>Apoyan fuertemente: Progresión en días a 4 sem, simetría, afectación de nervios craneales, disfunción autonómica.</li><li>Apoyo paraclínico: Disociación albúmino-citológica en LCR, patrón desmielinizante en EDX.</li></ul></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 14</h3><h2 class="text-3xl font-bold text-slate-800">SGB: Manejo de Complicaciones Agudas</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl"><b class="text-red-600">Insuficiencia Respiratoria (25-30%):</b> La más grave. Requiere monitoreo en UCI y ventilación mecánica proactiva (ej. CVF < 20 mL/kg). <br> <b class="text-red-600">Disfunción Autonómica:</b> Fluctuaciones de PA y FC que requieren monitoreo cardíaco.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 15</h3><h2 class="text-3xl font-bold text-slate-800">SGB: Terapias Inmunomoduladoras</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Indicadas si el paciente no puede caminar (Hughes ≥3). <br> <b class="text-blue-600">Primera línea:</b> Inmunoglobulina IV (IVIg) o Plasmaféresis (PE), con eficacia equivalente. <br> <b class="text-red-600">¡NO usar corticosteroides!</b> Son ineficaces.</p></div>`,
                  // Diapositivas 16-20: Tratamiento y Flujo en el Sistema de Salud
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 16</h3><h2 class="text-3xl font-bold text-slate-800">Farmacoterapia Racional del Dolor Neuropático</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Se basa en neuromoduladores. El principio universal es <b class="text-red-600">"start low, go slow"</b> (empezar bajo, ir lento), titulando la dosis gradualmente para balancear eficacia y efectos adversos.</p></div>`,
                  `<div class="w-full"><h3 class="text-2xl font-semibold text-blue-600 mb-2 text-center">Diapositiva 17</h3><h2 class="text-3xl font-bold text-slate-800 mb-4 text-center">Fármacos en el CNMB de Ecuador</h2><div class="overflow-x-auto"><table class="custom-table"><thead><tr><th>Fármaco</th><th>Clase</th><th>Nivel de Prescripción</th></tr></thead><tbody><tr><td><b>Amitriptilina</b></td><td>ATC</td><td>General</td></tr><tr><td><b>Gabapentina</b></td><td>Gabapentinoide</td><td>General</td></tr><tr><td><b>Carbamazepina</b></td><td>Bloq. Canales Na+</td><td>General</td></tr><tr><td><b>Pregabalina</b></td><td>Gabapentinoide</td><td>Especialidad</td></tr><tr><td><b>Duloxetina</b></td><td>IRSN</td><td>Especialidad</td></tr></tbody></table></div><p class="text-center text-sm mt-2">El médico debe dominar el manejo de fármacos de nivel general como Amitriptilina y Gabapentina.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 18</h3><h2 class="text-3xl font-bold text-slate-800">Rol del Médico de Atención Primaria (AP)</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Es la <b class="text-blue-600">puerta de entrada al sistema</b>. Sus roles son: sospecha inicial, manejo de casos prevalentes (PND), identificación de "banderas Rojas" y referencia oportuna y efectiva.</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 19</h3><h2 class="text-3xl font-bold text-slate-800">Criterios de Referencia Urgente</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">La "bandera roja" más importante que requiere referencia <b class="text-red-600">URGENTE</b> a Emergencia es: <br><b>Debilidad rápidamente progresiva (días) en más de una extremidad, con arreflexia.</b> (Sospecha de SGB).</p></div>`,
                  `<div class="text-center"><h3 class="text-2xl font-semibold text-blue-600 mb-4">Diapositiva 20</h3><h2 class="text-3xl font-bold text-slate-800">El Formulario 053: Comunicación Clínica Clave</h2><p class="text-lg text-slate-600 mt-4 max-w-3xl">Es el instrumento de comunicación clínica asincrónica. Un resumen bien estructurado (S-O-A-P) en la <b class="text-blue-600">casilla 3</b> asegura la continuidad del cuidado y optimiza los recursos.</p></div>`,
              ];

              const slideContainer = container.querySelector('.bg-slate-100');
              const prevBtn = container.querySelector('#prevBtn');
              const nextBtn = container.querySelector('#nextBtn');
              const slideCounter = container.querySelector('#slide-counter');
              let currentSlide = 0;

              function renderSlides() {
                  slideContainer.innerHTML = slideData.map((content, index) =>
                      `<div class="slide-content absolute w-full h-full p-6 md:p-10 ${index === 0 ? 'active' : ''}">${content}</div>`
                  ).join('');
              }

              function showSlide(n) {
                  const slides = slideContainer.querySelectorAll('.slide-content');
                  slides.forEach((slide, index) => slide.classList.toggle('active', index === n));
                  currentSlide = n;
                  slideCounter.textContent = `${n + 1} / ${slides.length}`;
                  prevBtn.disabled = n === 0;
                  nextBtn.disabled = n === slides.length - 1;
              }

              renderSlides();
              showSlide(0);

              nextBtn.addEventListener('click', () => showSlide(currentSlide + 1));
              prevBtn.addEventListener('click', () => showSlide(currentSlide - 1));
          }

          // --- LÓGICA DE LA HERRAMIENTA DIAGNÓSTICA (Componente 2) ---
          function setupDiagnosticTool(container) {
              const diagnosisCard = container.querySelector('#diagnosisCard');
              const analyzeBtn = container.querySelector('#analyzeBtn');
              const resultCard = container.querySelector('#resultCard');
              const resultIcon = container.querySelector('#resultIcon');
              const resultTitle = container.querySelector('#resultTitle');
              const resultJustification = container.querySelector('#resultJustification');
              const checkboxes = container.querySelectorAll('input[type="checkbox"]');

              checkboxes.forEach(checkbox => {
                  checkbox.addEventListener('change', () => {
                      diagnosisCard.classList.remove('card-pulse');
                      void diagnosisCard.offsetWidth;
                      diagnosisCard.classList.add('card-pulse');
                  });
              });

              analyzeBtn.addEventListener('click', () => {
                  const selectedSymptoms = {};
                  checkboxes.forEach(checkbox => {
                      if (checkbox.checked) selectedSymptoms[checkbox.dataset.symptom] = true;
                  });

                  let diag = {
                      title: 'Hallazgos no concluyentes',
                      justification: 'La combinación de síntomas seleccionada no corresponde a un patrón clásico. Considere otras etiologías o refine la anamnesis y el examen físico. Este es un asistente educativo y no reemplaza el juicio clínico.',
                      icon: '<i class="fa-solid fa-question-circle text-gray-400"></i>',
                      borderColor: 'border-gray-400'
                  };

                  if (selectedSymptoms.ascendingWeakness && selectedSymptoms.arreflexia) {
                      diag = {
                          title: 'Síndrome de Guillain-Barré (SGB)',
                          justification: 'La constelación de debilidad aguda, ascendente, simétrica y con arreflexia generalizada es el sello clínico de una neuropatía desmielinizante aguda, cuyo arquetipo es el SGB.',
                          icon: '<i class="fa-solid fa-lungs-virus text-red-500"></i>',
                          borderColor: 'border-red-500'
                      };
                  } else if (selectedSymptoms.burningPain && selectedSymptoms.vibratoryLoss) {
                      diag = {
                          title: 'Polineuropatía Diabética (PND)',
                          justification: 'La presencia de síntomas de fibras pequeñas (dolor quemante) y de fibras grandes (pérdida de vibración) en una distribución distal y simétrica ("en guante y calcetín") es característica de una axonopatía distal, el mecanismo típico de la PND.',
                          icon: '<i class="fa-solid fa-shoe-prints text-blue-500"></i>',
                          borderColor: 'border-blue-500'
                      };
                  } else if (selectedSymptoms.mononeuropathyMultiplex) {
                      diag = {
                          title: 'Vasculitis (Mononeuropatía Múltiple)',
                          justification: 'La afectación secuencial, asimétrica y escalonada de nervios no contiguos (mononeuropatía múltiple) es una "bandera roja" que sugiere un proceso sistémico que afecta los vasos sanguíneos de los nervios (vasa nervorum), como ocurre en las vasculitis.',
                          icon: '<i class="fa-solid fa-diagram-project text-amber-500"></i>',
                          borderColor: 'border-amber-500'
                      };
                  }

                  resultIcon.innerHTML = diag.icon;
                  resultTitle.textContent = diag.title;
                  resultJustification.innerHTML = diag.justification;
                  resultCard.className = `mt-8 bg-white rounded-2xl shadow-xl p-8 text-center opacity-0 transform translate-y-5 border-t-8 ${diag.borderColor}`;
                  resultCard.style.display = 'block';
                  setTimeout(() => {
                      resultCard.classList.remove('opacity-0', 'translate-y-5');
                      resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  }, 10);
              });
          }

          // --- LÓGICA DE LA AUTOEVALUACIÓN (Componente 3) ---
          function setupQuiz(container) {
              const quizData = [
                  { question: "Paciente de 65 años con diabetes de 15 años de evolución, consulta por dolor quemante y adormecimiento en ambos pies que ha progresado lentamente hasta las rodillas. Al examen, presenta hipoestesia vibratoria y aquíleos ausentes. ¿Cuál es el diagnóstico más probable?", options: ["Síndrome de Guillain-Barré (SGB)", "Polineuropatía Diabética (PND)", "Mononeuropatía Múltiple por vasculitis", "Neuropatía por atrapamiento del nervio mediano"], correctAnswer: 1, justification: { correct: "Correcto. El cuadro de un paciente con diabetes de larga data que presenta síntomas sensitivos crónicos, de progresión lenta, simétricos y distales (patrón 'en guante y calcetín'), con afectación de fibras grandes (vibración) y pequeñas (dolor), es el sello de una axonopatía distal, típica de la PND.", incorrect: ["Incorrecto. El SGB es una neuropatía aguda y motora.", "Incorrecto. La vasculitis es asimétrica y escalonada.", "Incorrecto. El síndrome del túnel carpiano es una mononeuropatía de la mano."] } },
                  { question: "Un paciente de 30 años acude a emergencia por una historia de 4 días de debilidad en las piernas que ahora le dificulta subir escaleras, y desde ayer nota debilidad en los brazos. Al examen, presenta arreflexia generalizada. ¿Cuál es la sospecha diagnóstica principal?", options: ["Polineuropatía diabética de inicio atípico", "Vasculitis sistémica", "Síndrome de Guillain-Barré (SGB)", "Déficit de Vitamina B12"], correctAnswer: 2, justification: { correct: "Correcto. La debilidad motora aguda (días), ascendente, simétrica y con arreflexia es la presentación clásica del SGB, una emergencia neurológica.", incorrect: ["Incorrecto. La PND es crónica.", "Incorrecto. La vasculitis es asimétrica.", "Incorrecto. El déficit de B12 es crónico y primariamente sensitivo."] } },
                  { question: "En un centro de AP en Ecuador, un paciente con PND dolorosa necesita iniciar tratamiento. Según el CNMB y el principio de 'empezar bajo, ir lento', ¿cuál es una opción de primera línea adecuada y disponible?", options: ["Inmunoglobulina Intravenosa (IVIg)", "Corticosteroides a altas dosis", "Amitriptilina 10-25 mg por la noche", "Tramadol 100 mg cada 8 horas"], correctAnswer: 2, justification: { correct: "Correcto. La amitriptilina está en el CNMB, es efectiva y la dosis de inicio baja y nocturna sigue la estrategia 'start low, go slow' para minimizar efectos adversos.", incorrect: ["Incorrecto. IVIg es para neuropatías inmunes como el SGB.", "Incorrecto. Los corticoides no están indicados para el dolor neuropático diabético.", "Incorrecto. Tramadol no es primera línea y la dosis de inicio es muy alta."] } }
              ];

              let currentQuestionIndex = 0;
              let score = 0;
              const quizCard = container.querySelector('#quiz-card');
              const resultsContainer = container.querySelector('#results-container');
              const progressBar = container.querySelector('#progress-bar');
              const questionCounter = container.querySelector('#question-counter');
              const questionText = container.querySelector('#question-text');
              const optionsContainer = container.querySelector('#options-container');
              const feedbackContainer = container.querySelector('#feedback-container');
              const feedbackBox = container.querySelector('#feedback-box');
              const feedbackText = container.querySelector('#feedback-text');
              const nextBtnContainer = container.querySelector('#next-btn-container');
              const nextBtn = container.querySelector('#next-btn');
              const restartBtn = container.querySelector('#restart-btn');
              const scoreText = container.querySelector('#score-text');
              const progressRing = container.querySelector('#progress-ring');
              const resultsFeedback = container.querySelector('#results-feedback']);

              function startQuiz() {
                  currentQuestionIndex = 0;
                  score = 0;
                  resultsContainer.style.display = 'none';
                  quizCard.style.display = 'block';
                  quizCard.classList.remove('fade-out');
                  displayQuestion();
              }

              function displayQuestion() {
                  quizCard.classList.add('fade-out');
                  setTimeout(() => {
                      const question = quizData[currentQuestionIndex];
                      feedbackContainer.style.display = 'none';
                      nextBtnContainer.style.display = 'none';
                      optionsContainer.innerHTML = '';
                      progressBar.style.width = `${((currentQuestionIndex) / quizData.length) * 100}%`;
                      questionCounter.textContent = `Pregunta ${currentQuestionIndex + 1} de ${quizData.length}`;
                      questionText.textContent = question.question;
                      question.options.forEach((option, index) => {
                          const button = document.createElement('button');
                          button.className = 'option-btn w-full text-left p-4 border-2 border-gray-200 rounded-lg hover:bg-gray-100 transition-all duration-300';
                          button.textContent = option;
                          button.onclick = () => selectAnswer(index, button);
                          optionsContainer.appendChild(button);
                      });
                      quizCard.classList.remove('fade-out');
                  }, 500);
              }

              function selectAnswer(selectedIndex, selectedButton) {
                  const question = quizData[currentQuestionIndex];
                  const correctIndex = question.correctAnswer;
                  optionsContainer.querySelectorAll('.option-btn').forEach(btn => btn.disabled = true);
                  selectedButton.classList.add('selected');
                  const isCorrect = selectedIndex === correctIndex;
                  if (isCorrect) {
                      score++;
                      selectedButton.classList.add('correct');
                      feedbackBox.className = 'p-4 rounded-lg bg-green-50 border border-green-300';
                  } else {
                      selectedButton.classList.add('incorrect');
                      optionsContainer.querySelectorAll('.option-btn')[correctIndex].classList.add('correct');
                      feedbackBox.className = 'p-4 rounded-lg bg-red-50 border border-red-300';
                  }
                  showFeedback(question);
              }

              function showFeedback(question) {
                  let justificationHTML = `<p class="font-bold text-green-700">${question.justification.correct}</p>`;
                  justificationHTML += `<div class="mt-3 border-t pt-2 space-y-2">${question.options.map((opt, index) => {
                      if (index !== question.correctAnswer) return `<p><strong class="text-red-700">Opción "${opt}":</strong> ${question.justification.incorrect[question.options.map((o,i)=>i).filter(i=>i!==question.correctAnswer).indexOf(index)]}</p>`;
                      return '';
                  }).join('')}</div>`;
                  feedbackText.innerHTML = justificationHTML;
                  feedbackContainer.style.display = 'block';
                  nextBtnContainer.style.display = 'block';
                  nextBtn.textContent = (currentQuestionIndex === quizData.length - 1) ? "Ver Resultados Finales" : "Siguiente Pregunta";
              }

              nextBtn.addEventListener('click', () => {
                  currentQuestionIndex++;
                  (currentQuestionIndex < quizData.length) ? displayQuestion() : showResults();
              });

              restartBtn.addEventListener('click', startQuiz);

              function showResults() {
                  quizCard.classList.add('fade-out');
                  setTimeout(() => {
                      quizCard.style.display = 'none';
                      resultsContainer.style.display = 'block';
                      const percentage = Math.round((score / quizData.length) * 100);
                      scoreText.textContent = `${percentage}%`;
                      const radius = progressRing.r.baseVal.value;
                      const circumference = radius * 2 * Math.PI;
                      progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
                      progressRing.style.strokeDashoffset = circumference - (percentage / 100) * circumference;
                      if (percentage === 100) resultsFeedback.textContent = "¡Excelente! Dominio completo.";
                      else if (percentage >= 70) resultsFeedback.textContent = "¡Muy bien! Sólido conocimiento.";
                      else resultsFeedback.textContent = "Buen intento. Repasa los puntos clave.";
                  }, 500);
              }

              startQuiz();
          }
      });
    </script>
  </body>
</html>
